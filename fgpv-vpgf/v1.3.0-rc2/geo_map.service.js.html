<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>geo/map.service.js - Documentation</title>

    <script src="scripts/prettify/prettify.js"></script>
    <script src="scripts/prettify/lang-css.js"></script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc.css">
</head>
<body>

<input type="checkbox" id="nav-trigger" class="nav-trigger" />
<label for="nav-trigger" class="navicon-button x">
  <div class="navicon"></div>
</label>

<label for="nav-trigger" class="overlay"></label>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Classes</h3><ul><li><a href="app.geo.module_identifyService-IDENTIFY_RESULT.html">IDENTIFY_RESULT</a></li><li><a href="app.geo.module_LayerBlueprintFactory-LayerBlueprint.LayerBlueprint.html">LayerBlueprint</a></li><li><a href="app.geo.module_LayerBlueprintFactory-LayerFileBlueprint.html">LayerFileBlueprint</a><ul class='methods'><li data-type='method'><a href="app.geo.module_LayerBlueprintFactory-LayerFileBlueprint.html#_readFileData">_readFileData</a></li><li data-type='method'><a href="app.geo.module_LayerBlueprintFactory-LayerFileBlueprint.html#generateLayer">generateLayer</a></li><li data-type='method'><a href="app.geo.module_LayerBlueprintFactory-LayerFileBlueprint.html#validate">validate</a></li></ul></li><li><a href="app.geo.module_LayerBlueprintFactory-LayerServiceBlueprint.LayerServiceBlueprint.html">LayerServiceBlueprint</a></li><li><a href="app.geo.module_LayerRecordFactory-AttrRecord.html">AttrRecord</a><ul class='methods'><li data-type='method'><a href="app.geo.module_LayerRecordFactory-AttrRecord.html#formatAttributes">formatAttributes</a></li><li data-type='method'><a href="app.geo.module_LayerRecordFactory-AttrRecord.html#getAttributes">getAttributes</a></li></ul></li><li><a href="app.geo.module_LayerRecordFactory-DynamicRecord.html">DynamicRecord</a><ul class='methods'><li data-type='method'><a href="app.geo.module_LayerRecordFactory-DynamicRecord.html#.parseData">parseData</a></li><li data-type='method'><a href="app.geo.module_LayerRecordFactory-DynamicRecord.html#makeLayerBookmark">makeLayerBookmark</a></li></ul></li><li><a href="app.geo.module_LayerRecordFactory-FeatureRecord.html">FeatureRecord</a><ul class='methods'><li data-type='method'><a href="app.geo.module_LayerRecordFactory-FeatureRecord.html#.parseData">parseData</a></li><li data-type='method'><a href="app.geo.module_LayerRecordFactory-FeatureRecord.html#makeLayerBookmark">makeLayerBookmark</a></li></ul></li><li><a href="app.geo.module_LayerRecordFactory-ImageRecord.html">ImageRecord</a><ul class='methods'><li data-type='method'><a href="app.geo.module_LayerRecordFactory-ImageRecord.html#.parseData">parseData</a></li><li data-type='method'><a href="app.geo.module_LayerRecordFactory-ImageRecord.html#makeLayerBookmark">makeLayerBookmark</a></li></ul></li><li><a href="app.geo.module_LayerRecordFactory-LayerRecord.html">LayerRecord</a><ul class='methods'><li data-type='method'><a href="app.geo.module_LayerRecordFactory-LayerRecord.html#.parseData">parseData</a></li><li data-type='method'><a href="app.geo.module_LayerRecordFactory-LayerRecord.html#createBbox">createBbox</a></li><li data-type='method'><a href="app.geo.module_LayerRecordFactory-LayerRecord.html#destroyBbox">destroyBbox</a></li><li data-type='method'><a href="app.geo.module_LayerRecordFactory-LayerRecord.html#makeLayerBookmark">makeLayerBookmark</a></li></ul></li><li><a href="app.geo.module_LayerRecordFactory-LayerRecord.LayerRecord.html">LayerRecord</a></li><li><a href="app.geo.module_LayerRecordFactory-TileRecord.html">TileRecord</a><ul class='methods'><li data-type='method'><a href="app.geo.module_LayerRecordFactory-TileRecord.html#.parseData">parseData</a></li><li data-type='method'><a href="app.geo.module_LayerRecordFactory-TileRecord.html#makeLayerBookmark">makeLayerBookmark</a></li></ul></li><li><a href="app.geo.module_LayerRecordFactory-WmsRecord.html">WmsRecord</a><ul class='methods'><li data-type='method'><a href="app.geo.module_LayerRecordFactory-WmsRecord.html#.parseData">parseData</a></li><li data-type='method'><a href="app.geo.module_LayerRecordFactory-WmsRecord.html#makeLayerBookmark">makeLayerBookmark</a></li></ul></li><li><a href="app.ui.module_StepperFactory-Stepper.html">Stepper</a><ul class='methods'><li data-type='method'><a href="app.ui.module_StepperFactory-Stepper.html#_configureStep">_configureStep</a></li><li data-type='method'><a href="app.ui.module_StepperFactory-Stepper.html#_reset">_reset</a></li><li data-type='method'><a href="app.ui.module_StepperFactory-Stepper.html#_think">_think</a></li><li data-type='method'><a href="app.ui.module_StepperFactory-Stepper.html#addSteps">addSteps</a></li><li data-type='method'><a href="app.ui.module_StepperFactory-Stepper.html#cancelMove">cancelMove</a></li><li data-type='method'><a href="app.ui.module_StepperFactory-Stepper.html#moveToStep">moveToStep</a></li><li data-type='method'><a href="app.ui.module_StepperFactory-Stepper.html#nextStep">nextStep</a></li><li data-type='method'><a href="app.ui.module_StepperFactory-Stepper.html#previousStep">previousStep</a></li><li data-type='method'><a href="app.ui.module_StepperFactory-Stepper.html#reset">reset</a></li><li data-type='method'><a href="app.ui.module_StepperFactory-Stepper.html#start">start</a></li></ul></li></ul><h3>Modules</h3><ul><li><a href="app.common.module_displayManager.html">app.common.displayManager</a><ul class='methods'><li data-type='method'><a href="app.common.module_displayManager.html#~clearDisplayPanel">clearDisplayPanel</a></li><li data-type='method'><a href="app.common.module_displayManager.html#~setDisplay">setDisplay</a></li><li data-type='method'><a href="app.common.module_displayManager.html#~toggleDisplayPanel">toggleDisplayPanel</a></li></ul></li><li><a href="app.common.module_stateManager.html">app.common.stateManager</a><ul class='methods'><li data-type='method'><a href="app.common.module_stateManager.html#~addState">addState</a></li><li data-type='method'><a href="app.common.module_stateManager.html#~callback">callback</a></li><li data-type='method'><a href="app.common.module_stateManager.html#~closePanel">closePanel</a></li><li data-type='method'><a href="app.common.module_stateManager.html#~closePanelFromHistory">closePanelFromHistory</a></li><li data-type='method'><a href="app.common.module_stateManager.html#~getChildren">getChildren</a></li><li data-type='method'><a href="app.common.module_stateManager.html#~getItem">getItem</a></li><li data-type='method'><a href="app.common.module_stateManager.html#~getParent">getParent</a></li><li data-type='method'><a href="app.common.module_stateManager.html#~modifyHistory">modifyHistory</a></li><li data-type='method'><a href="app.common.module_stateManager.html#~onCloseCallback">onCloseCallback</a></li><li data-type='method'><a href="app.common.module_stateManager.html#~openPanel">openPanel</a></li><li data-type='method'><a href="app.common.module_stateManager.html#~runCloseCallback">runCloseCallback</a></li><li data-type='method'><a href="app.common.module_stateManager.html#~setActive">setActive</a></li><li data-type='method'><a href="app.common.module_stateManager.html#~setItemProperty">setItemProperty</a></li><li data-type='method'><a href="app.common.module_stateManager.html#~setMorph">setMorph</a></li><li data-type='method'><a href="app.common.module_stateManager.html#~togglePanel">togglePanel</a></li></ul></li><li><a href="app.core.module_common.html">app.core.common</a></li><li><a href="app.core.module_configService.html">app.core.configService</a><ul class='methods'><li data-type='method'><a href="app.core.module_configService.html#~currentLang">currentLang</a></li><li data-type='method'><a href="app.core.module_configService.html#~fileInit">fileInit</a></li><li data-type='method'><a href="app.core.module_configService.html#~getCurrent">getCurrent</a></li><li data-type='method'><a href="app.core.module_configService.html#~getOriginal">getOriginal</a></li><li data-type='method'><a href="app.core.module_configService.html#~initialize">initialize</a></li><li data-type='method'><a href="app.core.module_configService.html#~mergeConfigParts">mergeConfigParts</a></li><li data-type='method'><a href="app.core.module_configService.html#~rcsAddKeys">rcsAddKeys</a></li><li data-type='method'><a href="app.core.module_configService.html#~rcsInit">rcsInit</a></li><li data-type='method'><a href="app.core.module_configService.html#~rcsLoad">rcsLoad</a></li><li data-type='method'><a href="app.core.module_configService.html#~ready">ready</a></li><li data-type='method'><a href="app.core.module_configService.html#~setCurrent">setCurrent</a></li></ul></li><li><a href="app.geo.module_gapiService.html">app.geo.gapiService</a><ul class='methods'><li data-type='method'><a href="app.geo.module_gapiService.html#~init">init</a></li></ul></li><li><a href="app.geo.module_Geo.html">app.geo.Geo</a></li><li><a href="app.geo.module_geoService.html">app.geo.geoService</a><ul class='methods'><li data-type='method'><a href="app.geo.module_geoService.html#~assembleMap">assembleMap</a></li><li data-type='method'><a href="app.geo.module_geoService.html#~epsgLookup">epsgLookup</a></li></ul></li><li><a href="app.geo.module_identifyService.html">app.geo.identifyService</a><ul class='methods'><li data-type='method'><a href="app.geo.module_identifyService.html#~attributesToDetails">attributesToDetails</a></li><li data-type='method'><a href="app.geo.module_identifyService.html#~clickHandlerBuilder">clickHandlerBuilder</a></li><li data-type='method'><a href="app.geo.module_identifyService.html#~getFeatureName">getFeatureName</a></li><li data-type='method'><a href="app.geo.module_identifyService.html#~identifyEsriDynamicLayer">identifyEsriDynamicLayer</a></li><li data-type='method'><a href="app.geo.module_identifyService.html#~identifyEsriFeatureLayer">identifyEsriFeatureLayer</a></li><li data-type='method'><a href="app.geo.module_identifyService.html#~identifyOgcWmsLayer">identifyOgcWmsLayer</a></li><li data-type='method'><a href="app.geo.module_identifyService.html#~init">init</a></li><li data-type='method'><a href="app.geo.module_identifyService.html#~makeInfalliblePromise">makeInfalliblePromise</a></li><li data-type='method'><a href="app.geo.module_identifyService.html#~unAliasAttribs">unAliasAttribs</a></li></ul></li><li><a href="app.geo.module_LayerBlueprintFactory.html">app.geo.LayerBlueprintFactory</a></li><li><a href="app.geo.module_LayerBlueprintUserOptions.html">app.geo.LayerBlueprintUserOptions</a></li><li><a href="app.geo.module_LayerRecordFactory.html">app.geo.LayerRecordFactory</a><ul class='methods'><li data-type='method'><a href="app.geo.module_LayerRecordFactory.html#~makeFileRecord">makeFileRecord</a></li><li data-type='method'><a href="app.geo.module_LayerRecordFactory.html#~makeServiceRecord">makeServiceRecord</a></li><li data-type='method'><a href="app.geo.module_LayerRecordFactory.html#~parseLayerData">parseLayerData</a></li></ul></li><li><a href="app.geo.module_layerRegistry.html">app.geo.layerRegistry</a><ul class='methods'><li data-type='method'><a href="app.geo.module_layerRegistry.html#~_refactorIsLayerInMapStack">_refactorIsLayerInMapStack</a></li><li data-type='method'><a href="app.geo.module_layerRegistry.html#~_testSyncCheck">_testSyncCheck</a></li><li data-type='method'><a href="app.geo.module_layerRegistry.html#~aliasedFieldName">aliasedFieldName</a></li><li data-type='method'><a href="app.geo.module_layerRegistry.html#~checkDateType">checkDateType</a></li><li data-type='method'><a href="app.geo.module_layerRegistry.html#~constructLayers">constructLayers</a></li><li data-type='method'><a href="app.geo.module_layerRegistry.html#~extentChangeHandler">extentChangeHandler</a></li><li data-type='method'><a href="app.geo.module_layerRegistry.html#~getAllQueryableLayerRecords">getAllQueryableLayerRecords</a></li><li data-type='method'><a href="app.geo.module_layerRegistry.html#~getLayerInsertPosition">getLayerInsertPosition</a></li><li data-type='method'><a href="app.geo.module_layerRegistry.html#~getLayerMapIndex">getLayerMapIndex</a></li><li data-type='method'><a href="app.geo.module_layerRegistry.html#~getLayersByType">getLayersByType</a></li><li data-type='method'><a href="app.geo.module_layerRegistry.html#~getRcsLayerIDs">getRcsLayerIDs</a></li><li data-type='method'><a href="app.geo.module_layerRegistry.html#~isOffScale">isOffScale</a></li><li data-type='method'><a href="app.geo.module_layerRegistry.html#~makeScaleSet">makeScaleSet</a></li><li data-type='method'><a href="app.geo.module_layerRegistry.html#~moveLayer">moveLayer</a></li><li data-type='method'><a href="app.geo.module_layerRegistry.html#~registerLayerRecord">registerLayerRecord</a></li><li data-type='method'><a href="app.geo.module_layerRegistry.html#~reloadLayer">reloadLayer</a></li><li data-type='method'><a href="app.geo.module_layerRegistry.html#~removeLayer">removeLayer</a></li><li data-type='method'><a href="app.geo.module_layerRegistry.html#~setBboxState">setBboxState</a></li><li data-type='method'><a href="app.geo.module_layerRegistry.html#~setScaleDepState">setScaleDepState</a></li><li data-type='method'><a href="app.geo.module_layerRegistry.html#~snapshotLayer">snapshotLayer</a></li><li data-type='method'><a href="app.geo.module_layerRegistry.html#~zoomToBoundary">zoomToBoundary</a></li><li data-type='method'><a href="app.geo.module_layerRegistry.html#~zoomToScale">zoomToScale</a></li></ul></li><li><a href="app.geo.module_legendEntryFactory.html">app.geo.legendEntryFactory</a></li><li><a href="app.geo.module_legendService.html">app.geo.legendService</a><ul class='methods'><li data-type='method'><a href="app.geo.module_legendService.html#~addLayer">addLayer</a></li><li data-type='method'><a href="app.geo.module_legendService.html#~addPlaceholder">addPlaceholder</a></li><li data-type='method'><a href="app.geo.module_legendService.html#~applyFeatureCount">applyFeatureCount</a></li><li data-type='method'><a href="app.geo.module_legendService.html#~applySymbology">applySymbology</a></li><li data-type='method'><a href="app.geo.module_legendService.html#~autoLegendService">autoLegendService</a></li><li data-type='method'><a href="app.geo.module_legendService.html#~dynamicGenerator">dynamicGenerator</a></li><li data-type='method'><a href="app.geo.module_legendService.html#~featureGenerator">featureGenerator</a></li><li data-type='method'><a href="app.geo.module_legendService.html#~getServiceFeatureCount">getServiceFeatureCount</a></li><li data-type='method'><a href="app.geo.module_legendService.html#~imageGenerator">imageGenerator</a></li><li data-type='method'><a href="app.geo.module_legendService.html#~tileGenerator">tileGenerator</a></li><li data-type='method'><a href="app.geo.module_legendService.html#~wmsGenerator">wmsGenerator</a></li></ul></li><li><a href="app.geo.module_locateService.html">app.geo.locateService</a><ul class='methods'><li data-type='method'><a href="app.geo.module_locateService.html#~_apiLocate">_apiLocate</a></li><li data-type='method'><a href="app.geo.module_locateService.html#~_browserLocate">_browserLocate</a></li><li data-type='method'><a href="app.geo.module_locateService.html#~find">find</a></li></ul></li><li><a href="app.geo.module_mapService.html">app.geo.mapService</a><ul class='methods'><li data-type='method'><a href="app.geo.module_mapService.html#~applyHilight">applyHilight</a></li><li data-type='method'><a href="app.geo.module_mapService.html#~baseMapHasSameSP">baseMapHasSameSP</a></li><li data-type='method'><a href="app.geo.module_mapService.html#~buildMapObject">buildMapObject</a></li><li data-type='method'><a href="app.geo.module_mapService.html#~clearHilight">clearHilight</a></li><li data-type='method'><a href="app.geo.module_mapService.html#~dropMapPin">dropMapPin</a></li><li data-type='method'><a href="app.geo.module_mapService.html#~fetchGraphic">fetchGraphic</a></li><li data-type='method'><a href="app.geo.module_mapService.html#~findClosestLOD">findClosestLOD</a></li><li data-type='method'><a href="app.geo.module_mapService.html#~geolocate">geolocate</a></li><li data-type='method'><a href="app.geo.module_mapService.html#~getBaseMapConfig">getBaseMapConfig</a></li><li data-type='method'><a href="app.geo.module_mapService.html#~getDefaultExtFromExtentSets">getDefaultExtFromExtentSets</a></li><li data-type='method'><a href="app.geo.module_mapService.html#~getFullExtFromExtentSets">getFullExtFromExtentSets</a></li><li data-type='method'><a href="app.geo.module_mapService.html#~getLod">getLod</a></li><li data-type='method'><a href="app.geo.module_mapService.html#~hideBaseMap">hideBaseMap</a></li><li data-type='method'><a href="app.geo.module_mapService.html#~hilightGraphic">hilightGraphic</a></li><li data-type='method'><a href="app.geo.module_mapService.html#~prepMapLoad">prepMapLoad</a></li><li data-type='method'><a href="app.geo.module_mapService.html#~retrieveSymbol">retrieveSymbol</a></li><li data-type='method'><a href="app.geo.module_mapService.html#~selectBasemap">selectBasemap</a></li><li data-type='method'><a href="app.geo.module_mapService.html#~setFullExtent">setFullExtent</a></li><li data-type='method'><a href="app.geo.module_mapService.html#~setMapLoadingFlag">setMapLoadingFlag</a></li><li data-type='method'><a href="app.geo.module_mapService.html#~setSelectedBaseMap">setSelectedBaseMap</a></li><li data-type='method'><a href="app.geo.module_mapService.html#~setZoom">setZoom</a></li><li data-type='method'><a href="app.geo.module_mapService.html#~shiftZoom">shiftZoom</a></li><li data-type='method'><a href="app.geo.module_mapService.html#~zoomToGraphic">zoomToGraphic</a></li><li data-type='method'><a href="app.geo.module_mapService.html#~zoomWithOffset">zoomWithOffset</a></li></ul></li><li><a href="app.geo.module_metadataService.html">app.geo.metadataService</a><ul class='methods'><li data-type='method'><a href="app.geo.module_metadataService.html#.transformXml">transformXml</a></li><li data-type='method'><a href="app.geo.module_metadataService.html#~applyXSLT">applyXSLT</a></li><li data-type='method'><a href="app.geo.module_metadataService.html#~loadXmlFile">loadXmlFile</a></li></ul></li><li><a href="app.geo.module_rvInitMap.html">app.geo.rvInitMap</a><ul class='methods'><li data-type='method'><a href="app.geo.module_rvInitMap.html#~animate">animate</a></li><li data-type='method'><a href="app.geo.module_rvInitMap.html#~keyDownDetected">keyDownDetected</a></li><li data-type='method'><a href="app.geo.module_rvInitMap.html#~keyUpDetected">keyUpDetected</a></li></ul></li><li><a href="app.geo.module_rvOverviewToggle.html">app.geo.rvOverviewToggle</a><ul class='methods'><li data-type='method'><a href="app.geo.module_rvOverviewToggle.html#~animate">animate</a></li><li data-type='method'><a href="app.geo.module_rvOverviewToggle.html#~animationCompleted">animationCompleted</a></li><li data-type='method'><a href="app.geo.module_rvOverviewToggle.html#~toggleOverview">toggleOverview</a></li></ul></li><li><a href="app.layout.module_focusService.html">app.layout.focusService</a><ul class='methods'><li data-type='method'><a href="app.layout.module_focusService.html#~activeDocumentFocusin">activeDocumentFocusin</a></li><li data-type='method'><a href="app.layout.module_focusService.html#~activeDocumentFocusout">activeDocumentFocusout</a></li><li data-type='method'><a href="app.layout.module_focusService.html#~activeDocumentKeydown">activeDocumentKeydown</a></li><li data-type='method'><a href="app.layout.module_focusService.html#~createLink">createLink</a></li><li data-type='method'><a href="app.layout.module_focusService.html#~findNextFocusable">findNextFocusable</a></li><li data-type='method'><a href="app.layout.module_focusService.html#~findPrevFocusable">findPrevFocusable</a></li><li data-type='method'><a href="app.layout.module_focusService.html#~inactiveFocusin">inactiveFocusin</a></li><li data-type='method'><a href="app.layout.module_focusService.html#~previousFocus">previousFocus</a></li><li data-type='method'><a href="app.layout.module_focusService.html#~restore">restore</a></li><li data-type='method'><a href="app.layout.module_focusService.html#~setFocus">setFocus</a></li><li data-type='method'><a href="app.layout.module_focusService.html#~setFocusElement">setFocusElement</a></li><li data-type='method'><a href="app.layout.module_focusService.html#~setFocusOnList">setFocusOnList</a></li><li data-type='method'><a href="app.layout.module_focusService.html#~setPanelFocus">setPanelFocus</a></li><li data-type='method'><a href="app.layout.module_focusService.html#~setStatus">setStatus</a></li><li data-type='method'><a href="app.layout.module_focusService.html#~status">status</a></li><li data-type='method'><a href="app.layout.module_focusService.html#~waitingKeydown">waitingKeydown</a></li></ul></li><li><a href="app.layout.module_layoutService.html">app.layout.layoutService</a></li><li><a href="app.layout.module_rvShell.html">app.layout.rvShell</a></li><li><a href="app.layout.module_storageService.html">app.layout.storageService</a></li><li><a href="app.module_core.html">app.core</a><ul class='methods'><li data-type='method'><a href="app.module_core.html#~addRcsConfigs">addRcsConfigs</a></li><li data-type='method'><a href="app.module_core.html#~decode64">decode64</a></li><li data-type='method'><a href="app.module_core.html#~encode64">encode64</a></li><li data-type='method'><a href="app.module_core.html#~filterConfigLayers">filterConfigLayers</a></li><li data-type='method'><a href="app.module_core.html#~getBookmark">getBookmark</a></li><li data-type='method'><a href="app.module_core.html#~loadNewLang">loadNewLang</a></li><li data-type='method'><a href="app.module_core.html#~loadNewProjection">loadNewProjection</a></li><li data-type='method'><a href="app.module_core.html#~loadWithBookmark">loadWithBookmark</a></li><li data-type='method'><a href="app.module_core.html#~modifyRcsKeyList">modifyRcsKeyList</a></li><li data-type='method'><a href="app.module_core.html#~parseBookmark">parseBookmark</a></li><li data-type='method'><a href="app.module_core.html#~parseLayers">parseLayers</a></li><li data-type='method'><a href="app.module_core.html#~registerDebounce">registerDebounce</a></li></ul></li><li><a href="app.module_ui.html">app.ui</a><ul class='methods'><li data-type='method'><a href="app.module_ui.html#~closeLoaderService">closeLoaderService</a></li><li data-type='method'><a href="app.module_ui.html#~configureOnContinue">configureOnContinue</a></li><li data-type='method'><a href="app.module_ui.html#~configureReset">configureReset</a></li><li data-type='method'><a href="app.module_ui.html#~connectOnContinue">connectOnContinue</a></li><li data-type='method'><a href="app.module_ui.html#~connectReset">connectReset</a></li><li data-type='method'><a href="app.module_ui.html#~onCancel">onCancel</a></li><li data-type='method'><a href="app.module_ui.html#~selectOnContinue">selectOnContinue</a></li><li data-type='method'><a href="app.module_ui.html#~serviceUrlResetValidation">serviceUrlResetValidation</a></li><li data-type='method'><a href="app.module_ui.html#~toggleErrorMessage">toggleErrorMessage</a></li></ul></li><li><a href="app.ui.basemap.module_rvBasemap.html">app.ui.basemap.rvBasemap</a></li><li><a href="app.ui.module_basemapService.html">app.ui.basemapService</a><ul class='methods'><li data-type='method'><a href="app.ui.module_basemapService.html#~_addBaseMaps">_addBaseMaps</a></li><li data-type='method'><a href="app.ui.module_basemapService.html#~_normalizeBasemap">_normalizeBasemap</a></li><li data-type='method'><a href="app.ui.module_basemapService.html#~getSelected">getSelected</a></li><li data-type='method'><a href="app.ui.module_basemapService.html#~reload">reload</a></li><li data-type='method'><a href="app.ui.module_basemapService.html#~select">select</a></li><li data-type='method'><a href="app.ui.module_basemapService.html#~setOnChangeCallback">setOnChangeCallback</a></li></ul></li><li><a href="app.ui.module_common.html">app.ui.common</a></li><li><a href="app.ui.module_errorService.html">app.ui.errorService</a><ul class='methods'><li data-type='method'><a href="app.ui.module_errorService.html#~display">display</a></li><li data-type='method'><a href="app.ui.module_errorService.html#~remove">remove</a></li></ul></li><li><a href="app.ui.module_filterService.html">app.ui.filterService</a><ul class='methods'><li data-type='method'><a href="app.ui.module_filterService.html#~filteredState">filteredState</a></li><li data-type='method'><a href="app.ui.module_filterService.html#~init">init</a></li><li data-type='method'><a href="app.ui.module_filterService.html#~onCreate">onCreate</a></li><li data-type='method'><a href="app.ui.module_filterService.html#~onDestroy">onDestroy</a></li><li data-type='method'><a href="app.ui.module_filterService.html#~onExtentChange">onExtentChange</a></li><li data-type='method'><a href="app.ui.module_filterService.html#~queryMapserver">queryMapserver</a></li><li data-type='method'><a href="app.ui.module_filterService.html#~queryURL">queryURL</a></li><li data-type='method'><a href="app.ui.module_filterService.html#~setActive">setActive</a></li></ul></li><li><a href="app.ui.module_fullScreenService.html">app.ui.fullScreenService</a><ul class='methods'><li data-type='method'><a href="app.ui.module_fullScreenService.html#~onComplete">onComplete</a></li><li data-type='method'><a href="app.ui.module_fullScreenService.html#~toggle">toggle</a></li></ul></li><li><a href="app.ui.module_helpService.html">app.ui.helpService</a><ul class='methods'><li data-type='method'><a href="app.ui.module_helpService.html#~clearDrawn">clearDrawn</a></li><li data-type='method'><a href="app.ui.module_helpService.html#~register">register</a></li><li data-type='method'><a href="app.ui.module_helpService.html#~setDrawn">setDrawn</a></li><li data-type='method'><a href="app.ui.module_helpService.html#~unregister">unregister</a></li></ul></li><li><a href="app.ui.module_mapNavigationService.html">app.ui.mapNavigationService</a><ul class='methods'><li data-type='method'><a href="app.ui.module_mapNavigationService.html#~mapNavigationService">mapNavigationService</a></li></ul></li><li><a href="app.ui.module_rvAppbar.html">app.ui.rvAppbar</a><ul class='methods'><li data-type='method'><a href="app.ui.module_rvAppbar.html#~rvAppbar">rvAppbar</a></li></ul></li><li><a href="app.ui.module_rvBasemapItem.html">app.ui.rvBasemapItem</a></li><li><a href="app.ui.module_rvContentPane.html">app.ui.rvContentPane</a><ul class='methods'><li data-type='method'><a href="app.ui.module_rvContentPane.html#~addHeaderControl">addHeaderControl</a></li><li data-type='method'><a href="app.ui.module_rvContentPane.html#~link">link</a></li><li data-type='method'><a href="app.ui.module_rvContentPane.html#~rvContentPane">rvContentPane</a></li></ul></li><li><a href="app.ui.module_rvDetails.html">app.ui.rvDetails</a><ul class='methods'><li data-type='method'><a href="app.ui.module_rvDetails.html#~closeDetails">closeDetails</a></li><li data-type='method'><a href="app.ui.module_rvDetails.html#~getSelectedItem">getSelectedItem</a></li><li data-type='method'><a href="app.ui.module_rvDetails.html#~selectItem">selectItem</a></li></ul></li><li><a href="app.ui.module_rvDetailsContent.html">app.ui.rvDetailsContent</a><ul class='methods'><li data-type='method'><a href="app.ui.module_rvDetailsContent.html#~rvDetailsContent">rvDetailsContent</a></li></ul></li><li><a href="app.ui.module_rvDetailsExpand.html">app.ui.rvDetailsExpand</a><ul class='methods'><li data-type='method'><a href="app.ui.module_rvDetailsExpand.html#~rvDetailsExpand">rvDetailsExpand</a></li></ul></li><li><a href="app.ui.module_rvDetailsRecordEsrifeature.html">app.ui.rvDetailsRecordEsrifeature</a><ul class='methods'><li data-type='method'><a href="app.ui.module_rvDetailsRecordEsrifeature.html#~renderDetails">renderDetails</a></li><li data-type='method'><a href="app.ui.module_rvDetailsRecordEsrifeature.html#~toggleDetails">toggleDetails</a></li><li data-type='method'><a href="app.ui.module_rvDetailsRecordEsrifeature.html#~zoomToFeature">zoomToFeature</a></li></ul></li><li><a href="app.ui.module_rvDetailsRecordHtml.html">app.ui.rvDetailsRecordHtml</a></li><li><a href="app.ui.module_rvDetectScrollbar.html">app.ui.rvDetectScrollbar</a></li><li><a href="app.ui.module_rvDragula.html">app.ui.rvDragula</a></li><li><a href="app.ui.module_rvFiltersDefault.html">app.ui.rvFiltersDefault</a><ul class='methods'><li data-type='method'><a href="app.ui.module_rvFiltersDefault.html#~addColumnInteractivity">addColumnInteractivity</a></li><li data-type='method'><a href="app.ui.module_rvFiltersDefault.html#~Controller">Controller</a></li><li data-type='method'><a href="app.ui.module_rvFiltersDefault.html#~createTable">createTable</a></li><li data-type='method'><a href="app.ui.module_rvFiltersDefault.html#~destroyTable">destroyTable</a></li><li data-type='method'><a href="app.ui.module_rvFiltersDefault.html#~getDToLang">getDToLang</a></li><li data-type='method'><a href="app.ui.module_rvFiltersDefault.html#~link">link</a></li><li data-type='method'><a href="app.ui.module_rvFiltersDefault.html#~onDetailsClick">onDetailsClick</a></li><li data-type='method'><a href="app.ui.module_rvFiltersDefault.html#~onTableDraw">onTableDraw</a></li><li data-type='method'><a href="app.ui.module_rvFiltersDefault.html#~onTableInit">onTableInit</a></li><li data-type='method'><a href="app.ui.module_rvFiltersDefault.html#~onZoomClick">onZoomClick</a></li><li data-type='method'><a href="app.ui.module_rvFiltersDefault.html#~rvFiltersDefault">rvFiltersDefault</a></li><li data-type='method'><a href="app.ui.module_rvFiltersDefault.html#~setDToLang">setDToLang</a></li><li data-type='method'><a href="app.ui.module_rvFiltersDefault.html#~triggerTableButton">triggerTableButton</a></li></ul></li><li><a href="app.ui.module_rvFiltersDefaultMenu.html">app.ui.rvFiltersDefaultMenu</a><ul class='methods'><li data-type='method'><a href="app.ui.module_rvFiltersDefaultMenu.html#~dataExportCSVTODO:eschewevents;neededheresinceit'sveryhardtocommunicatewithmainfiltersdirective;angular1.5shouldsolveitusingdirectiveswithmultipletransclusions">dataExportCSV
TODO: eschew events; needed here since it's very hard to communicate with main filters directive; angular 1.5 should solve it using directives with multiple transclusions</a></li><li data-type='method'><a href="app.ui.module_rvFiltersDefaultMenu.html#~dataPrintTODO:eschewevents;neededheresinceit'sveryhardtocommunicatewithmainfiltersdirective;angular1.5shouldsolveitusingdirectiveswithmultipletransclusions">dataPrint
TODO: eschew events; needed here since it's very hard to communicate with main filters directive; angular 1.5 should solve it using directives with multiple transclusions</a></li></ul></li><li><a href="app.ui.module_rvFiltersPanel.html">app.ui.rvFiltersPanel</a><ul class='methods'><li data-type='method'><a href="app.ui.module_rvFiltersPanel.html#~closePanelFIXME:thisshouldbehandledintheshatehelper">closePanel
FIXME: this should be handled in the shatehelper</a></li><li data-type='method'><a href="app.ui.module_rvFiltersPanel.html#~Controller">Controller</a></li><li data-type='method'><a href="app.ui.module_rvFiltersPanel.html#~rvPanel">rvPanel</a></li></ul></li><li><a href="app.ui.module_rvHelpOverlay.html">app.ui.rvHelpOverlay</a><ul class='methods'><li data-type='method'><a href="app.ui.module_rvHelpOverlay.html#~draw">draw</a></li><li data-type='method'><a href="app.ui.module_rvHelpOverlay.html#~overlap">overlap</a></li><li data-type='method'><a href="app.ui.module_rvHelpOverlay.html#~shouldBeDrawn">shouldBeDrawn</a></li></ul></li><li><a href="app.ui.module_rvLayerItemSymbology.html">app.ui.rvLayerItemSymbology</a><ul class='methods'><li data-type='method'><a href="app.ui.module_rvLayerItemSymbology.html#~getTextWidth">getTextWidth</a></li><li data-type='method'><a href="app.ui.module_rvLayerItemSymbology.html#~iconLegendItem">iconLegendItem</a></li><li data-type='method'><a href="app.ui.module_rvLayerItemSymbology.html#~imageLegendItem">imageLegendItem</a></li></ul></li><li><a href="app.ui.module_rvLayerListSlider.html">app.ui.rvLayerListSlider</a><ul class='methods'><li data-type='method'><a href="app.ui.module_rvLayerListSlider.html#~animateClosed">animateClosed</a></li><li data-type='method'><a href="app.ui.module_rvLayerListSlider.html#~animateOpen">animateOpen</a></li><li data-type='method'><a href="app.ui.module_rvLayerListSlider.html#~itemSelectedByKeypress">itemSelectedByKeypress</a></li><li data-type='method'><a href="app.ui.module_rvLayerListSlider.html#~itemSelectedByMouse">itemSelectedByMouse</a></li></ul></li><li><a href="app.ui.module_rvLoaderFile.html">app.ui.rvLoaderFile</a><ul class='methods'><li data-type='method'><a href="app.ui.module_rvLoaderFile.html#~closeLoaderFile">closeLoaderFile</a></li><li data-type='method'><a href="app.ui.module_rvLoaderFile.html#~configureOnContinue">configureOnContinue</a></li><li data-type='method'><a href="app.ui.module_rvLoaderFile.html#~fileReset">fileReset</a></li><li data-type='method'><a href="app.ui.module_rvLoaderFile.html#~fileResetValidation">fileResetValidation</a></li><li data-type='method'><a href="app.ui.module_rvLoaderFile.html#~fileUrlReset">fileUrlReset</a></li><li data-type='method'><a href="app.ui.module_rvLoaderFile.html#~fileUrlResetValidation">fileUrlResetValidation</a></li><li data-type='method'><a href="app.ui.module_rvLoaderFile.html#~onCancel">onCancel</a></li><li data-type='method'><a href="app.ui.module_rvLoaderFile.html#~onLayerBlueprintReady">onLayerBlueprintReady</a></li><li data-type='method'><a href="app.ui.module_rvLoaderFile.html#~selectOnContinue">selectOnContinue</a></li><li data-type='method'><a href="app.ui.module_rvLoaderFile.html#~selectReset">selectReset</a></li><li data-type='method'><a href="app.ui.module_rvLoaderFile.html#~selectReset">selectReset</a></li><li data-type='method'><a href="app.ui.module_rvLoaderFile.html#~selectResetValidation">selectResetValidation</a></li><li data-type='method'><a href="app.ui.module_rvLoaderFile.html#~selectResetValidation">selectResetValidation</a></li><li data-type='method'><a href="app.ui.module_rvLoaderFile.html#~toggleErrorMessage">toggleErrorMessage</a></li><li data-type='method'><a href="app.ui.module_rvLoaderFile.html#~updateProgress">updateProgress</a></li><li data-type='method'><a href="app.ui.module_rvLoaderFile.html#~uploadFilesSubmitted">uploadFilesSubmitted</a></li><li data-type='method'><a href="app.ui.module_rvLoaderFile.html#~uploadOnContinue">uploadOnContinue</a></li><li data-type='method'><a href="app.ui.module_rvLoaderFile.html#~uploadReset">uploadReset</a></li></ul></li><li><a href="app.ui.module_rvLoaderMenu.html">app.ui.rvLoaderMenu</a></li><li><a href="app.ui.module_rvMapnav.html">app.ui.rvMapnav</a></li><li><a href="app.ui.module_rvMapnavButton.html">app.ui.rvMapnavButton</a><ul class='methods'><li data-type='method'><a href="app.ui.module_rvMapnavButton.html#~rvMapnavButton">rvMapnavButton</a></li></ul></li><li><a href="app.ui.module_rvMenuLink.html">app.ui.rvMenuLink</a></li><li><a href="app.ui.module_rvMetadataContent.html">app.ui.rvMetadataContent</a><ul class='methods'><li data-type='method'><a href="app.ui.module_rvMetadataContent.html#~rvMetadataContent">rvMetadataContent</a></li></ul></li><li><a href="app.ui.module_rvMetadataExpand.html">app.ui.rvMetadataExpand</a><ul class='methods'><li data-type='method'><a href="app.ui.module_rvMetadataExpand.html#~rvMetadataExpand">rvMetadataExpand</a></li></ul></li><li><a href="app.ui.module_rvMetadataPanel.html">app.ui.rvMetadataPanel</a><ul class='methods'><li data-type='method'><a href="app.ui.module_rvMetadataPanel.html#~rvMetadataPanel">rvMetadataPanel</a></li></ul></li><li><a href="app.ui.module_rvMorph.html">app.ui.rvMorph</a><ul class='methods'><li data-type='method'><a href="app.ui.module_rvMorph.html#~linkFunc">linkFunc</a></li><li data-type='method'><a href="app.ui.module_rvMorph.html#~rvMorph">rvMorph</a></li></ul></li><li><a href="app.ui.module_rvPlugSlide.html">app.ui.rvPlugSlide</a><ul class='methods'><li data-type='method'><a href="app.ui.module_rvPlugSlide.html#~animationBuilder">animationBuilder</a></li><li data-type='method'><a href="app.ui.module_rvPlugSlide.html#~buildTween">buildTween</a></li><li data-type='method'><a href="app.ui.module_rvPlugSlide.html#~calculateShift">calculateShift</a></li><li data-type='method'><a href="app.ui.module_rvPlugSlide.html#~cleanup">cleanup</a></li><li data-type='method'><a href="app.ui.module_rvPlugSlide.html#~deltaHelper">deltaHelper</a></li><li data-type='method'><a href="app.ui.module_rvPlugSlide.html#~getPanelSize">getPanelSize</a></li><li data-type='method'><a href="app.ui.module_rvPlugSlide.html#~makeFadeAnim">makeFadeAnim</a></li><li data-type='method'><a href="app.ui.module_rvPlugSlide.html#~makeSlideAnim">makeSlideAnim</a></li><li data-type='method'><a href="app.ui.module_rvPlugSlide.html#~ngShowHideWrapper">ngShowHideWrapper</a></li></ul></li><li><a href="app.ui.module_rvReverse.html">app.ui.rvReverse</a></li><li><a href="app.ui.module_rvSettings.html">app.ui.rvSettings</a><ul class='methods'><li data-type='method'><a href="app.ui.module_rvSettings.html#~rvSettings">rvSettings</a></li><li data-type='method'><a href="app.ui.module_rvSettings.html#~toggleQuery">toggleQuery</a></li></ul></li><li><a href="app.ui.module_rvStepperItem.html">app.ui.rvStepperItem</a><ul class='methods'><li data-type='method'><a href="app.ui.module_rvStepperItem.html#~onCancelBefore">onCancelBefore</a></li></ul></li><li><a href="app.ui.module_rvToc.html">app.ui.rvToc</a></li><li><a href="app.ui.module_rvTocEntry.html">app.ui.rvTocEntry</a><ul class='methods'><li data-type='method'><a href="app.ui.module_rvTocEntry.html#~link">link</a></li></ul></li><li><a href="app.ui.module_rvTocEntryControl.html">app.ui.rvTocEntryControl</a></li><li><a href="app.ui.module_rvTocEntryFlag.html">app.ui.rvTocEntryFlag</a></li><li><a href="app.ui.module_rvToggleSlide.html">app.ui.rvToggleSlide</a><ul class='methods'><li data-type='method'><a href="app.ui.module_rvToggleSlide.html#~getTargetHeight">getTargetHeight</a></li><li data-type='method'><a href="app.ui.module_rvToggleSlide.html#~ngShowHideBootstrap">ngShowHideBootstrap</a></li><li data-type='method'><a href="app.ui.module_rvToggleSlide.html#~toggleClose">toggleClose</a></li><li data-type='method'><a href="app.ui.module_rvToggleSlide.html#~toggleOpen">toggleOpen</a></li></ul></li><li><a href="app.ui.module_rvToolbox.html">app.ui.rvToolbox</a></li><li><a href="app.ui.module_rvTruncate.html">app.ui.rvTruncate</a><ul class='methods'><li data-type='method'><a href="app.ui.module_rvTruncate.html#~rvTruncate">rvTruncate</a></li></ul></li><li><a href="app.ui.module_sideNavigationService.html">app.ui.sideNavigationService</a><ul class='methods'><li data-type='method'><a href="app.ui.module_sideNavigationService.html#~close">close</a></li><li data-type='method'><a href="app.ui.module_sideNavigationService.html#~open">open</a></li><li data-type='method'><a href="app.ui.module_sideNavigationService.html#~toggle">toggle</a></li></ul></li><li><a href="app.ui.module_StepperFactory.html">app.ui.StepperFactory</a></li><li><a href="app.ui.module_tocService.html">app.ui.tocService</a><ul class='methods'><li data-type='method'><a href="app.ui.module_tocService.html#~removeLayer">removeLayer</a></li><li data-type='method'><a href="app.ui.module_tocService.html#~setTocEntrySelectedState">setTocEntrySelectedState</a></li><li data-type='method'><a href="app.ui.module_tocService.html#~toggleLayerFiltersPanel">toggleLayerFiltersPanel</a></li><li data-type='method'><a href="app.ui.module_tocService.html#~toggleLayerFiltersPanel">toggleLayerFiltersPanel</a></li><li data-type='method'><a href="app.ui.module_tocService.html#~toggleMetadata">toggleMetadata</a></li><li data-type='method'><a href="app.ui.module_tocService.html#~toggleSettings">toggleSettings</a></li><li data-type='method'><a href="app.ui.module_tocService.html#~watchPanelState">watchPanelState</a></li><li data-type='method'><a href="app.ui.module_tocService.html#~zoomLayerScale">zoomLayerScale</a></li><li data-type='method'><a href="app.ui.module_tocService.html#~zoomToBoundary">zoomToBoundary</a></li></ul></li><li><a href="material.components.icon.module_mdIconDirectiveDecorator.html">material.components.icon.mdIconDirectiveDecorator</a><ul class='methods'><li data-type='method'><a href="material.components.icon.module_mdIconDirectiveDecorator.html#~decorateCompile">decorateCompile</a></li></ul></li><li><a href="material.components.menuBar.module_mdMenuItemDirectiveDecorator.html">material.components.menuBar.mdMenuItemDirectiveDecorator</a><ul class='methods'><li data-type='method'><a href="material.components.menuBar.module_mdMenuItemDirectiveDecorator.html#~decorateCompile">decorateCompile</a></li></ul></li></ul><h3>Namespaces</h3><ul><li><a href="app.html">app</a></li><li><a href="app.html#.common">app.common</a></li><li><a href="app.core.html">app.core</a><ul class='methods'><li data-type='method'><a href="app.core.html#.apiBlock">apiBlock</a></li><li data-type='method'><a href="app.core.html#.configBlock">configBlock</a></li><li data-type='method'><a href="app.core.html#.debugBlock">debugBlock</a></li><li data-type='method'><a href="app.core.html#.runBlock">runBlock</a></li><li data-type='method'><a href="app.core.html#.seed">seed</a></li><li data-type='method'><a href="app.core.html#~configureIconsets">configureIconsets</a></li><li data-type='method'><a href="app.core.html#~configureTheme">configureTheme</a></li><li data-type='method'><a href="app.core.html#~configureTranslations">configureTranslations</a></li><li data-type='method'><a href="app.core.html#~loadRcsLayers">loadRcsLayers</a></li><li data-type='method'><a href="app.core.html#~setLanguage">setLanguage</a></li></ul></li><li><a href="app.geo.html">app.geo</a></li><li><a href="app.layout.html">app.layout</a></li><li><a href="app.ui.html">app.ui</a></li></ul><h3>Tutorials</h3><ul><li><a href="tutorial-getting_started.html">Getting Started</a></li><li><a href="tutorial-gulp-i18n-csv.html">Translation Plugin</a></li></ul><h3>Global</h3><ul><li><a href="global.html#attachEvents">attachEvents</a></li><li><a href="global.html#centerAndZoom">centerAndZoom</a></li><li><a href="global.html#detachEvents">detachEvents</a></li><li><a href="global.html#detectBlur">detectBlur</a></li><li><a href="global.html#detectFocus">detectFocus</a></li><li><a href="global.html#getBookmark">getBookmark</a></li><li><a href="global.html#initialBookmark">initialBookmark</a></li><li><a href="global.html#isSameActiveElement">isSameActiveElement</a></li><li><a href="global.html#preLoadApiBlock">preLoadApiBlock</a></li><li><a href="global.html#readyDelay">readyDelay</a></li><li><a href="global.html#restoreSession">restoreSession</a></li><li><a href="global.html#RV">RV</a></li><li><a href="global.html#start">start</a></li><li><a href="global.html#trackFocusBuilder">trackFocusBuilder</a></li><li><a href="global.html#useBookmark">useBookmark</a></li><li><a href="global.html#versionCheck">versionCheck</a></li></ul>
</nav>

<div id="main">
    
    <h1 class="page-title">geo/map.service.js</h1>
    

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>(() => {
    'use strict';

    /**
     * @module mapService
     * @memberof app.geo
     * @requires $q
     * @description
     *
     * The `mapService` factory holds references to the map dom node and the currently active map object.
     *
     */
    angular
        .module('app.geo')
        .factory('mapService', mapServiceFactory);

    function mapServiceFactory($q, $timeout, gapiService, storageService, $rootElement, $compile, $rootScope) {
        const settings = { zoomPromise: $q.resolve(), zoomCounter: 0 };
        return mapService;

        function mapService(geoState, config) {

            const initProps = ['fullExtent', 'mapExtent', 'lods', 'selectedBaseMapId',
                'selectedBaseMapExtentSetId', 'selectedBaseMapLodId', 'blankBaseMapId', 'hilight'];

            initProps.forEach(prop => {
                if (angular.isUndefined(geoState[prop])) {
                    geoState[prop] = null;
                }
            });

            const blankBaseMapIdPattern = 'blank_basemap_';

            // this `service` object will be exposed through `geoService`
            const service = {
                /**
                 * A reference to the main map object.  FIXME possible refactor
                 * @member mapObject
                 */
                mapObject: null,
                /**
                 * A reference to the geoApi mapManager instance.  FIXME possible refactor
                 * @member mapObject
                 */
                mapManager: null, // Object

                baseMapHasSameSP,
                setZoom,
                shiftZoom,
                selectBasemap,
                setFullExtent,
                setSelectedBaseMap,
                zoomToGraphic,
                validateProj,
                retrieveSymbol,
                hilightGraphic,
                clearHilight,
                dropMapPin,
                geolocate,
                findClosestLOD
            };

            return buildMapObject();

            /***/

            /**
             * Builds an actual esri map object.
             * @function buildMapObject
             * @private
             * @return {Object} returns `service` object
             */
            function buildMapObject() {

                let mapObject;

                // reset before rebuilding the map if `geoState` already has an instance of mapService
                if (typeof geoState.mapService !== 'undefined') {
                    // NOTE: Possible to have dom listeners stick around after the node is destroyed
                    const mapService = geoState.mapService;
                    mapService.mapObject.destroy();
                    mapService.mapManager.ScalebarControl.destroy();
                    mapService.mapManager.OverviewMapControl.destroy();
                    mapService.mapObject = null;
                }

                // set selected base map id
                setSelectedBaseMap(config.map.initialBasemapId || config.baseMaps[0].id, config);

                // FIXME remove the hardcoded settings when we have code which does this properly
                mapObject = gapiService.gapi.mapManager.Map(geoState.mapNode, {

                    // basemap: 'gray',
                    extent: geoState.mapExtent,
                    lods: geoState.lods
                });

                // store map object in service
                service.mapObject = mapObject;

                if (config.services &amp;&amp; config.services.proxyUrl) {
                    gapiService.gapi.mapManager.setProxy(config.services.proxyUrl);
                }

                // setup map using configs
                // FIXME: I should be migrated to the new config schema when geoApi is updated
                const mapSettings = {
                    basemaps: [],
                    scalebar: {},
                    overviewMap: {}
                };

                if (config.baseMaps) {
                    mapSettings.basemaps = config.baseMaps;
                }

                if (config.map.components.scaleBar) {
                    mapSettings.scalebar = {
                        attachTo: 'bottom-left',
                        scalebarUnit: 'dual'
                    };
                }

                if (config.map.components.overviewMap &amp;&amp; config.map.components.overviewMap.enabled) {

                    // FIXME: overviewMap has more settings
                    mapSettings.overviewMap = config.map.components.overviewMap;
                }

                const onMapLoad = prepMapLoad();

                service.mapManager = gapiService.gapi.mapManager.setupMap(mapObject, mapSettings);
                service.mapManager.BasemapControl.setBasemap(geoState.selectedBaseMapId);

                service.mapManager.BasemapControl.basemapGallery.on('selection-change', () => {
                    $rootElement.find('div.ovwContainer').append('&lt;rv-overview-toggle>&lt;/rv-overview-toggle>');
                    $compile($rootElement.find('rv-overview-toggle')[0])($rootScope);
                });

                if (config.map.initialBasemapId &amp;&amp; config.map.initialBasemapId.startsWith(blankBaseMapIdPattern)) {
                    hideBaseMap(true);
                }

                // FIXME temp link for debugging
                window.FGPV = {
                    layers: service.layers
                };

                // store service in geoState
                geoState.mapService = service;

                // return a promise that resolves in the service once the map has loaded
                return onMapLoad.then(() => service);
            }

            /**
             * Retrieve full extent from extentSets.
             * @function getFullExtFromExtentSets
             * @private
             */
            function getFullExtFromExtentSets(extentSets) {

                // FIXME: default basemap should be indicated in the config as well
                // const currentBasemapExtentSetId = '123456789';

                if (extentSets) {
                    // In configSchema, at least one extent for a basemap
                    const extentSetForId = extentSets.find(extentSet => {
                        if (extentSet.id === geoState.selectedBaseMapExtentSetId) {
                            return true;
                        }
                    });

                    // no matching id in the extentset
                    if (angular.isUndefined(extentSetForId)) {
                        throw new Error('could not find an extent set with matching id.');
                    }

                    // find the full extent type from extentSetForId
                    const lFullExtent = (extentSetForId.full) ? extentSetForId.full :
                        (extentSetForId.default) ? extentSetForId.default :
                        (extentSetForId.maximum) ? extentSetForId.maximum : null;

                    return lFullExtent;
                } else {
                    return null;
                }
            }

            /**
             * Retrieve default extent from extentSets.
             * @function getDefaultExtFromExtentSets
             * @private
             */
            function getDefaultExtFromExtentSets(extentSets) {
                // TODO: Need to handle cases where an extentset not defined
                return extentSets.find(extentSet => extentSet.id === geoState.selectedBaseMapExtentSetId)
                    .default;
            }

            /**
             * Retrieve level of details array from config for current basemap.
             * @function getLod
             * @private
             */
            function getLod(lodSets) {

                // In configSchema, at least one extent for a basemap
                const lodForId = lodSets.find(lodSet => {
                    if (lodSet.id === geoState.selectedBaseMapLodId) {
                        return true;
                    }
                });

                // no matching id in the extentset
                if (angular.isUndefined(lodForId)) {
                    throw new Error('could not find an LOD set with matching id.');
                }

                return lodForId.lods;
            }

            /**
             * Switch basemap based on the uid provided.
             * @function selectBasemap
             * @param {string} id identifier for a specific basemap layerbower
             */
            function selectBasemap(id) {
                const mapManager = service.mapManager;

                // const map = service.mapObject;

                if (typeof mapManager === 'undefined' || !mapManager.BasemapControl) {
                    console.error('Error: Map manager or basemap control is not setup,' +
                        ' please setup map manager by calling setupMap().');
                } else {

                    if (id.startsWith('blank_basemap_')) {

                        // get the current selected basemap id
                        const oldBaseMap = mapManager.BasemapControl.basemapGallery.getSelected();
                        geoState.blankBaseMapId = oldBaseMap.id;
                        hideBaseMap(true);

                        // update id
                        id = oldBaseMap.id;
                    } else {

                        // restore opacity from previous hidden base map hide if needed
                        if (geoState.blankBaseMapId !== null) {
                            hideBaseMap(false);
                        }
                    }

                    // call this to set the base map, need to call this for all, this will force
                    // update for the blank base map.
                    mapManager.BasemapControl.setBasemap(id);

                }
            }

            /**
             * Check to see if given base map id has same wkid value as previously selected base map.
             * @function baseMapHasSameSP
             * @param {String} id base map id
             * @return {bool} true if current base map has the same wkid as the previous one
             */
            function baseMapHasSameSP(id) {

                const blankBaseMapIdPattern = 'blank_basemap_';
                let newWkid;

                // check to see if current base map is blank base map, get wkid accordingly
                if (id.startsWith(blankBaseMapIdPattern)) {
                    newWkid = parseInt(id.slice(blankBaseMapIdPattern.length, id.length));
                } else {
                    const newBaseMap = getBaseMapConfig(id, config);
                    newWkid = newBaseMap.wkid;
                }

                let oldWkid;

                // check to see if previous selected base map is blank or not, get wkid accordingly
                if (geoState.selectedBaseMapId.startsWith(blankBaseMapIdPattern)) {
                    oldWkid = parseInt(geoState.selectedBaseMapId.slice(blankBaseMapIdPattern.length,
                        geoState.selectedBaseMapId.length));
                } else {
                    const oldBaseMap = getBaseMapConfig(geoState.selectedBaseMapId, config);
                    oldWkid = oldBaseMap.wkid;
                }

                return (oldWkid === newWkid);

            }

            /**
             * Sets zoom level of the map to the specified level.
             * @function setZoom
             * @param {number} value a zoom level number
             */
            function setZoom(value) {
                service.mapObject.setZoom(value);
            }

            /**
             * Changes the zoom level by the specified value relative to the current level; can be negative.
             * To avoid multiple chained zoom animations when rapidly pressing the zoom in/out icons, we
             * update the zoom level only when the one before it resolves with the net zoom change.
             *
             * @function shiftZoom
             * @param  {number} byValue a number of zoom levels to shift by
             */
            function shiftZoom(byValue) {
                settings.zoomCounter += byValue;
                settings.zoomPromise.then(() => {
                    if (settings.zoomCounter !== 0) {
                        let zoomValue = service.mapObject.getZoom() + settings.zoomCounter;
                        settings.zoomCounter = 0;
                        settings.zoomPromise = service.mapObject.setZoom(zoomValue);
                    }
                });
            }

            /**
             * Set the map to full extent.
             * @function setFullExtent
             */
            function setFullExtent() {
                const map = service.mapObject;
                if (geoState.fullExtent) {
                    map.setExtent(geoState.fullExtent);
                } else {
                    console.warn('GeoService: fullExtent value is not set.');
                }
            }

            /**
             * Fetches a graphic from the given layer.
             * Will attempt local copy, will hit the server if not available.
             *
             * @function fetchGraphic
             * @param  {Object} layer the layer record object to search
             * @param  {Integer} featureIdx the index of the layer (relevant for dynamic sub-layers)
             * @param  {Integer} objId ID of object being searched for
             * @returns {Promise} resolves with a bundle of information. .graphic is the graphic; .source is where it came from - 'layer' or 'server'; also .layer and .featureIdx for convenience
             */
            function fetchGraphic(layer, featureIdx, objId) {

                // FIXME _layer reference
                // TODO make result object structure an ES6 class
                const layerObj = layer._layer;
                const result = {
                    graphic: null,
                    source: null,
                    layer,
                    featureIdx
                };

                // if triggers when layer has no service, or all geometry is on client, in which case we use local geometry instead of pulling from server
                // snapshot mode is set by the constant MODE_SNAPSHOT that maps to 0 in esri's api for FeatureLayer
                if (layerObj.graphics) {
                    const myG = layerObj.graphics.find(g => {
                        return g.attributes[layerObj.objectIdField] === objId;
                    });
                    if (myG) {
                        result.graphic = myG;
                        result.source = 'layer';
                        return $q.resolve(result);
                    }
                }

                // were not able to get a local copy of the graphic. to the server
                // TODO add some error handling. Cases: failed server call. server call is not a feature
                // TODO add some caching to this. if we get a result, save it somewhere. grab that if requested a 2nd time

                // layerUrl is the URL that the point to be zoomed to belongs to
                // TODO if we ever add an "index-free url" property, use that instead and avoid the if
                let layerUrl = layerObj.url + '/';
                if (!layerObj.graphics) {
                    // it is a dynamic layer, so we need to append the feature index to the URL.
                    layerUrl = layerUrl + featureIdx + '/';
                }

                return gapiService.gapi.layer.getFeatureInfo(layerUrl, objId)
                    .then(geoInfo => {
                        // server result omits spatial reference
                        geoInfo.feature.geometry.spatialReference = layerObj.spatialReference;
                        result.graphic = geoInfo.feature;
                        result.source = 'server';
                        return result;
                    });
            }

            /**
             * Fetches a feature in a layer given the layerUrl and objId of the object and then zooms to it.
             * Only handles feature related layers (feature, dynamic). Will also apply a hilight to the feature.
             *
             * @function zoomToGraphic
             * @param  {Object} layer is the esri layer object of the graphic that will be zoomed to
             * @param {Object} zoomLayer zoom object in format used by layerRegistry's zoomToScale
             * @param  {Integer} featureIdx the index of the layer (relevant for dynamic sub-layers)
             * @param  {Integer} objId is ID of object to be zoomed to
             */
            function zoomToGraphic(layer, zoomLayer, featureIdx, objId) {
                fetchGraphic(layer, featureIdx, objId).then(gBundle => {
                    zoomWithOffset(gBundle.graphic.geometry, layer, zoomLayer).then(() => {
                        applyHilight(gBundle);
                    });
                });
            }

            /**
             * Fetches a point in a layer given the layerUrl and objId of the object and then hilights to it.
             * Only handles feature related layers (feature, dynamic).
             *
             * @function hilightGraphic
             * @param  {Object} layer is the layer record of graphic to zoom
             * @param  {Integer} featureIdx the index of the layer (relevant for dynamic sub-layers)
             * @param  {Integer|Array} objId is ID or array of IDs of object(s) to hilight
             */
            function hilightGraphic(layer, featureIdx, objId) {
                const objIds = Array.isArray(objId) ? objId : [objId];
                const fetchPromises = objIds.map(oid => fetchGraphic(layer, featureIdx, oid));

                $q.all(fetchPromises).then(graphicBundles => {
                    applyHilight(graphicBundles);
                });
            }

            /**
             * Clears any hilights, pins, and hazes from the hilight layer.
             * @function clearHilight
             */
            function clearHilight() {
                geoState.hilight.clearHilight();
            }

            /**
             * Adds a location pin to the hilight layer.
             *
             * @function dropMapPin
             * @param  {Object} mapPoint ESRI point defining where to put the pin
             */
            function dropMapPin(mapPoint) {
                geoState.hilight.addPin(mapPoint);
            }

            /**
             * Performs the application of a hilight for a graphic.
             *
             * @function applyHilight
             * @private
             * @param  {Object|Array} graphicBundle a graphic bundle or array of graphic bundles for the item(s) to hilight
             * @see fetchGraphic
             */
            function applyHilight(graphicBundle) {

                const bundles = Array.isArray(graphicBundle) ? graphicBundle : [graphicBundle];

                // generate detached graphics to give to the hilight layer.
                const hilitePromises = gapiService.gapi.hilight.getUnboundGraphics(bundles,
                    service.mapObject.spatialReference);

                $q.all(hilitePromises).then(hilightGraphics => {
                    geoState.hilight.addHilight(hilightGraphics);
                });
            }

            /**
             * Given a geometry, attributes, spatialReference and zoomlevel, reprojects geometry from its spatialReference
             * to the map's spatialReference, then zooms to the maximum level such that the geometry is still visible.
             *
             * @function zoomWithOffset
             * @param  {Object} geo is the geometry to be zoomed to
             * @param  {Object} layer is the esri layer object of the graphic that will be zoomed to
             * @param {Object} zoomLayer zoom object in format used by layerRegistry's zoomToScale
             * @returns {Promise} resolves when zoom finishes
             */
            function zoomWithOffset(geo, layer, zoomLayer) {
                const map = service.mapObject;

                const barWidth = storageService.panels.sidePanel.outerWidth();
                const mapWidth = storageService.panels.map.outerWidth();

                // barWidth/mapWidth is the % of map blocked by side panel
                // shifting by 1/2 % of blocked map offsets point to center of visible map
                // this ratio always changes based on window resizing/map resizing
                // since the side panel is always 400px; need ratio every time zoom happens
                const ratio = (barWidth / mapWidth) / 2;

                // make new graphic (on the chance it came from server and is just raw geometry)
                const newg = gapiService.gapi.proj.Graphic({
                    geometry: geo
                });

                // TODO only do this if projections are actually different.
                // reproject graphic to spatialReference of the map
                const gextent = gapiService.gapi.proj.localProjectExtent(
                    gapiService.gapi.proj.graphicsUtils.graphicsExtent([newg]),
                    map.spatialReference);

                // need to make new esri extent to use getCenter function
                const newExt = gapiService.gapi.mapManager.Extent(gextent.x1, gextent.y1,
                    gextent.x0, gextent.y0, gextent.sr);

                // handles extent
                if ((newExt.xmin !== newExt.xmax) &amp;&amp; (newExt.ymin !== newExt.ymax)) {
                    const eExt = newExt.expand(4);
                    const xOffset = (eExt.xmax - eExt.xmin) * ratio * (-1);
                    const gExt = eExt.offset(xOffset, (eExt.ymax - eExt.ymin) / 4);
                    return map.setExtent(gExt);
                } else {
                    // handles points
                    const pt = newExt.getCenter();
                    const zoomed = geoState.layerRegistry.zoomToScale(zoomLayer, zoomLayer.options.offscale.value);
                    return zoomed.then(() => {
                        const xOffset = (map.extent.xmax - map.extent.xmin) * ratio * (-1);
                        const newPt = pt.offset(xOffset, (map.extent.ymax - map.extent.ymin) / 4);
                        return map.centerAt(newPt);
                    });
                }
            }

            /**
            * Takes a location object in lat/long, converts to current map spatialReference using
            * reprojection method in geoApi, and zooms to the point.
            *
            * @function geolocate
            * @param {Object} location is a location object, containing geometries in lat/long
            */
            function geolocate(location) {
                const map = service.mapObject;

                // get reprojected point and zoom to it
                const geoPt = gapiService.gapi.proj.localProjectPoint(4326, map.spatialReference.wkid,
                    [parseFloat(location.longitude), parseFloat(location.latitude)]);
                const zoomPt = gapiService.gapi.proj.Point(geoPt[0], geoPt[1], map.spatialReference);

                // give preference to the layer closest to a 50k scale ratio which is ideal for zoom
                const sweetLod = findClosestLOD(map.__tileInfo.lods, 50000);
                map.centerAndZoom(zoomPt, Math.max(sweetLod.level, 0));
            }

            /**
             * Finds the level of detail closest to the provided scale.
             *
             * @function findClosestLOD
             * @param  {Array} lods     list of levels of detail objects
             * @param  {Number} scale   scale value to search for in the levels of detail
             * @return {Object} the level of detail object closest to the scale
             */
            function findClosestLOD(lods, scale) {
                const diffs = lods.map(lod => Math.abs(lod.scale - scale));
                const lodIdx = diffs.indexOf(Math.min(...diffs));
                return lods[lodIdx];
            }

            /**
             * Retrieves symbology icon for a feature.
             *
             * @function retrieveSymbol
             * @param  {Object} attribs    attributes of the feature we want a symbol for
             * @param  {Object} renderer   enhanced renderer object for the layer in server format
             * @return {String} data-url that will render the symbology
             */
            function retrieveSymbol(attribs, renderer) {
                return gapiService.gapi.symbology.getGraphicIcon(attribs, renderer);
            }

            /**
            * Sets the current selected map id and extent set id, creates the fullExtent.
            * @function setSelectedBaseMap
            * @param {String} id of base map
            */
            function setSelectedBaseMap(id) {
                geoState.selectedBaseMapId = id;

                let selectedBaseMap;

                // search base map config based on  'blank_basemap_' condition
                if (!id.startsWith(blankBaseMapIdPattern)) {

                    selectedBaseMap = config.baseMaps.find(baseMap => {
                        return (baseMap.id === geoState.selectedBaseMapId);
                    });

                } else {
                    const wkid = parseInt(id.slice(blankBaseMapIdPattern.length, id.length));

                    // find the first base map that has the matching wkid
                    selectedBaseMap = config.baseMaps.find(baseMap => {
                        return (baseMap.wkid === wkid);
                    });

                    geoState.blankBaseMapId = selectedBaseMap.id;
                    geoState.selectedBaseMapId = selectedBaseMap.id;
                }

                // get selected base map extent set id, so we can store teh map extent
                geoState.selectedBaseMapExtentSetId = selectedBaseMap.extentId;
                geoState.selectedBaseMapLodId = selectedBaseMap.lodId;

                const defaultExtentJson = getDefaultExtFromExtentSets(config.map.extentSets);
                geoState.mapExtent = gapiService.gapi.mapManager.getExtentFromJson(defaultExtentJson);

                geoState.lods = getLod(config.map.lods);

            }

            /**
            * Ready a trigger on the map load event.
            * Also initialize map full extent.
            * @function prepMapLoad
            * @private
            */
            function prepMapLoad() {
                // we are returning a promise that resolves when the map load happens.

                return $q(resolve => {
                    const map = service.mapObject;
                    const lFullExtent = getFullExtFromExtentSets(config.map.extentSets);

                    setMapLoadingFlag(true);

                    // map extent is not available until map is loaded
                    if (lFullExtent) {
                        gapiService.gapi.events.wrapEvents(map, {
                            load: () => {
                                // setup hilight layer
                                geoState.hilight = gapiService.gapi.hilight.makeHilightLayer();
                                map.addLayer(geoState.hilight);

                                // setup full extent
                                if (lFullExtent) {
                                    // compare map extent and setting.extent spatial-references
                                    // make sure the full extent has the same spatial reference as the map
                                    if (gapiService.gapi.proj.isSpatialRefEqual(map.extent
                                            .spatialReference,
                                            lFullExtent.spatialReference)) {

                                        // same spatial reference, no reprojection required
                                        geoState.fullExtent = gapiService.gapi.mapManager.getExtentFromJson(
                                            lFullExtent);
                                    } else {

                                        // need to re-project
                                        geoState.fullExtent = gapiService.gapi.proj.projectEsriExtent(
                                            gapiService.gapi.mapManager.getExtentFromJson(
                                                lFullExtent),
                                            map.extent.spatialReference);
                                    }
                                }

                                setMapLoadingFlag(false);
                                resolve();
                            },
                            'update-start': () => {
                                console.log('   Map update START!');

                                setMapLoadingFlag(true, 300);
                            },
                            'update-end': () => {
                                console.log('   Map update END!');

                                setMapLoadingFlag(false, 100);
                            }
                        });
                    }
                });
            }

            /**
             * Get basemap config from basemap id.
             * @function getBaseMapConfig
             * @private
             * @param {String} id base Map id
             * @return {Object} base map json object
             */
            function getBaseMapConfig(id) {
                return config.baseMaps.find(basemapConfig => (basemapConfig.id === id));
            }

            /**
             * Sets `isMapLoading` flag indicating map layers are updating.
             * @function setMapLoadingFlag
             * @param {Boolean} isLoading defaults to true; flag indicating if one or more layers begins updating their content
             * @param {Number}  delay     defaults to 0; delay before setting `isMapLoading` state; useful to avoid setting indicator for a small amounts of time
             * @private
             */
            function setMapLoadingFlag(isLoading = true, delay = 0) {
                // need to wrap this in a timeout since these are esri events, Angular wouldn't pick up on any changes unless a new digest cycle is triggered
                $timeout.cancel(service.loadingTimeout);
                service.loadingTimeout = $timeout(() => service.mapObject.isMapLoading = isLoading, delay);
            }

            /**
             * Hide base map.
             * @function hideBaseMap
             * @param {Boolean} hide flag indicates if basemap should be visible
             */
            function hideBaseMap(hide) {

                // TODO: move geoState stuff outside of the hidebasemap
                const mapManager = service.mapManager;
                const basemap = mapManager.BasemapControl.basemapGallery.get(geoState.blankBaseMapId);

                const basemapLayers = basemap.getLayers();

                // let visibleLayerIds = [];
                // visibleLayerIds.push(-1);
                // basemapLayers.setVisibleLayers(visibleLayerIds);

                // hide basemap by change visibility
                Object.entries(basemapLayers).forEach(([index, basemapLayer]) => {
                    basemapLayer.opacity = (hide === true) ? 0.0 : 1.0;
                });

                if (!hide) {
                    geoState.blankBaseMapId = null;
                }

            }

            // FIXME add doc
            function validateProj(sr) {
                return gapiService.gapi.proj.checkProj(sr).foundProj;
            }

        }
    }
})();
</code></pre>
        </article>
    </section>




</div>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.4.1</a> on Thu Sep 22 2016 18:18:33 GMT+0000 (UTC) using the <a href="https://github.com/clenemt/docdash">docdash</a> theme.
</footer>

<script>prettyPrint();</script>
<script src="scripts/linenumber.js"></script>
</body>
</html>
