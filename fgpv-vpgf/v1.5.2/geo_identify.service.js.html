<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>geo/identify.service.js - Documentation</title>

    <script src="scripts/prettify/prettify.js"></script>
    <script src="scripts/prettify/lang-css.js"></script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc.css">
</head>
<body>

<input type="checkbox" id="nav-trigger" class="nav-trigger" />
<label for="nav-trigger" class="navicon-button x">
  <div class="navicon"></div>
</label>

<label for="nav-trigger" class="overlay"></label>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Tutorials</h3><ul><li><a href="tutorial-app_startup.html">Application Startup Flow</a></li><li><a href="tutorial-architecture_overview.html">Architecture Overview</a></li><li><a href="tutorial-branching.html">Branching Strategy</a></li><li><a href="tutorial-contributing_guide.html">Contributing Guide</a></li><li><a href="tutorial-getting_started.html">Getting Started</a></li><li><a href="tutorial-meta_documentation.html">Meta Documentation</a></li><li><a href="tutorial-modules.html">Modules</a></li><li><a href="tutorial-plugins.html">Plugins</a></li><li><a href="tutorial-technical.html">Technical Guides</a></li><li><a href="tutorial-translations.html">Translations</a></li><li><a href="tutorial-ui_overview.html">UI Overview & Terminology</a></li><li><a href="tutorial-user.html">User Guide</a></li></ul><h3>Classes</h3><ul><li><a href="app.geo.module_identifyService-IDENTIFY_RESULT.html">IDENTIFY_RESULT</a></li><li><a href="app.geo.module_LayerBlueprintFactory-LayerBlueprint.LayerBlueprint.html">LayerBlueprint</a></li><li><a href="app.geo.module_LayerBlueprintFactory-LayerFileBlueprint.html">LayerFileBlueprint</a><ul class='methods'><li data-type='method'><a href="app.geo.module_LayerBlueprintFactory-LayerFileBlueprint.html#_readFileData">_readFileData</a></li><li data-type='method'><a href="app.geo.module_LayerBlueprintFactory-LayerFileBlueprint.html#generateLayer">generateLayer</a></li><li data-type='method'><a href="app.geo.module_LayerBlueprintFactory-LayerFileBlueprint.html#validate">validate</a></li></ul></li><li><a href="app.geo.module_LayerBlueprintFactory-LayerServiceBlueprint.LayerServiceBlueprint.html">LayerServiceBlueprint</a></li><li><a href="app.geo.module_LayerRecordFactory-AttrRecord.html">AttrRecord</a><ul class='methods'><li data-type='method'><a href="app.geo.module_LayerRecordFactory-AttrRecord.html#formatAttributes">formatAttributes</a></li><li data-type='method'><a href="app.geo.module_LayerRecordFactory-AttrRecord.html#getAttributes">getAttributes</a></li></ul></li><li><a href="app.geo.module_LayerRecordFactory-DynamicRecord.html">DynamicRecord</a><ul class='methods'><li data-type='method'><a href="app.geo.module_LayerRecordFactory-DynamicRecord.html#.parseData">parseData</a></li></ul></li><li><a href="app.geo.module_LayerRecordFactory-FeatureRecord.html">FeatureRecord</a><ul class='methods'><li data-type='method'><a href="app.geo.module_LayerRecordFactory-FeatureRecord.html#.parseData">parseData</a></li></ul></li><li><a href="app.geo.module_LayerRecordFactory-ImageRecord.html">ImageRecord</a><ul class='methods'><li data-type='method'><a href="app.geo.module_LayerRecordFactory-ImageRecord.html#.parseData">parseData</a></li></ul></li><li><a href="app.geo.module_LayerRecordFactory-LayerRecord.html">LayerRecord</a><ul class='methods'><li data-type='method'><a href="app.geo.module_LayerRecordFactory-LayerRecord.html#.parseData">parseData</a></li><li data-type='method'><a href="app.geo.module_LayerRecordFactory-LayerRecord.html#createBbox">createBbox</a></li><li data-type='method'><a href="app.geo.module_LayerRecordFactory-LayerRecord.html#destroyBbox">destroyBbox</a></li></ul></li><li><a href="app.geo.module_LayerRecordFactory-LayerRecord.LayerRecord.html">LayerRecord</a></li><li><a href="app.geo.module_LayerRecordFactory-TileRecord.html">TileRecord</a><ul class='methods'><li data-type='method'><a href="app.geo.module_LayerRecordFactory-TileRecord.html#.parseData">parseData</a></li></ul></li><li><a href="app.geo.module_LayerRecordFactory-WmsRecord.html">WmsRecord</a><ul class='methods'><li data-type='method'><a href="app.geo.module_LayerRecordFactory-WmsRecord.html#.parseData">parseData</a></li></ul></li><li><a href="app.ui.module_StepperFactory-Stepper.html">Stepper</a><ul class='methods'><li data-type='method'><a href="app.ui.module_StepperFactory-Stepper.html#_configureStep">_configureStep</a></li><li data-type='method'><a href="app.ui.module_StepperFactory-Stepper.html#_reset">_reset</a></li><li data-type='method'><a href="app.ui.module_StepperFactory-Stepper.html#_think">_think</a></li><li data-type='method'><a href="app.ui.module_StepperFactory-Stepper.html#addSteps">addSteps</a></li><li data-type='method'><a href="app.ui.module_StepperFactory-Stepper.html#cancelMove">cancelMove</a></li><li data-type='method'><a href="app.ui.module_StepperFactory-Stepper.html#moveToStep">moveToStep</a></li><li data-type='method'><a href="app.ui.module_StepperFactory-Stepper.html#nextStep">nextStep</a></li><li data-type='method'><a href="app.ui.module_StepperFactory-Stepper.html#previousStep">previousStep</a></li><li data-type='method'><a href="app.ui.module_StepperFactory-Stepper.html#reset">reset</a></li><li data-type='method'><a href="app.ui.module_StepperFactory-Stepper.html#start">start</a></li></ul></li><li><a href="app.ui.module_tooltipService-ContainInside.html">ContainInside</a></li><li><a href="app.ui.module_tooltipService-ContainInside.ContainInside.html">ContainInside</a></li><li><a href="app.ui.module_tooltipService-FollowMap.html">FollowMap</a></li><li><a href="app.ui.module_tooltipService-FollowMouse.html">FollowMouse</a></li><li><a href="app.ui.module_tooltipService-Tooltip.html">Tooltip</a></li><li><a href="app.ui.module_tooltipService-TooltipStrategy.html">TooltipStrategy</a></li><li><a href="ExportSize.html">ExportSize</a></li><li><a href="Viewer.html">Viewer</a><ul class='methods'><li data-type='method'><a href="Viewer.html#contains">contains</a></li><li data-type='method'><a href="Viewer.html#setDialogAction">setDialogAction</a></li><li data-type='method'><a href="Viewer.html#setStatus">setStatus</a></li></ul></li><li><a href="ViewerGroup.html">ViewerGroup</a><ul class='methods'><li data-type='method'><a href="ViewerGroup.html#add">add</a></li><li data-type='method'><a href="ViewerGroup.html#contains">contains</a></li><li data-type='method'><a href="ViewerGroup.html#deactivate">deactivate</a></li><li data-type='method'><a href="ViewerGroup.html#status">status</a></li></ul></li></ul><h3>Modules</h3><ul><li><a href="app.common.module_displayManager.html">displayManager</a><ul class='methods'><li data-type='method'><a href="app.common.module_displayManager.html#~clearDisplayPanel">clearDisplayPanel</a></li><li data-type='method'><a href="app.common.module_displayManager.html#~setDisplay">setDisplay</a></li><li data-type='method'><a href="app.common.module_displayManager.html#~toggleDisplayPanel">toggleDisplayPanel</a></li></ul></li><li><a href="app.common.module_stateManager.html">stateManager</a><ul class='methods'><li data-type='method'><a href="app.common.module_stateManager.html#~addState">addState</a></li><li data-type='method'><a href="app.common.module_stateManager.html#~callback">callback</a></li><li data-type='method'><a href="app.common.module_stateManager.html#~closePanel">closePanel</a></li><li data-type='method'><a href="app.common.module_stateManager.html#~closePanelFromHistory">closePanelFromHistory</a></li><li data-type='method'><a href="app.common.module_stateManager.html#~getChildren">getChildren</a></li><li data-type='method'><a href="app.common.module_stateManager.html#~getItem">getItem</a></li><li data-type='method'><a href="app.common.module_stateManager.html#~getParent">getParent</a></li><li data-type='method'><a href="app.common.module_stateManager.html#~modifyHistory">modifyHistory</a></li><li data-type='method'><a href="app.common.module_stateManager.html#~onCloseCallback">onCloseCallback</a></li><li data-type='method'><a href="app.common.module_stateManager.html#~openChildPanel">openChildPanel</a></li><li data-type='method'><a href="app.common.module_stateManager.html#~openPanel">openPanel</a></li><li data-type='method'><a href="app.common.module_stateManager.html#~openParentPanel">openParentPanel</a></li><li data-type='method'><a href="app.common.module_stateManager.html#~runCloseCallback">runCloseCallback</a></li><li data-type='method'><a href="app.common.module_stateManager.html#~setActive">setActive</a></li><li data-type='method'><a href="app.common.module_stateManager.html#~setItemProperty">setItemProperty</a></li><li data-type='method'><a href="app.common.module_stateManager.html#~setMorph">setMorph</a></li><li data-type='method'><a href="app.common.module_stateManager.html#~togglePanel">togglePanel</a></li></ul></li><li><a href="app.core.module_common.html">common</a></li><li><a href="app.core.module_configService.html">configService</a><ul class='methods'><li data-type='method'><a href="app.core.module_configService.html#~currentLang">currentLang</a></li><li data-type='method'><a href="app.core.module_configService.html#~fileInit">fileInit</a></li><li data-type='method'><a href="app.core.module_configService.html#~getCurrent">getCurrent</a></li><li data-type='method'><a href="app.core.module_configService.html#~getLanguages">getLanguages</a></li><li data-type='method'><a href="app.core.module_configService.html#~getOriginal">getOriginal</a></li><li data-type='method'><a href="app.core.module_configService.html#~initialize">initialize</a></li><li data-type='method'><a href="app.core.module_configService.html#~mergeConfigParts">mergeConfigParts</a></li><li data-type='method'><a href="app.core.module_configService.html#~rcsAddKeys">rcsAddKeys</a></li><li data-type='method'><a href="app.core.module_configService.html#~rcsInit">rcsInit</a></li><li data-type='method'><a href="app.core.module_configService.html#~rcsLoad">rcsLoad</a></li><li data-type='method'><a href="app.core.module_configService.html#~ready">ready</a></li><li data-type='method'><a href="app.core.module_configService.html#~setCurrent">setCurrent</a></li></ul></li><li><a href="app.geo.module_gapiService.html">gapiService</a><ul class='methods'><li data-type='method'><a href="app.geo.module_gapiService.html#~init">init</a></li></ul></li><li><a href="app.geo.module_Geo.html">Geo</a></li><li><a href="app.geo.module_geoSearch.html">geoSearch</a><ul class='methods'><li data-type='method'><a href="app.geo.module_geoSearch.html#~configureSearch">configureSearch</a></li><li data-type='method'><a href="app.geo.module_geoSearch.html#~getProvinces">getProvinces</a></li><li data-type='method'><a href="app.geo.module_geoSearch.html#~getTypes">getTypes</a></li><li data-type='method'><a href="app.geo.module_geoSearch.html#~isEnabled">isEnabled</a></li><li data-type='method'><a href="app.geo.module_geoSearch.html#~postQuery">postQuery</a></li><li data-type='method'><a href="app.geo.module_geoSearch.html#~preQuery">preQuery</a></li><li data-type='method'><a href="app.geo.module_geoSearch.html#~query">query</a></li><li data-type='method'><a href="app.geo.module_geoSearch.html#~setExtent">setExtent</a></li><li data-type='method'><a href="app.geo.module_geoSearch.html#~setLatLng">setLatLng</a></li><li data-type='method'><a href="app.geo.module_geoSearch.html#~setProvince">setProvince</a></li><li data-type='method'><a href="app.geo.module_geoSearch.html#~setQueryParam">setQueryParam</a></li><li data-type='method'><a href="app.geo.module_geoSearch.html#~setRadius">setRadius</a></li><li data-type='method'><a href="app.geo.module_geoSearch.html#~setType">setType</a></li></ul></li><li><a href="app.geo.module_geoService.html">geoService</a><ul class='methods'><li data-type='method'><a href="app.geo.module_geoService.html#~assembleMap">assembleMap</a></li><li data-type='method'><a href="app.geo.module_geoService.html#~epsgLookup">epsgLookup</a></li></ul></li><li><a href="app.geo.module_identifyService.html">identifyService</a><ul class='methods'><li data-type='method'><a href="app.geo.module_identifyService.html#~attributesToDetails">attributesToDetails</a></li><li data-type='method'><a href="app.geo.module_identifyService.html#~clickHandlerBuilder">clickHandlerBuilder</a></li><li data-type='method'><a href="app.geo.module_identifyService.html#~getFeatureName">getFeatureName</a></li><li data-type='method'><a href="app.geo.module_identifyService.html#~identifyEsriDynamicLayer">identifyEsriDynamicLayer</a></li><li data-type='method'><a href="app.geo.module_identifyService.html#~identifyEsriFeatureLayer">identifyEsriFeatureLayer</a></li><li data-type='method'><a href="app.geo.module_identifyService.html#~identifyOgcWmsLayer">identifyOgcWmsLayer</a></li><li data-type='method'><a href="app.geo.module_identifyService.html#~init">init</a></li><li data-type='method'><a href="app.geo.module_identifyService.html#~makeInfalliblePromise">makeInfalliblePromise</a></li><li data-type='method'><a href="app.geo.module_identifyService.html#~unAliasAttribs">unAliasAttribs</a></li></ul></li><li><a href="app.geo.module_LayerBlueprintFactory.html">LayerBlueprintFactory</a></li><li><a href="app.geo.module_LayerBlueprintUserOptions.html">LayerBlueprintUserOptions</a></li><li><a href="app.geo.module_LayerRecordFactory.html">LayerRecordFactory</a><ul class='methods'><li data-type='method'><a href="app.geo.module_LayerRecordFactory.html#~makeFileRecord">makeFileRecord</a></li><li data-type='method'><a href="app.geo.module_LayerRecordFactory.html#~makeServiceRecord">makeServiceRecord</a></li><li data-type='method'><a href="app.geo.module_LayerRecordFactory.html#~parseLayerData">parseLayerData</a></li></ul></li><li><a href="app.geo.module_layerRegistry.html">layerRegistry</a><ul class='methods'><li data-type='method'><a href="app.geo.module_layerRegistry.html#~_refactorIsLayerInMapStack">_refactorIsLayerInMapStack</a></li><li data-type='method'><a href="app.geo.module_layerRegistry.html#~_testSyncCheck">_testSyncCheck</a></li><li data-type='method'><a href="app.geo.module_layerRegistry.html#~aliasedFieldName">aliasedFieldName</a></li><li data-type='method'><a href="app.geo.module_layerRegistry.html#~checkDateType">checkDateType</a></li><li data-type='method'><a href="app.geo.module_layerRegistry.html#~constructLayers">constructLayers</a></li><li data-type='method'><a href="app.geo.module_layerRegistry.html#~destroyHovertip">destroyHovertip</a></li><li data-type='method'><a href="app.geo.module_layerRegistry.html#~extentChangeHandler">extentChangeHandler</a></li><li data-type='method'><a href="app.geo.module_layerRegistry.html#~getAllQueryableLayerRecords">getAllQueryableLayerRecords</a></li><li data-type='method'><a href="app.geo.module_layerRegistry.html#~getLayerInsertPosition">getLayerInsertPosition</a></li><li data-type='method'><a href="app.geo.module_layerRegistry.html#~getLayerMapIndex">getLayerMapIndex</a></li><li data-type='method'><a href="app.geo.module_layerRegistry.html#~getLayersByType">getLayersByType</a></li><li data-type='method'><a href="app.geo.module_layerRegistry.html#~getRcsLayerIDs">getRcsLayerIDs</a></li><li data-type='method'><a href="app.geo.module_layerRegistry.html#~hoverHandler">hoverHandler</a></li><li data-type='method'><a href="app.geo.module_layerRegistry.html#~isOffScale">isOffScale</a></li><li data-type='method'><a href="app.geo.module_layerRegistry.html#~makeScaleSet">makeScaleSet</a></li><li data-type='method'><a href="app.geo.module_layerRegistry.html#~moveLayer">moveLayer</a></li><li data-type='method'><a href="app.geo.module_layerRegistry.html#~registerLayerRecord">registerLayerRecord</a></li><li data-type='method'><a href="app.geo.module_layerRegistry.html#~reloadLayer">reloadLayer</a></li><li data-type='method'><a href="app.geo.module_layerRegistry.html#~removeLayer">removeLayer</a></li><li data-type='method'><a href="app.geo.module_layerRegistry.html#~setBboxState">setBboxState</a></li><li data-type='method'><a href="app.geo.module_layerRegistry.html#~setScaleDepState">setScaleDepState</a></li><li data-type='method'><a href="app.geo.module_layerRegistry.html#~snapshotLayer">snapshotLayer</a></li><li data-type='method'><a href="app.geo.module_layerRegistry.html#~zoomToBoundary">zoomToBoundary</a></li><li data-type='method'><a href="app.geo.module_layerRegistry.html#~zoomToScale">zoomToScale</a></li></ul></li><li><a href="app.geo.module_legendEntryFactory.html">legendEntryFactory</a></li><li><a href="app.geo.module_legendService.html">legendService</a><ul class='methods'><li data-type='method'><a href="app.geo.module_legendService.html#~addLayer">addLayer</a></li><li data-type='method'><a href="app.geo.module_legendService.html#~addPlaceholder">addPlaceholder</a></li><li data-type='method'><a href="app.geo.module_legendService.html#~applyFeatureCount">applyFeatureCount</a></li><li data-type='method'><a href="app.geo.module_legendService.html#~applySymbology">applySymbology</a></li><li data-type='method'><a href="app.geo.module_legendService.html#~autoLegendService">autoLegendService</a></li><li data-type='method'><a href="app.geo.module_legendService.html#~dynamicGenerator">dynamicGenerator</a></li><li data-type='method'><a href="app.geo.module_legendService.html#~featureGenerator">featureGenerator</a></li><li data-type='method'><a href="app.geo.module_legendService.html#~getServiceFeatureCount">getServiceFeatureCount</a></li><li data-type='method'><a href="app.geo.module_legendService.html#~getWMSLayerTitle">getWMSLayerTitle</a></li><li data-type='method'><a href="app.geo.module_legendService.html#~imageGenerator">imageGenerator</a></li><li data-type='method'><a href="app.geo.module_legendService.html#~tileGenerator">tileGenerator</a></li><li data-type='method'><a href="app.geo.module_legendService.html#~wmsGenerator">wmsGenerator</a></li></ul></li><li><a href="app.geo.module_locateService.html">locateService</a><ul class='methods'><li data-type='method'><a href="app.geo.module_locateService.html#~_apiLocate">_apiLocate</a></li><li data-type='method'><a href="app.geo.module_locateService.html#~_browserLocate">_browserLocate</a></li><li data-type='method'><a href="app.geo.module_locateService.html#~find">find</a></li></ul></li><li><a href="app.geo.module_mapService.html">mapService</a><ul class='methods'><li data-type='method'><a href="app.geo.module_mapService.html#~applyHilight">applyHilight</a></li><li data-type='method'><a href="app.geo.module_mapService.html#~baseMapHasSameSP">baseMapHasSameSP</a></li><li data-type='method'><a href="app.geo.module_mapService.html#~buildMapObject">buildMapObject</a></li><li data-type='method'><a href="app.geo.module_mapService.html#~clearHilight">clearHilight</a></li><li data-type='method'><a href="app.geo.module_mapService.html#~dropMapPin">dropMapPin</a></li><li data-type='method'><a href="app.geo.module_mapService.html#~enhanceConfigExtent">enhanceConfigExtent</a></li><li data-type='method'><a href="app.geo.module_mapService.html#~fetchGraphic">fetchGraphic</a></li><li data-type='method'><a href="app.geo.module_mapService.html#~geolocate">geolocate</a></li><li data-type='method'><a href="app.geo.module_mapService.html#~getBaseMapConfig">getBaseMapConfig</a></li><li data-type='method'><a href="app.geo.module_mapService.html#~getDefaultExtFromExtentSets">getDefaultExtFromExtentSets</a></li><li data-type='method'><a href="app.geo.module_mapService.html#~getFullExtent">getFullExtent</a></li><li data-type='method'><a href="app.geo.module_mapService.html#~getFullExtFromExtentSets">getFullExtFromExtentSets</a></li><li data-type='method'><a href="app.geo.module_mapService.html#~getLod">getLod</a></li><li data-type='method'><a href="app.geo.module_mapService.html#~getMaxExtFromExtentSets">getMaxExtFromExtentSets</a></li><li data-type='method'><a href="app.geo.module_mapService.html#~hideBaseMap">hideBaseMap</a></li><li data-type='method'><a href="app.geo.module_mapService.html#~hilightGraphic">hilightGraphic</a></li><li data-type='method'><a href="app.geo.module_mapService.html#~prepMapLoad">prepMapLoad</a></li><li data-type='method'><a href="app.geo.module_mapService.html#~retrieveSymbol">retrieveSymbol</a></li><li data-type='method'><a href="app.geo.module_mapService.html#~selectBasemap">selectBasemap</a></li><li data-type='method'><a href="app.geo.module_mapService.html#~setAttribution">setAttribution</a></li><li data-type='method'><a href="app.geo.module_mapService.html#~setFullExtent">setFullExtent</a></li><li data-type='method'><a href="app.geo.module_mapService.html#~setMapLoadingFlag">setMapLoadingFlag</a></li><li data-type='method'><a href="app.geo.module_mapService.html#~setSelectedBaseMap">setSelectedBaseMap</a></li><li data-type='method'><a href="app.geo.module_mapService.html#~setZoom">setZoom</a></li><li data-type='method'><a href="app.geo.module_mapService.html#~shiftZoom">shiftZoom</a></li><li data-type='method'><a href="app.geo.module_mapService.html#~zoomToGraphic">zoomToGraphic</a></li><li data-type='method'><a href="app.geo.module_mapService.html#~zoomWithOffset">zoomWithOffset</a></li></ul></li><li><a href="app.geo.module_metadataService.html">metadataService</a><ul class='methods'><li data-type='method'><a href="app.geo.module_metadataService.html#.transformXml">transformXml</a></li><li data-type='method'><a href="app.geo.module_metadataService.html#~applyXSLT">applyXSLT</a></li><li data-type='method'><a href="app.geo.module_metadataService.html#~loadXmlFile">loadXmlFile</a></li></ul></li><li><a href="app.geo.module_rvInitMap.html">rvInitMap</a><ul class='methods'><li data-type='method'><a href="app.geo.module_rvInitMap.html#~animate">animate</a></li><li data-type='method'><a href="app.geo.module_rvInitMap.html#~keyDownHandler">keyDownHandler</a></li><li data-type='method'><a href="app.geo.module_rvInitMap.html#~keyUpHandler">keyUpHandler</a></li><li data-type='method'><a href="app.geo.module_rvInitMap.html#~mouseDownHandler">mouseDownHandler</a></li><li data-type='method'><a href="app.geo.module_rvInitMap.html#~mouseMoveHandlerBuilder">mouseMoveHandlerBuilder</a></li><li data-type='method'><a href="app.geo.module_rvInitMap.html#~mouseUpHandler">mouseUpHandler</a></li></ul></li><li><a href="app.geo.module_rvOverviewToggle.html">rvOverviewToggle</a><ul class='methods'><li data-type='method'><a href="app.geo.module_rvOverviewToggle.html#~animate">animate</a></li><li data-type='method'><a href="app.geo.module_rvOverviewToggle.html#~animationCompleted">animationCompleted</a></li><li data-type='method'><a href="app.geo.module_rvOverviewToggle.html#~toggleOverview">toggleOverview</a></li></ul></li><li><a href="app.layout.module_animationService.html">animationService</a><ul class='methods'><li data-type='method'><a href="app.layout.module_animationService.html#~animationWrapper">animationWrapper</a></li><li data-type='method'><a href="app.layout.module_animationService.html#~timeLineLite">timeLineLite</a></li></ul></li><li><a href="app.layout.module_layoutService.html">layoutService</a><ul class='methods'><li data-type='method'><a href="app.layout.module_layoutService.html#~currentLayout">currentLayout</a></li></ul></li><li><a href="app.layout.module_rvShell.html">rvShell</a><ul class='methods'><li data-type='method'><a href="app.layout.module_rvShell.html#~updateClass">updateClass</a></li></ul></li><li><a href="app.layout.module_storageService.html">storageService</a></li><li><a href="app.module_core.html">core</a><ul class='methods'><li data-type='method'><a href="app.module_core.html#~addRcsConfigs">addRcsConfigs</a></li><li data-type='method'><a href="app.module_core.html#~binaryToHex">binaryToHex</a></li><li data-type='method'><a href="app.module_core.html#~decode64">decode64</a></li><li data-type='method'><a href="app.module_core.html#~decodeBoolean">decodeBoolean</a></li><li data-type='method'><a href="app.module_core.html#~decodeMainBookmark">decodeMainBookmark</a></li><li data-type='method'><a href="app.module_core.html#~decodeOpacity">decodeOpacity</a></li><li data-type='method'><a href="app.module_core.html#~deriveBookmarkExtent">deriveBookmarkExtent</a></li><li data-type='method'><a href="app.module_core.html#~encode64">encode64</a></li><li data-type='method'><a href="app.module_core.html#~encodeBoolean">encodeBoolean</a></li><li data-type='method'><a href="app.module_core.html#~encodeInteger">encodeInteger</a></li><li data-type='method'><a href="app.module_core.html#~encodeLegendChild">encodeLegendChild</a></li><li data-type='method'><a href="app.module_core.html#~encodeOpacity">encodeOpacity</a></li><li data-type='method'><a href="app.module_core.html#~encodeProperty">encodeProperty</a></li><li data-type='method'><a href="app.module_core.html#~extractChildSettings">extractChildSettings</a></li><li data-type='method'><a href="app.module_core.html#~extractLayerSettings">extractLayerSettings</a></li><li data-type='method'><a href="app.module_core.html#~extractRcsKey">extractRcsKey</a></li><li data-type='method'><a href="app.module_core.html#~filterConfigLayers">filterConfigLayers</a></li><li data-type='method'><a href="app.module_core.html#~getBookmark">getBookmark</a></li><li data-type='method'><a href="app.module_core.html#~hexToBinary">hexToBinary</a></li><li data-type='method'><a href="app.module_core.html#~loadNewLang">loadNewLang</a></li><li data-type='method'><a href="app.module_core.html#~loadNewProjection">loadNewProjection</a></li><li data-type='method'><a href="app.module_core.html#~loadWithBookmark">loadWithBookmark</a></li><li data-type='method'><a href="app.module_core.html#~makeLayerBookmark">makeLayerBookmark</a></li><li data-type='method'><a href="app.module_core.html#~makeLayerConfig">makeLayerConfig</a></li><li data-type='method'><a href="app.module_core.html#~modifyRcsKeyList">modifyRcsKeyList</a></li><li data-type='method'><a href="app.module_core.html#~onCreate">onCreate</a></li><li data-type='method'><a href="app.module_core.html#~optionInjector">optionInjector</a></li><li data-type='method'><a href="app.module_core.html#~parseBookmark">parseBookmark</a></li><li data-type='method'><a href="app.module_core.html#~parseLayers">parseLayers</a></li><li data-type='method'><a href="app.module_core.html#~processSchemaChangeBookmark">processSchemaChangeBookmark</a></li><li data-type='method'><a href="app.module_core.html#~register">register</a></li><li data-type='method'><a href="app.module_core.html#~registerDebounce">registerDebounce</a></li></ul></li><li><a href="app.module_ui.html">ui</a><ul class='methods'><li data-type='method'><a href="app.module_ui.html#~close">close</a></li><li data-type='method'><a href="app.module_ui.html#~closeLoaderService">closeLoaderService</a></li><li data-type='method'><a href="app.module_ui.html#~configureOnContinue">configureOnContinue</a></li><li data-type='method'><a href="app.module_ui.html#~configureReset">configureReset</a></li><li data-type='method'><a href="app.module_ui.html#~connectOnContinue">connectOnContinue</a></li><li data-type='method'><a href="app.module_ui.html#~connectReset">connectReset</a></li><li data-type='method'><a href="app.module_ui.html#~extractLegendTree">extractLegendTree</a></li><li data-type='method'><a href="app.module_ui.html#~generate">generate</a></li><li data-type='method'><a href="app.module_ui.html#~getSectionWidth">getSectionWidth</a></li><li data-type='method'><a href="app.module_ui.html#~isDownloadBlocked">isDownloadBlocked</a></li><li data-type='method'><a href="app.module_ui.html#~isGenerating">isGenerating</a></li><li data-type='method'><a href="app.module_ui.html#~isSettingsEditable">isSettingsEditable</a></li><li data-type='method'><a href="app.module_ui.html#~makeGroup">makeGroup</a></li><li data-type='method'><a href="app.module_ui.html#~makeHeader">makeHeader</a></li><li data-type='method'><a href="app.module_ui.html#~makeItem">makeItem</a></li><li data-type='method'><a href="app.module_ui.html#~makeLayer">makeLayer</a></li><li data-type='method'><a href="app.module_ui.html#~makeLegend">makeLegend</a></li><li data-type='method'><a href="app.module_ui.html#~makeLegendElement">makeLegendElement</a></li><li data-type='method'><a href="app.module_ui.html#~onCancel">onCancel</a></li><li data-type='method'><a href="app.module_ui.html#~open">open</a></li><li data-type='method'><a href="app.module_ui.html#~saveImage">saveImage</a></li><li data-type='method'><a href="app.module_ui.html#~scrollCustomSettings">scrollCustomSettings</a></li><li data-type='method'><a href="app.module_ui.html#~selectOnContinue">selectOnContinue</a></li><li data-type='method'><a href="app.module_ui.html#~serviceUrlResetValidation">serviceUrlResetValidation</a></li><li data-type='method'><a href="app.module_ui.html#~showToast">showToast</a></li><li data-type='method'><a href="app.module_ui.html#~toggleErrorMessage">toggleErrorMessage</a></li><li data-type='method'><a href="app.module_ui.html#~updateComponents">updateComponents</a></li><li data-type='method'><a href="app.module_ui.html#~updateTitleComponent">updateTitleComponent</a></li><li data-type='method'><a href="app.module_ui.html#~wraplegend">wraplegend</a></li></ul></li><li><a href="app.ui.basemap.module_rvBasemap.html">rvBasemap</a></li><li><a href="app.ui.module_basemapService.html">basemapService</a><ul class='methods'><li data-type='method'><a href="app.ui.module_basemapService.html#~_addBaseMaps">_addBaseMaps</a></li><li data-type='method'><a href="app.ui.module_basemapService.html#~_normalizeBasemap">_normalizeBasemap</a></li><li data-type='method'><a href="app.ui.module_basemapService.html#~close">close</a></li><li data-type='method'><a href="app.ui.module_basemapService.html#~getSelected">getSelected</a></li><li data-type='method'><a href="app.ui.module_basemapService.html#~open">open</a></li><li data-type='method'><a href="app.ui.module_basemapService.html#~reload">reload</a></li><li data-type='method'><a href="app.ui.module_basemapService.html#~select">select</a></li><li data-type='method'><a href="app.ui.module_basemapService.html#~setOnChangeCallback">setOnChangeCallback</a></li><li data-type='method'><a href="app.ui.module_basemapService.html#~setOtherChromeOpacity">setOtherChromeOpacity</a></li><li data-type='method'><a href="app.ui.module_basemapService.html#~toggle">toggle</a></li><li data-type='method'><a href="app.ui.module_basemapService.html#~toggle">toggle</a></li><li data-type='method'><a href="app.ui.module_basemapService.html#~wkidToName">wkidToName</a></li></ul></li><li><a href="app.ui.module_common.html">common</a></li><li><a href="app.ui.module_detailService.html">detailService</a><ul class='methods'><li data-type='method'><a href="app.ui.module_detailService.html#~closeDetails">closeDetails</a></li><li data-type='method'><a href="app.ui.module_detailService.html#~expandPanel">expandPanel</a></li></ul></li><li><a href="app.ui.module_errorService.html">errorService</a><ul class='methods'><li data-type='method'><a href="app.ui.module_errorService.html#~display">display</a></li><li data-type='method'><a href="app.ui.module_errorService.html#~remove">remove</a></li></ul></li><li><a href="app.ui.module_ExportComponent.html">ExportComponent</a><ul class='methods'><li data-type='method'><a href="app.ui.module_ExportComponent.html#~constructor">constructor</a></li><li data-type='method'><a href="app.ui.module_ExportComponent.html#~generate">generate</a></li><li data-type='method'><a href="app.ui.module_ExportComponent.html#~reset">reset</a></li></ul></li><li><a href="app.ui.module_exportComponentsService.html">exportComponentsService</a><ul class='methods'><li data-type='method'><a href="app.ui.module_exportComponentsService.html#~get">get</a></li><li data-type='method'><a href="app.ui.module_exportComponentsService.html#~init">init</a></li><li data-type='method'><a href="app.ui.module_exportComponentsService.html#~update">update</a></li></ul></li><li><a href="app.ui.module_exportGenerators.html">exportGenerators</a><ul class='methods'><li data-type='method'><a href="app.ui.module_exportGenerators.html#~footnoteGenerator">footnoteGenerator</a></li><li data-type='method'><a href="app.ui.module_exportGenerators.html#~getScaleInfo">getScaleInfo</a></li><li data-type='method'><a href="app.ui.module_exportGenerators.html#~legendGenerator">legendGenerator</a></li><li data-type='method'><a href="app.ui.module_exportGenerators.html#~mapDummyGenerator">mapDummyGenerator</a></li><li data-type='method'><a href="app.ui.module_exportGenerators.html#~mapLocalGenerator">mapLocalGenerator</a></li><li data-type='method'><a href="app.ui.module_exportGenerators.html#~mapServerGenerator">mapServerGenerator</a></li><li data-type='method'><a href="app.ui.module_exportGenerators.html#~northarrowGenerator">northarrowGenerator</a></li><li data-type='method'><a href="app.ui.module_exportGenerators.html#~scalebarGenerator">scalebarGenerator</a></li><li data-type='method'><a href="app.ui.module_exportGenerators.html#~timestampGenerator">timestampGenerator</a></li><li data-type='method'><a href="app.ui.module_exportGenerators.html#~titleGenerator">titleGenerator</a></li><li data-type='method'><a href="app.ui.module_exportGenerators.html#~wrapOutput">wrapOutput</a></li></ul></li><li><a href="app.ui.module_ExportSize.html">ExportSize</a></li><li><a href="app.ui.module_exportSizesService.html">exportSizesService</a><ul class='methods'><li data-type='method'><a href="app.ui.module_exportSizesService.html#~isCustomOptionSelected">isCustomOptionSelected</a></li><li data-type='method'><a href="app.ui.module_exportSizesService.html#~isCustomOptionUpdated">isCustomOptionUpdated</a></li><li data-type='method'><a href="app.ui.module_exportSizesService.html#~resetTemporaryOption">resetTemporaryOption</a></li><li data-type='method'><a href="app.ui.module_exportSizesService.html#~update">update</a></li><li data-type='method'><a href="app.ui.module_exportSizesService.html#~updateCustomOption">updateCustomOption</a></li></ul></li><li><a href="app.ui.module_filterService.html">filterService</a><ul class='methods'><li data-type='method'><a href="app.ui.module_filterService.html#~filteredState">filteredState</a></li><li data-type='method'><a href="app.ui.module_filterService.html#~init">init</a></li><li data-type='method'><a href="app.ui.module_filterService.html#~onCreate">onCreate</a></li><li data-type='method'><a href="app.ui.module_filterService.html#~onDestroy">onDestroy</a></li><li data-type='method'><a href="app.ui.module_filterService.html#~onExtentChange">onExtentChange</a></li><li data-type='method'><a href="app.ui.module_filterService.html#~queryMapserver">queryMapserver</a></li><li data-type='method'><a href="app.ui.module_filterService.html#~queryURL">queryURL</a></li><li data-type='method'><a href="app.ui.module_filterService.html#~setActive">setActive</a></li></ul></li><li><a href="app.ui.module_fullScreenService.html">fullScreenService</a><ul class='methods'><li data-type='method'><a href="app.ui.module_fullScreenService.html#~onComplete">onComplete</a></li><li data-type='method'><a href="app.ui.module_fullScreenService.html#~toggle">toggle</a></li></ul></li><li><a href="app.ui.module_helpService.html">helpService</a></li><li><a href="app.ui.module_highlightFilter.html">highlightFilter</a><ul class='methods'><li data-type='method'><a href="app.ui.module_highlightFilter.html#~clearDrawn">clearDrawn</a></li><li data-type='method'><a href="app.ui.module_highlightFilter.html#~closeHelpSummary">closeHelpSummary</a></li><li data-type='method'><a href="app.ui.module_highlightFilter.html#~onSearchTermChange">onSearchTermChange</a></li><li data-type='method'><a href="app.ui.module_highlightFilter.html#~open">open</a></li><li data-type='method'><a href="app.ui.module_highlightFilter.html#~register">register</a></li><li data-type='method'><a href="app.ui.module_highlightFilter.html#~setDrawn">setDrawn</a></li><li data-type='method'><a href="app.ui.module_highlightFilter.html#~unregister">unregister</a></li></ul></li><li><a href="app.ui.module_mapNavigationService.html">mapNavigationService</a><ul class='methods'><li data-type='method'><a href="app.ui.module_mapNavigationService.html#~init">init</a></li><li data-type='method'><a href="app.ui.module_mapNavigationService.html#~mapNavigationService">mapNavigationService</a></li><li data-type='method'><a href="app.ui.module_mapNavigationService.html#~private">private</a></li></ul></li><li><a href="app.ui.module_rvAppbar.html">rvAppbar</a><ul class='methods'><li data-type='method'><a href="app.ui.module_rvAppbar.html#~rvAppbar">rvAppbar</a></li></ul></li><li><a href="app.ui.module_rvBasemapItem.html">rvBasemapItem</a><ul class='methods'><li data-type='method'><a href="app.ui.module_rvBasemapItem.html#~toggleDescription">toggleDescription</a></li></ul></li><li><a href="app.ui.module_rvContentPane.html">rvContentPane</a><ul class='methods'><li data-type='method'><a href="app.ui.module_rvContentPane.html#~addHeaderControl">addHeaderControl</a></li><li data-type='method'><a href="app.ui.module_rvContentPane.html#~link">link</a></li><li data-type='method'><a href="app.ui.module_rvContentPane.html#~rvContentPane">rvContentPane</a></li></ul></li><li><a href="app.ui.module_rvDetails.html">rvDetails</a><ul class='methods'><li data-type='method'><a href="app.ui.module_rvDetails.html#~getSelectedItem">getSelectedItem</a></li><li data-type='method'><a href="app.ui.module_rvDetails.html#~selectItem">selectItem</a></li></ul></li><li><a href="app.ui.module_rvDetailsContent.html">rvDetailsContent</a><ul class='methods'><li data-type='method'><a href="app.ui.module_rvDetailsContent.html#~rvDetailsContent">rvDetailsContent</a></li></ul></li><li><a href="app.ui.module_rvDetailsHeader.html">rvDetailsHeader</a><ul class='methods'><li data-type='method'><a href="app.ui.module_rvDetailsHeader.html#~rvDetailsHeader">rvDetailsHeader</a></li></ul></li><li><a href="app.ui.module_rvDetailsRecordEsrifeature.html">rvDetailsRecordEsrifeature</a><ul class='methods'><li data-type='method'><a href="app.ui.module_rvDetailsRecordEsrifeature.html#~renderDetails">renderDetails</a></li><li data-type='method'><a href="app.ui.module_rvDetailsRecordEsrifeature.html#~toggleDetails">toggleDetails</a></li><li data-type='method'><a href="app.ui.module_rvDetailsRecordEsrifeature.html#~zoomToFeature">zoomToFeature</a></li></ul></li><li><a href="app.ui.module_rvDetectScrollbar.html">rvDetectScrollbar</a></li><li><a href="app.ui.module_rvDragula.html">rvDragula</a></li><li><a href="app.ui.module_rvFiltersDefault.html">rvFiltersDefault</a><ul class='methods'><li data-type='method'><a href="app.ui.module_rvFiltersDefault.html#~addColumnInteractivity">addColumnInteractivity</a></li><li data-type='method'><a href="app.ui.module_rvFiltersDefault.html#~Controller">Controller</a></li><li data-type='method'><a href="app.ui.module_rvFiltersDefault.html#~createTable">createTable</a></li><li data-type='method'><a href="app.ui.module_rvFiltersDefault.html#~destroyTable">destroyTable</a></li><li data-type='method'><a href="app.ui.module_rvFiltersDefault.html#~getColumnWidth">getColumnWidth</a></li><li data-type='method'><a href="app.ui.module_rvFiltersDefault.html#~getDToLang">getDToLang</a></li><li data-type='method'><a href="app.ui.module_rvFiltersDefault.html#~getTextWidth">getTextWidth</a></li><li data-type='method'><a href="app.ui.module_rvFiltersDefault.html#~link">link</a></li><li data-type='method'><a href="app.ui.module_rvFiltersDefault.html#~onDetailsClick">onDetailsClick</a></li><li data-type='method'><a href="app.ui.module_rvFiltersDefault.html#~onTableDraw">onTableDraw</a></li><li data-type='method'><a href="app.ui.module_rvFiltersDefault.html#~onTableInit">onTableInit</a></li><li data-type='method'><a href="app.ui.module_rvFiltersDefault.html#~onZoomClick">onZoomClick</a></li><li data-type='method'><a href="app.ui.module_rvFiltersDefault.html#~RenderEllipsis">RenderEllipsis</a></li><li data-type='method'><a href="app.ui.module_rvFiltersDefault.html#~rvFiltersDefault">rvFiltersDefault</a></li><li data-type='method'><a href="app.ui.module_rvFiltersDefault.html#~setDToLang">setDToLang</a></li><li data-type='method'><a href="app.ui.module_rvFiltersDefault.html#~triggerTableButton">triggerTableButton</a></li></ul></li><li><a href="app.ui.module_rvFiltersDefaultMenu.html">rvFiltersDefaultMenu</a><ul class='methods'><li data-type='method'><a href="app.ui.module_rvFiltersDefaultMenu.html#~dataExportCSVTODO:eschewevents;neededheresinceit'sveryhardtocommunicatewithmainfiltersdirective;angular1.5shouldsolveitusingdirectiveswithmultipletransclusions">dataExportCSV
TODO: eschew events; needed here since it's very hard to communicate with main filters directive; angular 1.5 should solve it using directives with multiple transclusions</a></li><li data-type='method'><a href="app.ui.module_rvFiltersDefaultMenu.html#~dataPrintTODO:eschewevents;neededheresinceit'sveryhardtocommunicatewithmainfiltersdirective;angular1.5shouldsolveitusingdirectiveswithmultipletransclusions">dataPrint
TODO: eschew events; needed here since it's very hard to communicate with main filters directive; angular 1.5 should solve it using directives with multiple transclusions</a></li></ul></li><li><a href="app.ui.module_rvFiltersPanel.html">rvFiltersPanel</a><ul class='methods'><li data-type='method'><a href="app.ui.module_rvFiltersPanel.html#~closePanelFIXME:thisshouldbehandledintheshatehelper">closePanel
FIXME: this should be handled in the shatehelper</a></li><li data-type='method'><a href="app.ui.module_rvFiltersPanel.html#~Controller">Controller</a></li><li data-type='method'><a href="app.ui.module_rvFiltersPanel.html#~rvPanel">rvPanel</a></li></ul></li><li><a href="app.ui.module_rvHelpOverlay.html">rvHelpOverlay</a><ul class='methods'><li data-type='method'><a href="app.ui.module_rvHelpOverlay.html#~draw">draw</a></li><li data-type='method'><a href="app.ui.module_rvHelpOverlay.html#~overlap">overlap</a></li><li data-type='method'><a href="app.ui.module_rvHelpOverlay.html#~shouldBeDrawn">shouldBeDrawn</a></li></ul></li><li><a href="app.ui.module_rvHelpSearch.html">rvHelpSearch</a><ul class='methods'><li data-type='method'><a href="app.ui.module_rvHelpSearch.html#~rvHelpSearch">rvHelpSearch</a></li></ul></li><li><a href="app.ui.module_rvLayerItemSymbology.html">rvLayerItemSymbology</a><ul class='methods'><li data-type='method'><a href="app.ui.module_rvLayerItemSymbology.html#~getTextWidth">getTextWidth</a></li><li data-type='method'><a href="app.ui.module_rvLayerItemSymbology.html#~iconLegendItem">iconLegendItem</a></li><li data-type='method'><a href="app.ui.module_rvLayerItemSymbology.html#~imageLegendItem">imageLegendItem</a></li></ul></li><li><a href="app.ui.module_rvLayerListSlider.html">rvLayerListSlider</a><ul class='methods'><li data-type='method'><a href="app.ui.module_rvLayerListSlider.html#~animateClosed">animateClosed</a></li><li data-type='method'><a href="app.ui.module_rvLayerListSlider.html#~animateOpen">animateOpen</a></li><li data-type='method'><a href="app.ui.module_rvLayerListSlider.html#~itemSelectedByKeypress">itemSelectedByKeypress</a></li><li data-type='method'><a href="app.ui.module_rvLayerListSlider.html#~itemSelectedByMouse">itemSelectedByMouse</a></li></ul></li><li><a href="app.ui.module_rvLoaderFile.html">rvLoaderFile</a><ul class='methods'><li data-type='method'><a href="app.ui.module_rvLoaderFile.html#~closeLoaderFile">closeLoaderFile</a></li><li data-type='method'><a href="app.ui.module_rvLoaderFile.html#~configureOnContinue">configureOnContinue</a></li><li data-type='method'><a href="app.ui.module_rvLoaderFile.html#~fileReset">fileReset</a></li><li data-type='method'><a href="app.ui.module_rvLoaderFile.html#~fileResetValidation">fileResetValidation</a></li><li data-type='method'><a href="app.ui.module_rvLoaderFile.html#~fileUrlReset">fileUrlReset</a></li><li data-type='method'><a href="app.ui.module_rvLoaderFile.html#~fileUrlResetValidation">fileUrlResetValidation</a></li><li data-type='method'><a href="app.ui.module_rvLoaderFile.html#~onCancel">onCancel</a></li><li data-type='method'><a href="app.ui.module_rvLoaderFile.html#~onLayerBlueprintReady">onLayerBlueprintReady</a></li><li data-type='method'><a href="app.ui.module_rvLoaderFile.html#~selectOnContinue">selectOnContinue</a></li><li data-type='method'><a href="app.ui.module_rvLoaderFile.html#~selectReset">selectReset</a></li><li data-type='method'><a href="app.ui.module_rvLoaderFile.html#~selectReset">selectReset</a></li><li data-type='method'><a href="app.ui.module_rvLoaderFile.html#~selectResetValidation">selectResetValidation</a></li><li data-type='method'><a href="app.ui.module_rvLoaderFile.html#~selectResetValidation">selectResetValidation</a></li><li data-type='method'><a href="app.ui.module_rvLoaderFile.html#~toggleErrorMessage">toggleErrorMessage</a></li><li data-type='method'><a href="app.ui.module_rvLoaderFile.html#~updateProgress">updateProgress</a></li><li data-type='method'><a href="app.ui.module_rvLoaderFile.html#~uploadFilesSubmitted">uploadFilesSubmitted</a></li><li data-type='method'><a href="app.ui.module_rvLoaderFile.html#~uploadOnContinue">uploadOnContinue</a></li><li data-type='method'><a href="app.ui.module_rvLoaderFile.html#~uploadReset">uploadReset</a></li></ul></li><li><a href="app.ui.module_rvLoaderMenu.html">rvLoaderMenu</a><ul class='methods'><li data-type='method'><a href="app.ui.module_rvLoaderMenu.html#~setFocus">setFocus</a></li></ul></li><li><a href="app.ui.module_rvMapnav.html">rvMapnav</a></li><li><a href="app.ui.module_rvMapnavButton.html">rvMapnavButton</a><ul class='methods'><li data-type='method'><a href="app.ui.module_rvMapnavButton.html#~rvMapnavButton">rvMapnavButton</a></li></ul></li><li><a href="app.ui.module_rvMenuLink.html">rvMenuLink</a></li><li><a href="app.ui.module_rvMetadataContent.html">rvMetadataContent</a><ul class='methods'><li data-type='method'><a href="app.ui.module_rvMetadataContent.html#~rvMetadataContent">rvMetadataContent</a></li></ul></li><li><a href="app.ui.module_rvMetadataExpand.html">rvMetadataExpand</a><ul class='methods'><li data-type='method'><a href="app.ui.module_rvMetadataExpand.html#~rvMetadataExpand">rvMetadataExpand</a></li></ul></li><li><a href="app.ui.module_rvMetadataPanel.html">rvMetadataPanel</a><ul class='methods'><li data-type='method'><a href="app.ui.module_rvMetadataPanel.html#~rvMetadataPanel">rvMetadataPanel</a></li></ul></li><li><a href="app.ui.module_rvMorph.html">rvMorph</a><ul class='methods'><li data-type='method'><a href="app.ui.module_rvMorph.html#~linkFunc">linkFunc</a></li><li data-type='method'><a href="app.ui.module_rvMorph.html#~rvMorph">rvMorph</a></li></ul></li><li><a href="app.ui.module_rvPlugSlide.html">rvPlugSlide</a><ul class='methods'><li data-type='method'><a href="app.ui.module_rvPlugSlide.html#~animationBuilder">animationBuilder</a></li><li data-type='method'><a href="app.ui.module_rvPlugSlide.html#~buildTween">buildTween</a></li><li data-type='method'><a href="app.ui.module_rvPlugSlide.html#~calculateShift">calculateShift</a></li><li data-type='method'><a href="app.ui.module_rvPlugSlide.html#~cleanup">cleanup</a></li><li data-type='method'><a href="app.ui.module_rvPlugSlide.html#~deltaHelper">deltaHelper</a></li><li data-type='method'><a href="app.ui.module_rvPlugSlide.html#~getPanelSize">getPanelSize</a></li><li data-type='method'><a href="app.ui.module_rvPlugSlide.html#~makeFadeAnim">makeFadeAnim</a></li><li data-type='method'><a href="app.ui.module_rvPlugSlide.html#~makeSlideAnim">makeSlideAnim</a></li><li data-type='method'><a href="app.ui.module_rvPlugSlide.html#~ngShowHideWrapper">ngShowHideWrapper</a></li></ul></li><li><a href="app.ui.module_rvReverse.html">rvReverse</a></li><li><a href="app.ui.module_rvSettings.html">rvSettings</a><ul class='methods'><li data-type='method'><a href="app.ui.module_rvSettings.html#~rvSettings">rvSettings</a></li><li data-type='method'><a href="app.ui.module_rvSettings.html#~toggleQuery">toggleQuery</a></li></ul></li><li><a href="app.ui.module_rvSidenav.html">rvSidenav</a></li><li><a href="app.ui.module_rvStepperItem.html">rvStepperItem</a><ul class='methods'><li data-type='method'><a href="app.ui.module_rvStepperItem.html#~onCancelBefore">onCancelBefore</a></li></ul></li><li><a href="app.ui.module_rvToc.html">rvToc</a><ul class='methods'><li data-type='method'><a href="app.ui.module_rvToc.html#~killEvent">killEvent</a></li><li data-type='method'><a href="app.ui.module_rvToc.html#~tocKeyDownHandler">tocKeyDownHandler</a></li><li data-type='method'><a href="app.ui.module_rvToc.html#~toggleReorderMode">toggleReorderMode</a></li><li data-type='method'><a href="app.ui.module_rvToc.html#~toggleSortGroups">toggleSortGroups</a></li></ul></li><li><a href="app.ui.module_rvTocEntry.html">rvTocEntry</a><ul class='methods'><li data-type='method'><a href="app.ui.module_rvTocEntry.html#~link">link</a></li></ul></li><li><a href="app.ui.module_rvTocEntryControl.html">rvTocEntryControl</a></li><li><a href="app.ui.module_rvTocEntryFlag.html">rvTocEntryFlag</a></li><li><a href="app.ui.module_rvTocExpandMenu.html">rvTocExpandMenu</a><ul class='methods'><li data-type='method'><a href="app.ui.module_rvTocExpandMenu.html#~getLegendGroupEntriesExpandState">getLegendGroupEntriesExpandState</a></li><li data-type='method'><a href="app.ui.module_rvTocExpandMenu.html#~toggleLegendGroupEntries">toggleLegendGroupEntries</a></li></ul></li><li><a href="app.ui.module_rvTocVisibilityMenu.html">rvTocVisibilityMenu</a><ul class='methods'><li data-type='method'><a href="app.ui.module_rvTocVisibilityMenu.html#~getLegendEntriesVisibility">getLegendEntriesVisibility</a></li><li data-type='method'><a href="app.ui.module_rvTocVisibilityMenu.html#~toggleLegendEntries">toggleLegendEntries</a></li></ul></li><li><a href="app.ui.module_rvToggleSlide.html">rvToggleSlide</a><ul class='methods'><li data-type='method'><a href="app.ui.module_rvToggleSlide.html#~getTargetHeight">getTargetHeight</a></li><li data-type='method'><a href="app.ui.module_rvToggleSlide.html#~ngShowHideBootstrap">ngShowHideBootstrap</a></li><li data-type='method'><a href="app.ui.module_rvToggleSlide.html#~toggleClose">toggleClose</a></li><li data-type='method'><a href="app.ui.module_rvToggleSlide.html#~toggleOpen">toggleOpen</a></li></ul></li><li><a href="app.ui.module_rvToolbox.html">rvToolbox</a></li><li><a href="app.ui.module_rvTooltip.html">rvTooltip</a><ul class='methods'><li data-type='method'><a href="app.ui.module_rvTooltip.html#~rvPanel">rvPanel</a></li><li data-type='method'><a href="app.ui.module_rvTooltip.html#~watchBBoxChanges">watchBBoxChanges</a></li></ul></li><li><a href="app.ui.module_rvTruncate.html">rvTruncate</a><ul class='methods'><li data-type='method'><a href="app.ui.module_rvTruncate.html#~rvTruncate">rvTruncate</a></li></ul></li><li><a href="app.ui.module_sideNavigationService.html">sideNavigationService</a><ul class='methods'><li data-type='method'><a href="app.ui.module_sideNavigationService.html#~close">close</a></li><li data-type='method'><a href="app.ui.module_sideNavigationService.html#~getLongLink">getLongLink</a></li><li data-type='method'><a href="app.ui.module_sideNavigationService.html#~getShortLink">getShortLink</a></li><li data-type='method'><a href="app.ui.module_sideNavigationService.html#~init">init</a></li><li data-type='method'><a href="app.ui.module_sideNavigationService.html#~isCurrentLanguage">isCurrentLanguage</a></li><li data-type='method'><a href="app.ui.module_sideNavigationService.html#~open">open</a></li><li data-type='method'><a href="app.ui.module_sideNavigationService.html#~private">private</a></li><li data-type='method'><a href="app.ui.module_sideNavigationService.html#~selectURL">selectURL</a></li><li data-type='method'><a href="app.ui.module_sideNavigationService.html#~setupLanguages">setupLanguages</a></li><li data-type='method'><a href="app.ui.module_sideNavigationService.html#~switchChanged">switchChanged</a></li><li data-type='method'><a href="app.ui.module_sideNavigationService.html#~switchLanguage">switchLanguage</a></li><li data-type='method'><a href="app.ui.module_sideNavigationService.html#~toggle">toggle</a></li></ul></li><li><a href="app.ui.module_StepperFactory.html">StepperFactory</a></li><li><a href="app.ui.module_tocService.html">tocService</a><ul class='methods'><li data-type='method'><a href="app.ui.module_tocService.html#~removeLayer">removeLayer</a></li><li data-type='method'><a href="app.ui.module_tocService.html#~setTocEntrySelectedState">setTocEntrySelectedState</a></li><li data-type='method'><a href="app.ui.module_tocService.html#~toggleLayerFiltersPanel">toggleLayerFiltersPanel</a></li><li data-type='method'><a href="app.ui.module_tocService.html#~toggleLayerFiltersPanel">toggleLayerFiltersPanel</a></li><li data-type='method'><a href="app.ui.module_tocService.html#~toggleMetadata">toggleMetadata</a></li><li data-type='method'><a href="app.ui.module_tocService.html#~toggleSettings">toggleSettings</a></li><li data-type='method'><a href="app.ui.module_tocService.html#~watchPanelState">watchPanelState</a></li><li data-type='method'><a href="app.ui.module_tocService.html#~zoomLayerScale">zoomLayerScale</a></li><li data-type='method'><a href="app.ui.module_tocService.html#~zoomToBoundary">zoomToBoundary</a></li></ul></li><li><a href="app.ui.module_tooltipService.html">tooltipService</a><ul class='methods'><li data-type='method'><a href="app.ui.module_tooltipService.html#~_mouseMoveHandler">_mouseMoveHandler</a></li><li data-type='method'><a href="app.ui.module_tooltipService.html#~_resetOffset">_resetOffset</a></li><li data-type='method'><a href="app.ui.module_tooltipService.html#~_start">_start</a></li><li data-type='method'><a href="app.ui.module_tooltipService.html#~_stop">_stop</a></li><li data-type='method'><a href="app.ui.module_tooltipService.html#~_updateDimensions">_updateDimensions</a></li><li data-type='method'><a href="app.ui.module_tooltipService.html#~addHoverTooltip">addHoverTooltip</a></li><li data-type='method'><a href="app.ui.module_tooltipService.html#~checkCollisions">checkCollisions</a></li><li data-type='method'><a href="app.ui.module_tooltipService.html#~constructor">constructor</a></li><li data-type='method'><a href="app.ui.module_tooltipService.html#~constructor">constructor</a></li><li data-type='method'><a href="app.ui.module_tooltipService.html#~constructor">constructor</a></li><li data-type='method'><a href="app.ui.module_tooltipService.html#~constructor">constructor</a></li><li data-type='method'><a href="app.ui.module_tooltipService.html#~deRegister">deRegister</a></li><li data-type='method'><a href="app.ui.module_tooltipService.html#~deRegister">deRegister</a></li><li data-type='method'><a href="app.ui.module_tooltipService.html#~destroy">destroy</a></li><li data-type='method'><a href="app.ui.module_tooltipService.html#~getBounds">getBounds</a></li><li data-type='method'><a href="app.ui.module_tooltipService.html#~getOriginPoint">getOriginPoint</a></li><li data-type='method'><a href="app.ui.module_tooltipService.html#~offset">offset</a></li><li data-type='method'><a href="app.ui.module_tooltipService.html#~position">position</a></li><li data-type='method'><a href="app.ui.module_tooltipService.html#~register">register</a></li><li data-type='method'><a href="app.ui.module_tooltipService.html#~register">register</a></li><li data-type='method'><a href="app.ui.module_tooltipService.html#~removeHoverTooltip">removeHoverTooltip</a></li></ul></li><li><a href="material.components.dialog.module_$mdDialog.html">$mdDialog</a><ul class='methods'><li data-type='method'><a href="material.components.dialog.module_$mdDialog.html#~show">show</a></li></ul></li><li><a href="material.components.icon.module_mdIconDirectiveDecorator.html">mdIconDirectiveDecorator</a><ul class='methods'><li data-type='method'><a href="material.components.icon.module_mdIconDirectiveDecorator.html#~decorateCompile">decorateCompile</a></li></ul></li><li><a href="material.components.menuBar.module_mdMenuItemDirectiveDecorator.html">mdMenuItemDirectiveDecorator</a><ul class='methods'><li data-type='method'><a href="material.components.menuBar.module_mdMenuItemDirectiveDecorator.html#~decorateCompile">decorateCompile</a></li></ul></li><li><a href="material.components.tooltip.module_mdTooltipDirective.html">mdTooltipDirective</a><ul class='methods'><li data-type='method'><a href="material.components.tooltip.module_mdTooltipDirective.html#~decorateCompile">decorateCompile</a></li><li data-type='method'><a href="material.components.tooltip.module_mdTooltipDirective.html#~isTouch">isTouch</a></li></ul></li></ul><h3>Namespaces</h3><ul><li><a href="app.html">app</a></li><li><a href="app.html#.common">common</a></li><li><a href="app.core.html">core</a><ul class='methods'><li data-type='method'><a href="app.core.html#.apiBlock">apiBlock</a></li><li data-type='method'><a href="app.core.html#.configBlock">configBlock</a></li><li data-type='method'><a href="app.core.html#.debugBlock">debugBlock</a></li><li data-type='method'><a href="app.core.html#.runBlock">runBlock</a></li><li data-type='method'><a href="app.core.html#.seed">seed</a></li><li data-type='method'><a href="app.core.html#~configureIconsets">configureIconsets</a></li><li data-type='method'><a href="app.core.html#~configureTheme">configureTheme</a></li><li data-type='method'><a href="app.core.html#~configureTranslations">configureTranslations</a></li><li data-type='method'><a href="app.core.html#~loadRcsLayers">loadRcsLayers</a></li><li data-type='method'><a href="app.core.html#~setLanguage">setLanguage</a></li></ul></li><li><a href="app.geo.html">geo</a></li><li><a href="app.layout.html">layout</a></li><li><a href="app.ui.html">ui</a></li></ul><h3>Global</h3><ul><li><a href="global.html#attachEvents">attachEvents</a></li><li><a href="global.html#autolink">autolink</a></li><li><a href="global.html#centerAndZoom">centerAndZoom</a></li><li><a href="global.html#createCanvas">createCanvas</a></li><li><a href="global.html#createSvg">createSvg</a></li><li><a href="global.html#dateTimeZone">dateTimeZone</a></li><li><a href="global.html#detachEvents">detachEvents</a></li><li><a href="global.html#detectBlur">detectBlur</a></li><li><a href="global.html#detectFocus">detectFocus</a></li><li><a href="global.html#disableCommonPrototypes">disableCommonPrototypes</a></li><li><a href="global.html#elemIsFocusable">elemIsFocusable</a></li><li><a href="global.html#focusableSearch">focusableSearch</a></li><li><a href="global.html#getBookmark">getBookmark</a></li><li><a href="global.html#getRcsLayerIDs">getRcsLayerIDs</a></li><li><a href="global.html#hasLink">hasLink</a></li><li><a href="global.html#initialBookmark">initialBookmark</a></li><li><a href="global.html#isSameActiveElement">isSameActiveElement</a></li><li><a href="global.html#isValid">isValid</a></li><li><a href="global.html#lastVisibleHistoryElement">lastVisibleHistoryElement</a></li><li><a href="global.html#link">link</a></li><li><a href="global.html#loadRcsLayers">loadRcsLayers</a></li><li><a href="global.html#mergeCanvases">mergeCanvases</a></li><li><a href="global.html#noSourceLink">noSourceLink</a></li><li><a href="global.html#onFocusin">onFocusin</a></li><li><a href="global.html#onFocusout">onFocusout</a></li><li><a href="global.html#onKeydown">onKeydown</a></li><li><a href="global.html#onKeyup">onKeyup</a></li><li><a href="global.html#onMouseDown">onMouseDown</a></li><li><a href="global.html#preLoadApiBlock">preLoadApiBlock</a></li><li><a href="global.html#process">process</a></li><li><a href="global.html#readyDelay">readyDelay</a></li><li><a href="global.html#registerPlugin">registerPlugin</a></li><li><a href="global.html#resetTabindex">resetTabindex</a></li><li><a href="global.html#restoreSession">restoreSession</a></li><li><a href="global.html#RV">RV</a></li><li><a href="global.html#setFocus">setFocus</a></li><li><a href="global.html#setLanguage">setLanguage</a></li><li><a href="global.html#shiftFocus">shiftFocus</a></li><li><a href="global.html#start">start</a></li><li><a href="global.html#svgToCanvas">svgToCanvas</a></li><li><a href="global.html#trackFocusBuilder">trackFocusBuilder</a></li><li><a href="global.html#uid">uid</a></li><li><a href="global.html#useBookmark">useBookmark</a></li><li><a href="global.html#versionCheck">versionCheck</a></li></ul>
</nav>

<div id="main">
    
    <h1 class="page-title">geo/identify.service.js</h1>
    

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>(() => {
    /**
     * @module identifyService
     * @memberof app.geo
     *
     * @description
     * Generates handlers for feature identification on all layer types.
     */
    angular
        .module('app.geo')
        .factory('identifyService', identifyServiceFactory);

    function identifyServiceFactory($q, gapiService, stateManager, Geo) {
        return geoState => identifyService(
            geoState,
            geoState.mapService.mapObject,
            geoState.layerRegistry
        );

        function identifyService(geoState, mapObject, layerRegistry) {

            // identify handler switch
            const identifyHandlers = {
                esriFeature: identifyEsriFeatureLayer,
                esriDynamic: identifyEsriDynamicLayer,
                ogcWms: identifyOgcWmsLayer
            };

            // TODO convert this object into an ES6 class
            // jscs doesn't like enhanced object notation
            // jscs:disable requireSpacesInAnonymousFunctionExpression
            /**
             * Create an identify result object.
             * FIXME make this a proper class
             * @constructor IDENTIFY_RESULT
             * @param  {String} name      layer name of the queried layer
             * @param  {Array} symbology array of layer symbology to be displayed in details panel
             * @param  {String} format    indicates data formating template
             * @param  {Object} layerRec  layer record for the queried layer
             * @param  {Integer} featureIdx  optional feature index of queried layer (should be provided for attribute based layers)
             * @param  {String} caption   optional captions to be displayed along with the name
             * @return {Object}           identify result object
             */
            const IDENTIFY_RESULT = (name, symbology, format, layerRec, featureIdx, caption) => {
                return {
                    isLoading: true,
                    requestId: -1,
                    requester: {
                        name,
                        symbology,
                        format,
                        caption,
                        layerRec,
                        featureIdx
                    },
                    data: []
                };
            };
            // jscs:enable requireSpacesInAnonymousFunctionExpression

            return init();

            /***/

            /**
             * Initializes identify service. This needs to be called everytime the map is created.
             * @function init
             * @private
             */
            function init() {
                const clickHandler = clickHandlerBuilder;
                gapiService.gapi.events.wrapEvents(
                    mapObject,
                    {
                        click: clickHandler
                    }
                );

                geoState.identifyService =  {
                    getFeatureName,
                    attributesToDetails,
                    clickHandler
                };

                return geoState.identifyService;
            }

            /******/

            // returns the number of visible layers that have been registered with the identify service
            function getVisibleLayers() {
                // use .filter to count boolean true values
                // TODO: make nicer
                return layerRegistry.getLayersByType(Geo.Layer.Types.ESRI_FEATURE)
                    .concat(layerRegistry.getLayersByType(Geo.Layer.Types.ESRI_DYNAMIC))
                    .filter(l => l.visibleAtMapScale)
                    .concat(layerRegistry.getLayersByType(Geo.Layer.Types.OGC_WMS))
                    .length;
            }

            /**
             * Transforms esri key-value attribute object into key value array with format suitable
             * for consumption by the details pane.
             *
             * @function attributesToDetails
             * @param  {Object} attribs      attribute key-value mapping, potentially with aliases as keys
             * @param  {Array} fields       optional. fields definition array for layer
             * @return {Array}               attribute data transformed into a list, with potential field aliasing applied
             */
            function attributesToDetails(attribs, fields) {
                // TODO make this extensible / modifiable / configurable to allow different details looks for different data
                // simple array of text mapping for demonstration purposes. fancy grid formatting later?
                return Object.keys(attribs)
                    .map(key => {
                        const fieldType = fields ? fields.find(f => f.name === key) : null;
                        return {
                            key: layerRegistry.aliasedFieldName(key, fields),
                            value: attribs[key],
                            type: fieldType ? fieldType.type : fieldType
                        };
                    });
            }

            /**
             * Convert an attribute set so that any keys using aliases are converted to proper fields
             * @function unAliasAttribs
             * @param  {Object} attribs      attribute key-value mapping, potentially with aliases as keys
             * @param  {Array} fields       fields definition array for layer
             * @return {Object}              attribute key-value mapping with fields as keys
             */
            function unAliasAttribs(attribs, fields) {
                const newA = {};
                fields.forEach(field => {
                    // attempt to extract on name. if not found, attempt to extract on alias
                    let val = attribs[field.name];
                    if (!val) {
                        val = attribs[field.alias];
                    }

                    // dump value into the result
                    newA[field.name] = val;
                });
                return newA;
            }

            /**
            * Extract the feature name from a feature as best we can.
            * Support for dynamic layers is limited at the moment.
            *
            * @function getFeatureName
            * @param {Object} attribs the dictionary of attributes for the feature
            * @param {Object} layerRec the record in the layer registry that the feature belongs to
            * @param {Integer} objId the object id of the attribute
            * @returns {String} the name of the feature
            */
            function getFeatureName(attribs, layerRec, objId) {
                // TODO :  we also need to determine if we will support name fields
                //         on child layers of Dynamic services. This would be relevant
                //         if we implement maptips, or need to override the name field
                //         in the details pane.

                let nameField = '';

                if (layerRec.legendEntry &amp;&amp; layerRec.legendEntry.nameField) {
                    nameField = layerRec.legendEntry.nameField;
                } else if (layerRec._layer &amp;&amp; layerRec._layer.displayField) {
                    nameField = layerRec._layer.displayField;
                }

                if (nameField) {
                    return attribs[nameField];
                } else {
                    // FIXME wire in "feature" to translation service
                    return 'Feature ' + objId;
                }
            }

            // will make an extent around a point, that is appropriate for the current map scale.
            // makes it easier for point clicks to instersect
            // the tolerance is distance in pixels from mouse point that qualifies as a hit
            // FIXME convert to jsdoc
            function makeClickBuffer(point, map, tolerance = 5) {
                // take pixel tolerance, convert to map units at current scale. x2 to turn radius into diameter
                const buffSize = 2 * tolerance * map.extent.getWidth() / map.width;

                // Build tolerance envelope of correct size
                const cBuff = new gapiService.gapi.mapManager.Extent(0, 0, buffSize, buffSize, point.spatialReference);

                // move the envelope so it is centered around the point
                return cBuff.centerAt(point);
            }

            /**
            * Run a query on a dynamic layer, return the result as a promise.
            * @function identifyEsriDynamicLayer
            * @param {Object} layerRecord esri layer object
            * @param {Object} opts additional argumets like map object, clickEvent, etc.
            * @returns {Object} an object with identify results array and identify promise resolving when identify is complete; if an empty object is returned, it will be skipped
            */
            function identifyEsriDynamicLayer(layerRecord, opts) {
                const legendEntry = layerRecord.legendEntry;

                // ignore invisible layers by returning empty object
                if (!layerRecord.visibleAtMapScale || !layerRecord.visible || legendEntry.isLoading) {
                    return {};
                }

                const identifyResults = [];
                opts.layerIds = [];

                // every dynamic layer is a group in toc; walk its items to create an entry in details panel
                legendEntry.walkItems(legendEntry => {

                    // ignore invisible sublayers, offscale sublayers, and those where query option is false by returning empty object
                    if (!legendEntry.getVisibility() || !legendEntry.options.query.value ||
                        legendEntry.flags.scale.visible) {
                        return;
                    }

                    opts.layerIds.push(legendEntry.featureIdx); // tell server to query this layer
                    const identifyResult =
                        IDENTIFY_RESULT(legendEntry.name, legendEntry.symbology, 'EsriFeature', layerRecord,
                            legendEntry.featureIdx, legendEntry.master.name); // provide name of the master group as caption

                    identifyResults[legendEntry.featureIdx] = identifyResult;
                });

                // if all the dynamic layer children are unqueriable, do not run identify as with `opts.layerrIds` it will search through all of them and fail trying to access items in `identifyResults` which is also empty
                if (opts.layerIds.length === 0) {
                    return {};
                }

                opts.tolerance = layerRecord.clickTolerance;

                const identifyPromise = gapiService.gapi.layer.serverLayerIdentify(layerRecord._layer, opts)
                    .then(clickResults => {
                        console.log('got a click result');
                        console.log(clickResults);
                        const hitIndexes = []; // sublayers that we got results for

                        // transform attributes of click results into {name,data} objects
                        // one object per identified feature
                        //
                        // each feature will have its attributes converted into a table
                        // placeholder for now until we figure out how to signal the panel that
                        // we want to make a nice table
                        clickResults.forEach(ele => {
                            // NOTE: the identify service returns aliased field names, so no need to look them up here.
                            //       however, this means we need to un-alias the data when doing field lookups.
                            // NOTE: ele.layerId is what we would call featureIdx
                            hitIndexes.push(ele.layerId);

                            // get metadata about this sublayer
                            layerRecord.attributeBundle[ele.layerId].layerData.then(lData => {
                                const identifyResult = identifyResults[ele.layerId];

                                if (lData.supportsFeatures) {
                                    const unAliasAtt = unAliasAttribs(ele.feature.attributes, lData.fields);

                                    identifyResult.data.push({
                                        name: ele.value,
                                        data: attributesToDetails(ele.feature.attributes),
                                        oid: unAliasAtt[lData.oidField],
                                        symbology: [{
                                            svgcode: geoState.mapService.retrieveSymbol(unAliasAtt, lData.renderer)
                                        }]
                                    });
                                }
                                identifyResult.isLoading = false;
                            });
                        });

                        // set the rest of the entries to loading false
                        identifyResults.forEach(identifyResult => {
                            if (hitIndexes.indexOf(identifyResult.requester.featureIdx) === -1) {
                                identifyResult.isLoading = false;
                            }
                        });

                    });

                return {
                    identifyResults: identifyResults.filter(identifyResult => identifyResult), // collapse sparse array
                    identifyPromise
                };
            }

            /**
            * Run a getFeatureInfo on a WMS layer, return the result as a promise.  Fills the panelData array on resolution.
            * @function identifyOgcWmsLayer
            * @param {Object} layerRecord esri layer object
            * @param {Object} opts additional argumets like map object, clickEvent, etc.
            * @returns {Object} an object with identify results array and identify promise resolving when identify is complete; if an empty object is returned, it will be skipped
            */
            function identifyOgcWmsLayer(layerRecord, opts) {
                const legendEntry = layerRecord.legendEntry;
                const infoMap = Geo.Layer.Ogc.INFO_FORMAT_MAP;

                // ignore layers with no mime type or invisible layers and those where query option is false by returning empty object
                if (!infoMap.hasOwnProperty(legendEntry.featureInfoMimeType) ||
                    !layerRecord.visible ||
                    !legendEntry.options.query.value ||
                    legendEntry.isLoading) {
                    return {};
                }

                const identifyResult =
                    IDENTIFY_RESULT(legendEntry.name, legendEntry.symbology, infoMap[legendEntry.featureInfoMimeType],
                        layerRecord);

                const identifyPromise = gapiService.gapi.layer.ogc
                    .getFeatureInfo(
                        layerRecord._layer,
                        opts.clickEvent,
                        legendEntry.layerEntries.map(le => le.id),
                        legendEntry.featureInfoMimeType)
                    .then(data => {
                        identifyResult.isLoading = false;

                        // TODO: check for French service
                        // check if a result is returned by the service. If not, do not add to the array of data
                        if (data.indexOf('Search returned no results') === -1 &amp;&amp; data !== '') {
                            identifyResult.data.push(data);
                        }

                        // console.info(data);
                    });

                return { identifyResults: [identifyResult], identifyPromise };
            }

            /**
            * Run a query on a feature layer, return the result as a promise.  Fills the panelData array on resolution.
            * @function identifyEsriFeatureLayer
            * @param {Object} layerRecord esri layer object
            * @param {Object} opts additional argumets like map object, clickEvent, etc.
            * @returns {Object} an object with identify results array and identify promise resolving when identify is complete; if an empty object is returned, it will be skipped
            */
            function identifyEsriFeatureLayer(layerRecord, opts) {
                const legendEntry = layerRecord.legendEntry;

                // ignore invisible layers and those where identify option is false by returning empty object
                if (!layerRecord.visibleAtMapScale || !layerRecord.visible ||
                    !legendEntry.options.query.value || legendEntry.isLoading) {
                    return {};
                }

                const identifyResult =
                    IDENTIFY_RESULT(legendEntry.name, legendEntry.symbology, 'EsriFeature',
                        layerRecord, legendEntry.featureIdx);

                // run a spatial query
                const qry = new gapiService.gapi.layer.Query();
                qry.outFields = ['*']; // this will result in just objectid fields, as that is all we have in feature layers

                // more accurate results without making the buffer if we're dealing with extents
                // polygons from added file need buffer
                if (layerRecord._layer.geometryType === 'esriGeometryPolygon' &amp;&amp;
                    legendEntry.id.search('esriFeature#') === -1) {
                    qry.geometry = opts.geometry;
                } else {
                    qry.geometry = makeClickBuffer(opts.clickEvent.mapPoint, opts.map, layerRecord.clickTolerance);
                }

                // no need to check if the layer is registered as this object comes from an array of registered layers
                const identifyPromise = $q.all([
                        layerRecord.getAttributes(legendEntry.featureIdx),
                        $q.resolve(layerRecord._layer.queryFeatures(qry)),
                        layerRecord.attributeBundle[legendEntry.featureIdx].layerData
                    ])
                    .then(([attributes, queryResult, layerData]) => {
                        // transform attributes of query results into {name,data} objects one object per queried feature
                        //
                        // each feature will have its attributes converted into a table
                        // placeholder for now until we figure out how to signal the panel that
                        // we want to make a nice table
                        identifyResult.isLoading = false;
                        identifyResult.data = queryResult.features.map(
                            feat => {
                                // grab the object id of the feature we clicked on.
                                const objId = feat.attributes[attributes.oidField];
                                const objIdStr = objId.toString();

                                // use object id find location of our feature in the feature array, and grab its attributes
                                const featAttribs = attributes.rows[attributes.oidIndex[objIdStr]];
                                return {
                                    name: getFeatureName(featAttribs, layerRecord, objIdStr),
                                    data: attributesToDetails(featAttribs, attributes.fields),
                                    oid: objId,
                                    symbology: [
                                        { svgcode: geoState.mapService.retrieveSymbol(featAttribs, layerData.renderer) }
                                    ]
                                };
                            });
                    });

                return { identifyResults: [identifyResult], identifyPromise };
            }

            /**
             * Modifies identify promises to always resolve, never reject.
             * Any errors caught will be added to the details data object.
             * Resolutions of these promises are for turning off loading indicator.
             *
             * @function makeInfalliblePromise
             * @param  {Promise} promise [description]
             * @return {Promise}                 promise that doesn't reject
             */
            function makeInfalliblePromise(promise) {
                const modifiedPromise = $q(resolve =>
                    promise
                        .then(() => resolve(true))
                        .catch(() => resolve(true))
                );

                return modifiedPromise;
            }

            /**
             * Handles global map clicks.  Currently configured to walk through all registered dynamic
             * layers and trigger service side identify queries, and perform client side spatial queries
             * on registered feature layers.
             * @function clickHandlerBuilder
             * @param {Object} clickEvent an ESRI event object for map click events
             */
            function clickHandlerBuilder(clickEvent) {
                geoState.mapService.clearHilight();

                if (getVisibleLayers() === 0) {
                    return;
                }

                console.info('Click start');

                const loadingPromises = [];
                const details = {
                    data: []
                };

                // TODO: mapObject is accessible from all function, there is no need to pass it as a parameter
                const opts = {
                    map: mapObject,
                    clickEvent,
                    geometry: clickEvent.mapPoint,
                    width: mapObject.width,
                    height: mapObject.height,
                    mapExtent: mapObject.extent,
                };

                geoState.mapService.dropMapPin(clickEvent.mapPoint);

                layerRegistry
                    .getAllQueryableLayerRecords()
                    .forEach(layerRecord => {
                        const { identifyResults, identifyPromise } =
                            identifyHandlers[layerRecord.config.layerType](layerRecord, opts);

                        // identify function returns undefined is the layer is cannot be queries because it's not visible or for some other reason
                        if (typeof identifyResults === 'undefined') {
                            return;
                        }

                        // catch error on identify promises and store error messages to be shown in the details panel.
                        const loadingPromise = identifyPromise.catch(error => {
                            // add common error handling

                            console.warn(`Identify query failed for ${layerRecord.legendEntry.name}`);
                            console.warn(error);

                            identifyResults.forEach(identifyResult => {
                                // TODO: this outputs raw error message from the service
                                // we might want to replace it with more user-understandable messages
                                identifyResult.error = error.message;
                                identifyResult.isLoading = false;
                            });
                        });

                        const infallibleLoadingPromise = makeInfalliblePromise(loadingPromise);

                        details.data.push(...identifyResults);
                        loadingPromises.push(infallibleLoadingPromise);
                    });

                details.isLoaded = $q.all(loadingPromises).then(() => true);
                // show details panel only when there is data
                if (details.data.length) {
                    stateManager.toggleDisplayPanel('mainDetails', details, {}, 0);
                }
            }
        }
    }
})();
</code></pre>
        </article>
    </section>




</div>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.4.3</a> on Thu Mar 02 2017 13:13:16 GMT+0000 (UTC) using the <a href="https://github.com/clenemt/docdash">docdash</a> theme.
</footer>

<script>prettyPrint();</script>
<script src="scripts/linenumber.js"></script>
</body>
</html>
