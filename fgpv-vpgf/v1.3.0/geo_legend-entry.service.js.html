<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>geo/legend-entry.service.js - Documentation</title>

    <script src="scripts/prettify/prettify.js"></script>
    <script src="scripts/prettify/lang-css.js"></script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc.css">
</head>
<body>

<input type="checkbox" id="nav-trigger" class="nav-trigger" />
<label for="nav-trigger" class="navicon-button x">
  <div class="navicon"></div>
</label>

<label for="nav-trigger" class="overlay"></label>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Classes</h3><ul><li><a href="app.geo.module_identifyService-IDENTIFY_RESULT.html">IDENTIFY_RESULT</a></li><li><a href="app.geo.module_LayerBlueprintFactory-LayerBlueprint.LayerBlueprint.html">LayerBlueprint</a></li><li><a href="app.geo.module_LayerBlueprintFactory-LayerFileBlueprint.html">LayerFileBlueprint</a><ul class='methods'><li data-type='method'><a href="app.geo.module_LayerBlueprintFactory-LayerFileBlueprint.html#_readFileData">_readFileData</a></li><li data-type='method'><a href="app.geo.module_LayerBlueprintFactory-LayerFileBlueprint.html#generateLayer">generateLayer</a></li><li data-type='method'><a href="app.geo.module_LayerBlueprintFactory-LayerFileBlueprint.html#validate">validate</a></li></ul></li><li><a href="app.geo.module_LayerBlueprintFactory-LayerServiceBlueprint.LayerServiceBlueprint.html">LayerServiceBlueprint</a></li><li><a href="app.geo.module_LayerRecordFactory-AttrRecord.html">AttrRecord</a><ul class='methods'><li data-type='method'><a href="app.geo.module_LayerRecordFactory-AttrRecord.html#formatAttributes">formatAttributes</a></li><li data-type='method'><a href="app.geo.module_LayerRecordFactory-AttrRecord.html#getAttributes">getAttributes</a></li></ul></li><li><a href="app.geo.module_LayerRecordFactory-DynamicRecord.html">DynamicRecord</a><ul class='methods'><li data-type='method'><a href="app.geo.module_LayerRecordFactory-DynamicRecord.html#.parseData">parseData</a></li><li data-type='method'><a href="app.geo.module_LayerRecordFactory-DynamicRecord.html#makeLayerBookmark">makeLayerBookmark</a></li></ul></li><li><a href="app.geo.module_LayerRecordFactory-FeatureRecord.html">FeatureRecord</a><ul class='methods'><li data-type='method'><a href="app.geo.module_LayerRecordFactory-FeatureRecord.html#.parseData">parseData</a></li><li data-type='method'><a href="app.geo.module_LayerRecordFactory-FeatureRecord.html#makeLayerBookmark">makeLayerBookmark</a></li></ul></li><li><a href="app.geo.module_LayerRecordFactory-ImageRecord.html">ImageRecord</a><ul class='methods'><li data-type='method'><a href="app.geo.module_LayerRecordFactory-ImageRecord.html#.parseData">parseData</a></li><li data-type='method'><a href="app.geo.module_LayerRecordFactory-ImageRecord.html#makeLayerBookmark">makeLayerBookmark</a></li></ul></li><li><a href="app.geo.module_LayerRecordFactory-LayerRecord.html">LayerRecord</a><ul class='methods'><li data-type='method'><a href="app.geo.module_LayerRecordFactory-LayerRecord.html#.parseData">parseData</a></li><li data-type='method'><a href="app.geo.module_LayerRecordFactory-LayerRecord.html#createBbox">createBbox</a></li><li data-type='method'><a href="app.geo.module_LayerRecordFactory-LayerRecord.html#destroyBbox">destroyBbox</a></li><li data-type='method'><a href="app.geo.module_LayerRecordFactory-LayerRecord.html#makeLayerBookmark">makeLayerBookmark</a></li></ul></li><li><a href="app.geo.module_LayerRecordFactory-LayerRecord.LayerRecord.html">LayerRecord</a></li><li><a href="app.geo.module_LayerRecordFactory-TileRecord.html">TileRecord</a><ul class='methods'><li data-type='method'><a href="app.geo.module_LayerRecordFactory-TileRecord.html#.parseData">parseData</a></li><li data-type='method'><a href="app.geo.module_LayerRecordFactory-TileRecord.html#makeLayerBookmark">makeLayerBookmark</a></li></ul></li><li><a href="app.geo.module_LayerRecordFactory-WmsRecord.html">WmsRecord</a><ul class='methods'><li data-type='method'><a href="app.geo.module_LayerRecordFactory-WmsRecord.html#.parseData">parseData</a></li><li data-type='method'><a href="app.geo.module_LayerRecordFactory-WmsRecord.html#makeLayerBookmark">makeLayerBookmark</a></li></ul></li><li><a href="app.ui.module_StepperFactory-Stepper.html">Stepper</a><ul class='methods'><li data-type='method'><a href="app.ui.module_StepperFactory-Stepper.html#_configureStep">_configureStep</a></li><li data-type='method'><a href="app.ui.module_StepperFactory-Stepper.html#_reset">_reset</a></li><li data-type='method'><a href="app.ui.module_StepperFactory-Stepper.html#_think">_think</a></li><li data-type='method'><a href="app.ui.module_StepperFactory-Stepper.html#addSteps">addSteps</a></li><li data-type='method'><a href="app.ui.module_StepperFactory-Stepper.html#cancelMove">cancelMove</a></li><li data-type='method'><a href="app.ui.module_StepperFactory-Stepper.html#moveToStep">moveToStep</a></li><li data-type='method'><a href="app.ui.module_StepperFactory-Stepper.html#nextStep">nextStep</a></li><li data-type='method'><a href="app.ui.module_StepperFactory-Stepper.html#previousStep">previousStep</a></li><li data-type='method'><a href="app.ui.module_StepperFactory-Stepper.html#reset">reset</a></li><li data-type='method'><a href="app.ui.module_StepperFactory-Stepper.html#start">start</a></li></ul></li></ul><h3>Modules</h3><ul><li><a href="app.common.module_displayManager.html">app.common.displayManager</a><ul class='methods'><li data-type='method'><a href="app.common.module_displayManager.html#~clearDisplayPanel">clearDisplayPanel</a></li><li data-type='method'><a href="app.common.module_displayManager.html#~setDisplay">setDisplay</a></li><li data-type='method'><a href="app.common.module_displayManager.html#~toggleDisplayPanel">toggleDisplayPanel</a></li></ul></li><li><a href="app.common.module_stateManager.html">app.common.stateManager</a><ul class='methods'><li data-type='method'><a href="app.common.module_stateManager.html#~addState">addState</a></li><li data-type='method'><a href="app.common.module_stateManager.html#~callback">callback</a></li><li data-type='method'><a href="app.common.module_stateManager.html#~closePanel">closePanel</a></li><li data-type='method'><a href="app.common.module_stateManager.html#~closePanelFromHistory">closePanelFromHistory</a></li><li data-type='method'><a href="app.common.module_stateManager.html#~getChildren">getChildren</a></li><li data-type='method'><a href="app.common.module_stateManager.html#~getItem">getItem</a></li><li data-type='method'><a href="app.common.module_stateManager.html#~getParent">getParent</a></li><li data-type='method'><a href="app.common.module_stateManager.html#~modifyHistory">modifyHistory</a></li><li data-type='method'><a href="app.common.module_stateManager.html#~onCloseCallback">onCloseCallback</a></li><li data-type='method'><a href="app.common.module_stateManager.html#~openPanel">openPanel</a></li><li data-type='method'><a href="app.common.module_stateManager.html#~runCloseCallback">runCloseCallback</a></li><li data-type='method'><a href="app.common.module_stateManager.html#~setActive">setActive</a></li><li data-type='method'><a href="app.common.module_stateManager.html#~setItemProperty">setItemProperty</a></li><li data-type='method'><a href="app.common.module_stateManager.html#~setMorph">setMorph</a></li><li data-type='method'><a href="app.common.module_stateManager.html#~togglePanel">togglePanel</a></li></ul></li><li><a href="app.core.module_common.html">app.core.common</a></li><li><a href="app.core.module_configService.html">app.core.configService</a><ul class='methods'><li data-type='method'><a href="app.core.module_configService.html#~currentLang">currentLang</a></li><li data-type='method'><a href="app.core.module_configService.html#~fileInit">fileInit</a></li><li data-type='method'><a href="app.core.module_configService.html#~getCurrent">getCurrent</a></li><li data-type='method'><a href="app.core.module_configService.html#~getLanguages">getLanguages</a></li><li data-type='method'><a href="app.core.module_configService.html#~getOriginal">getOriginal</a></li><li data-type='method'><a href="app.core.module_configService.html#~initialize">initialize</a></li><li data-type='method'><a href="app.core.module_configService.html#~mergeConfigParts">mergeConfigParts</a></li><li data-type='method'><a href="app.core.module_configService.html#~rcsAddKeys">rcsAddKeys</a></li><li data-type='method'><a href="app.core.module_configService.html#~rcsInit">rcsInit</a></li><li data-type='method'><a href="app.core.module_configService.html#~rcsLoad">rcsLoad</a></li><li data-type='method'><a href="app.core.module_configService.html#~ready">ready</a></li><li data-type='method'><a href="app.core.module_configService.html#~setCurrent">setCurrent</a></li></ul></li><li><a href="app.geo.module_gapiService.html">app.geo.gapiService</a><ul class='methods'><li data-type='method'><a href="app.geo.module_gapiService.html#~init">init</a></li></ul></li><li><a href="app.geo.module_Geo.html">app.geo.Geo</a></li><li><a href="app.geo.module_geoService.html">app.geo.geoService</a><ul class='methods'><li data-type='method'><a href="app.geo.module_geoService.html#~assembleMap">assembleMap</a></li><li data-type='method'><a href="app.geo.module_geoService.html#~epsgLookup">epsgLookup</a></li></ul></li><li><a href="app.geo.module_identifyService.html">app.geo.identifyService</a><ul class='methods'><li data-type='method'><a href="app.geo.module_identifyService.html#~attributesToDetails">attributesToDetails</a></li><li data-type='method'><a href="app.geo.module_identifyService.html#~clickHandlerBuilder">clickHandlerBuilder</a></li><li data-type='method'><a href="app.geo.module_identifyService.html#~getFeatureName">getFeatureName</a></li><li data-type='method'><a href="app.geo.module_identifyService.html#~identifyEsriDynamicLayer">identifyEsriDynamicLayer</a></li><li data-type='method'><a href="app.geo.module_identifyService.html#~identifyEsriFeatureLayer">identifyEsriFeatureLayer</a></li><li data-type='method'><a href="app.geo.module_identifyService.html#~identifyOgcWmsLayer">identifyOgcWmsLayer</a></li><li data-type='method'><a href="app.geo.module_identifyService.html#~init">init</a></li><li data-type='method'><a href="app.geo.module_identifyService.html#~makeInfalliblePromise">makeInfalliblePromise</a></li><li data-type='method'><a href="app.geo.module_identifyService.html#~unAliasAttribs">unAliasAttribs</a></li></ul></li><li><a href="app.geo.module_LayerBlueprintFactory.html">app.geo.LayerBlueprintFactory</a></li><li><a href="app.geo.module_LayerBlueprintUserOptions.html">app.geo.LayerBlueprintUserOptions</a></li><li><a href="app.geo.module_LayerRecordFactory.html">app.geo.LayerRecordFactory</a><ul class='methods'><li data-type='method'><a href="app.geo.module_LayerRecordFactory.html#~makeFileRecord">makeFileRecord</a></li><li data-type='method'><a href="app.geo.module_LayerRecordFactory.html#~makeServiceRecord">makeServiceRecord</a></li><li data-type='method'><a href="app.geo.module_LayerRecordFactory.html#~parseLayerData">parseLayerData</a></li></ul></li><li><a href="app.geo.module_layerRegistry.html">app.geo.layerRegistry</a><ul class='methods'><li data-type='method'><a href="app.geo.module_layerRegistry.html#~_refactorIsLayerInMapStack">_refactorIsLayerInMapStack</a></li><li data-type='method'><a href="app.geo.module_layerRegistry.html#~_testSyncCheck">_testSyncCheck</a></li><li data-type='method'><a href="app.geo.module_layerRegistry.html#~aliasedFieldName">aliasedFieldName</a></li><li data-type='method'><a href="app.geo.module_layerRegistry.html#~checkDateType">checkDateType</a></li><li data-type='method'><a href="app.geo.module_layerRegistry.html#~constructLayers">constructLayers</a></li><li data-type='method'><a href="app.geo.module_layerRegistry.html#~extentChangeHandler">extentChangeHandler</a></li><li data-type='method'><a href="app.geo.module_layerRegistry.html#~getAllQueryableLayerRecords">getAllQueryableLayerRecords</a></li><li data-type='method'><a href="app.geo.module_layerRegistry.html#~getLayerInsertPosition">getLayerInsertPosition</a></li><li data-type='method'><a href="app.geo.module_layerRegistry.html#~getLayerMapIndex">getLayerMapIndex</a></li><li data-type='method'><a href="app.geo.module_layerRegistry.html#~getLayersByType">getLayersByType</a></li><li data-type='method'><a href="app.geo.module_layerRegistry.html#~getRcsLayerIDs">getRcsLayerIDs</a></li><li data-type='method'><a href="app.geo.module_layerRegistry.html#~isOffScale">isOffScale</a></li><li data-type='method'><a href="app.geo.module_layerRegistry.html#~makeScaleSet">makeScaleSet</a></li><li data-type='method'><a href="app.geo.module_layerRegistry.html#~moveLayer">moveLayer</a></li><li data-type='method'><a href="app.geo.module_layerRegistry.html#~registerLayerRecord">registerLayerRecord</a></li><li data-type='method'><a href="app.geo.module_layerRegistry.html#~reloadLayer">reloadLayer</a></li><li data-type='method'><a href="app.geo.module_layerRegistry.html#~removeLayer">removeLayer</a></li><li data-type='method'><a href="app.geo.module_layerRegistry.html#~setBboxState">setBboxState</a></li><li data-type='method'><a href="app.geo.module_layerRegistry.html#~setScaleDepState">setScaleDepState</a></li><li data-type='method'><a href="app.geo.module_layerRegistry.html#~snapshotLayer">snapshotLayer</a></li><li data-type='method'><a href="app.geo.module_layerRegistry.html#~zoomToBoundary">zoomToBoundary</a></li><li data-type='method'><a href="app.geo.module_layerRegistry.html#~zoomToScale">zoomToScale</a></li></ul></li><li><a href="app.geo.module_legendEntryFactory.html">app.geo.legendEntryFactory</a></li><li><a href="app.geo.module_legendService.html">app.geo.legendService</a><ul class='methods'><li data-type='method'><a href="app.geo.module_legendService.html#~addLayer">addLayer</a></li><li data-type='method'><a href="app.geo.module_legendService.html#~addPlaceholder">addPlaceholder</a></li><li data-type='method'><a href="app.geo.module_legendService.html#~applyFeatureCount">applyFeatureCount</a></li><li data-type='method'><a href="app.geo.module_legendService.html#~applySymbology">applySymbology</a></li><li data-type='method'><a href="app.geo.module_legendService.html#~autoLegendService">autoLegendService</a></li><li data-type='method'><a href="app.geo.module_legendService.html#~dynamicGenerator">dynamicGenerator</a></li><li data-type='method'><a href="app.geo.module_legendService.html#~featureGenerator">featureGenerator</a></li><li data-type='method'><a href="app.geo.module_legendService.html#~getServiceFeatureCount">getServiceFeatureCount</a></li><li data-type='method'><a href="app.geo.module_legendService.html#~imageGenerator">imageGenerator</a></li><li data-type='method'><a href="app.geo.module_legendService.html#~tileGenerator">tileGenerator</a></li><li data-type='method'><a href="app.geo.module_legendService.html#~wmsGenerator">wmsGenerator</a></li></ul></li><li><a href="app.geo.module_locateService.html">app.geo.locateService</a><ul class='methods'><li data-type='method'><a href="app.geo.module_locateService.html#~_apiLocate">_apiLocate</a></li><li data-type='method'><a href="app.geo.module_locateService.html#~_browserLocate">_browserLocate</a></li><li data-type='method'><a href="app.geo.module_locateService.html#~find">find</a></li></ul></li><li><a href="app.geo.module_mapService.html">app.geo.mapService</a><ul class='methods'><li data-type='method'><a href="app.geo.module_mapService.html#~applyHilight">applyHilight</a></li><li data-type='method'><a href="app.geo.module_mapService.html#~baseMapHasSameSP">baseMapHasSameSP</a></li><li data-type='method'><a href="app.geo.module_mapService.html#~buildMapObject">buildMapObject</a></li><li data-type='method'><a href="app.geo.module_mapService.html#~clearHilight">clearHilight</a></li><li data-type='method'><a href="app.geo.module_mapService.html#~dropMapPin">dropMapPin</a></li><li data-type='method'><a href="app.geo.module_mapService.html#~fetchGraphic">fetchGraphic</a></li><li data-type='method'><a href="app.geo.module_mapService.html#~findClosestLOD">findClosestLOD</a></li><li data-type='method'><a href="app.geo.module_mapService.html#~geolocate">geolocate</a></li><li data-type='method'><a href="app.geo.module_mapService.html#~getBaseMapConfig">getBaseMapConfig</a></li><li data-type='method'><a href="app.geo.module_mapService.html#~getDefaultExtFromExtentSets">getDefaultExtFromExtentSets</a></li><li data-type='method'><a href="app.geo.module_mapService.html#~getFullExtFromExtentSets">getFullExtFromExtentSets</a></li><li data-type='method'><a href="app.geo.module_mapService.html#~getLod">getLod</a></li><li data-type='method'><a href="app.geo.module_mapService.html#~hideBaseMap">hideBaseMap</a></li><li data-type='method'><a href="app.geo.module_mapService.html#~hilightGraphic">hilightGraphic</a></li><li data-type='method'><a href="app.geo.module_mapService.html#~prepMapLoad">prepMapLoad</a></li><li data-type='method'><a href="app.geo.module_mapService.html#~retrieveSymbol">retrieveSymbol</a></li><li data-type='method'><a href="app.geo.module_mapService.html#~selectBasemap">selectBasemap</a></li><li data-type='method'><a href="app.geo.module_mapService.html#~setFullExtent">setFullExtent</a></li><li data-type='method'><a href="app.geo.module_mapService.html#~setMapLoadingFlag">setMapLoadingFlag</a></li><li data-type='method'><a href="app.geo.module_mapService.html#~setSelectedBaseMap">setSelectedBaseMap</a></li><li data-type='method'><a href="app.geo.module_mapService.html#~setZoom">setZoom</a></li><li data-type='method'><a href="app.geo.module_mapService.html#~shiftZoom">shiftZoom</a></li><li data-type='method'><a href="app.geo.module_mapService.html#~zoomToGraphic">zoomToGraphic</a></li><li data-type='method'><a href="app.geo.module_mapService.html#~zoomWithOffset">zoomWithOffset</a></li></ul></li><li><a href="app.geo.module_metadataService.html">app.geo.metadataService</a><ul class='methods'><li data-type='method'><a href="app.geo.module_metadataService.html#.transformXml">transformXml</a></li><li data-type='method'><a href="app.geo.module_metadataService.html#~applyXSLT">applyXSLT</a></li><li data-type='method'><a href="app.geo.module_metadataService.html#~loadXmlFile">loadXmlFile</a></li></ul></li><li><a href="app.geo.module_rvInitMap.html">app.geo.rvInitMap</a><ul class='methods'><li data-type='method'><a href="app.geo.module_rvInitMap.html#~animate">animate</a></li><li data-type='method'><a href="app.geo.module_rvInitMap.html#~keyDownDetected">keyDownDetected</a></li><li data-type='method'><a href="app.geo.module_rvInitMap.html#~keyUpDetected">keyUpDetected</a></li></ul></li><li><a href="app.geo.module_rvOverviewToggle.html">app.geo.rvOverviewToggle</a><ul class='methods'><li data-type='method'><a href="app.geo.module_rvOverviewToggle.html#~animate">animate</a></li><li data-type='method'><a href="app.geo.module_rvOverviewToggle.html#~animationCompleted">animationCompleted</a></li><li data-type='method'><a href="app.geo.module_rvOverviewToggle.html#~toggleOverview">toggleOverview</a></li></ul></li><li><a href="app.layout.module_focusService.html">app.layout.focusService</a><ul class='methods'><li data-type='method'><a href="app.layout.module_focusService.html#~activeDocumentFocusin">activeDocumentFocusin</a></li><li data-type='method'><a href="app.layout.module_focusService.html#~activeDocumentFocusout">activeDocumentFocusout</a></li><li data-type='method'><a href="app.layout.module_focusService.html#~activeDocumentKeydown">activeDocumentKeydown</a></li><li data-type='method'><a href="app.layout.module_focusService.html#~createLink">createLink</a></li><li data-type='method'><a href="app.layout.module_focusService.html#~findNextFocusable">findNextFocusable</a></li><li data-type='method'><a href="app.layout.module_focusService.html#~findPrevFocusable">findPrevFocusable</a></li><li data-type='method'><a href="app.layout.module_focusService.html#~inactiveFocusin">inactiveFocusin</a></li><li data-type='method'><a href="app.layout.module_focusService.html#~previousFocus">previousFocus</a></li><li data-type='method'><a href="app.layout.module_focusService.html#~restore">restore</a></li><li data-type='method'><a href="app.layout.module_focusService.html#~setFocus">setFocus</a></li><li data-type='method'><a href="app.layout.module_focusService.html#~setFocusElement">setFocusElement</a></li><li data-type='method'><a href="app.layout.module_focusService.html#~setFocusOnList">setFocusOnList</a></li><li data-type='method'><a href="app.layout.module_focusService.html#~setPanelFocus">setPanelFocus</a></li><li data-type='method'><a href="app.layout.module_focusService.html#~setStatus">setStatus</a></li><li data-type='method'><a href="app.layout.module_focusService.html#~status">status</a></li><li data-type='method'><a href="app.layout.module_focusService.html#~waitingKeydown">waitingKeydown</a></li></ul></li><li><a href="app.layout.module_layoutService.html">app.layout.layoutService</a></li><li><a href="app.layout.module_rvShell.html">app.layout.rvShell</a></li><li><a href="app.layout.module_storageService.html">app.layout.storageService</a></li><li><a href="app.module_core.html">app.core</a><ul class='methods'><li data-type='method'><a href="app.module_core.html#~addRcsConfigs">addRcsConfigs</a></li><li data-type='method'><a href="app.module_core.html#~decode64">decode64</a></li><li data-type='method'><a href="app.module_core.html#~encode64">encode64</a></li><li data-type='method'><a href="app.module_core.html#~filterConfigLayers">filterConfigLayers</a></li><li data-type='method'><a href="app.module_core.html#~getBookmark">getBookmark</a></li><li data-type='method'><a href="app.module_core.html#~loadNewLang">loadNewLang</a></li><li data-type='method'><a href="app.module_core.html#~loadNewProjection">loadNewProjection</a></li><li data-type='method'><a href="app.module_core.html#~loadWithBookmark">loadWithBookmark</a></li><li data-type='method'><a href="app.module_core.html#~modifyRcsKeyList">modifyRcsKeyList</a></li><li data-type='method'><a href="app.module_core.html#~parseBookmark">parseBookmark</a></li><li data-type='method'><a href="app.module_core.html#~parseLayers">parseLayers</a></li><li data-type='method'><a href="app.module_core.html#~registerDebounce">registerDebounce</a></li></ul></li><li><a href="app.module_ui.html">app.ui</a><ul class='methods'><li data-type='method'><a href="app.module_ui.html#~closeLoaderService">closeLoaderService</a></li><li data-type='method'><a href="app.module_ui.html#~configureOnContinue">configureOnContinue</a></li><li data-type='method'><a href="app.module_ui.html#~configureReset">configureReset</a></li><li data-type='method'><a href="app.module_ui.html#~connectOnContinue">connectOnContinue</a></li><li data-type='method'><a href="app.module_ui.html#~connectReset">connectReset</a></li><li data-type='method'><a href="app.module_ui.html#~onCancel">onCancel</a></li><li data-type='method'><a href="app.module_ui.html#~selectOnContinue">selectOnContinue</a></li><li data-type='method'><a href="app.module_ui.html#~serviceUrlResetValidation">serviceUrlResetValidation</a></li><li data-type='method'><a href="app.module_ui.html#~toggleErrorMessage">toggleErrorMessage</a></li></ul></li><li><a href="app.ui.basemap.module_rvBasemap.html">app.ui.basemap.rvBasemap</a></li><li><a href="app.ui.module_basemapService.html">app.ui.basemapService</a><ul class='methods'><li data-type='method'><a href="app.ui.module_basemapService.html#~_addBaseMaps">_addBaseMaps</a></li><li data-type='method'><a href="app.ui.module_basemapService.html#~_normalizeBasemap">_normalizeBasemap</a></li><li data-type='method'><a href="app.ui.module_basemapService.html#~getSelected">getSelected</a></li><li data-type='method'><a href="app.ui.module_basemapService.html#~reload">reload</a></li><li data-type='method'><a href="app.ui.module_basemapService.html#~select">select</a></li><li data-type='method'><a href="app.ui.module_basemapService.html#~setOnChangeCallback">setOnChangeCallback</a></li></ul></li><li><a href="app.ui.module_common.html">app.ui.common</a></li><li><a href="app.ui.module_errorService.html">app.ui.errorService</a><ul class='methods'><li data-type='method'><a href="app.ui.module_errorService.html#~display">display</a></li><li data-type='method'><a href="app.ui.module_errorService.html#~remove">remove</a></li></ul></li><li><a href="app.ui.module_filterService.html">app.ui.filterService</a><ul class='methods'><li data-type='method'><a href="app.ui.module_filterService.html#~filteredState">filteredState</a></li><li data-type='method'><a href="app.ui.module_filterService.html#~init">init</a></li><li data-type='method'><a href="app.ui.module_filterService.html#~onCreate">onCreate</a></li><li data-type='method'><a href="app.ui.module_filterService.html#~onDestroy">onDestroy</a></li><li data-type='method'><a href="app.ui.module_filterService.html#~onExtentChange">onExtentChange</a></li><li data-type='method'><a href="app.ui.module_filterService.html#~queryMapserver">queryMapserver</a></li><li data-type='method'><a href="app.ui.module_filterService.html#~queryURL">queryURL</a></li><li data-type='method'><a href="app.ui.module_filterService.html#~setActive">setActive</a></li></ul></li><li><a href="app.ui.module_fullScreenService.html">app.ui.fullScreenService</a><ul class='methods'><li data-type='method'><a href="app.ui.module_fullScreenService.html#~onComplete">onComplete</a></li><li data-type='method'><a href="app.ui.module_fullScreenService.html#~toggle">toggle</a></li></ul></li><li><a href="app.ui.module_helpService.html">app.ui.helpService</a><ul class='methods'><li data-type='method'><a href="app.ui.module_helpService.html#~clearDrawn">clearDrawn</a></li><li data-type='method'><a href="app.ui.module_helpService.html#~register">register</a></li><li data-type='method'><a href="app.ui.module_helpService.html#~setDrawn">setDrawn</a></li><li data-type='method'><a href="app.ui.module_helpService.html#~unregister">unregister</a></li></ul></li><li><a href="app.ui.module_mapNavigationService.html">app.ui.mapNavigationService</a><ul class='methods'><li data-type='method'><a href="app.ui.module_mapNavigationService.html#~mapNavigationService">mapNavigationService</a></li></ul></li><li><a href="app.ui.module_rvAppbar.html">app.ui.rvAppbar</a><ul class='methods'><li data-type='method'><a href="app.ui.module_rvAppbar.html#~rvAppbar">rvAppbar</a></li></ul></li><li><a href="app.ui.module_rvBasemapItem.html">app.ui.rvBasemapItem</a></li><li><a href="app.ui.module_rvContentPane.html">app.ui.rvContentPane</a><ul class='methods'><li data-type='method'><a href="app.ui.module_rvContentPane.html#~addHeaderControl">addHeaderControl</a></li><li data-type='method'><a href="app.ui.module_rvContentPane.html#~link">link</a></li><li data-type='method'><a href="app.ui.module_rvContentPane.html#~rvContentPane">rvContentPane</a></li></ul></li><li><a href="app.ui.module_rvDetails.html">app.ui.rvDetails</a><ul class='methods'><li data-type='method'><a href="app.ui.module_rvDetails.html#~closeDetails">closeDetails</a></li><li data-type='method'><a href="app.ui.module_rvDetails.html#~getSelectedItem">getSelectedItem</a></li><li data-type='method'><a href="app.ui.module_rvDetails.html#~selectItem">selectItem</a></li></ul></li><li><a href="app.ui.module_rvDetailsContent.html">app.ui.rvDetailsContent</a><ul class='methods'><li data-type='method'><a href="app.ui.module_rvDetailsContent.html#~rvDetailsContent">rvDetailsContent</a></li></ul></li><li><a href="app.ui.module_rvDetailsExpand.html">app.ui.rvDetailsExpand</a><ul class='methods'><li data-type='method'><a href="app.ui.module_rvDetailsExpand.html#~rvDetailsExpand">rvDetailsExpand</a></li></ul></li><li><a href="app.ui.module_rvDetailsRecordEsrifeature.html">app.ui.rvDetailsRecordEsrifeature</a><ul class='methods'><li data-type='method'><a href="app.ui.module_rvDetailsRecordEsrifeature.html#~renderDetails">renderDetails</a></li><li data-type='method'><a href="app.ui.module_rvDetailsRecordEsrifeature.html#~toggleDetails">toggleDetails</a></li><li data-type='method'><a href="app.ui.module_rvDetailsRecordEsrifeature.html#~zoomToFeature">zoomToFeature</a></li></ul></li><li><a href="app.ui.module_rvDetailsRecordHtml.html">app.ui.rvDetailsRecordHtml</a></li><li><a href="app.ui.module_rvDetectScrollbar.html">app.ui.rvDetectScrollbar</a></li><li><a href="app.ui.module_rvDragula.html">app.ui.rvDragula</a></li><li><a href="app.ui.module_rvFiltersDefault.html">app.ui.rvFiltersDefault</a><ul class='methods'><li data-type='method'><a href="app.ui.module_rvFiltersDefault.html#~addColumnInteractivity">addColumnInteractivity</a></li><li data-type='method'><a href="app.ui.module_rvFiltersDefault.html#~Controller">Controller</a></li><li data-type='method'><a href="app.ui.module_rvFiltersDefault.html#~createTable">createTable</a></li><li data-type='method'><a href="app.ui.module_rvFiltersDefault.html#~destroyTable">destroyTable</a></li><li data-type='method'><a href="app.ui.module_rvFiltersDefault.html#~getDToLang">getDToLang</a></li><li data-type='method'><a href="app.ui.module_rvFiltersDefault.html#~link">link</a></li><li data-type='method'><a href="app.ui.module_rvFiltersDefault.html#~onDetailsClick">onDetailsClick</a></li><li data-type='method'><a href="app.ui.module_rvFiltersDefault.html#~onTableDraw">onTableDraw</a></li><li data-type='method'><a href="app.ui.module_rvFiltersDefault.html#~onTableInit">onTableInit</a></li><li data-type='method'><a href="app.ui.module_rvFiltersDefault.html#~onZoomClick">onZoomClick</a></li><li data-type='method'><a href="app.ui.module_rvFiltersDefault.html#~rvFiltersDefault">rvFiltersDefault</a></li><li data-type='method'><a href="app.ui.module_rvFiltersDefault.html#~setDToLang">setDToLang</a></li><li data-type='method'><a href="app.ui.module_rvFiltersDefault.html#~triggerTableButton">triggerTableButton</a></li></ul></li><li><a href="app.ui.module_rvFiltersDefaultMenu.html">app.ui.rvFiltersDefaultMenu</a><ul class='methods'><li data-type='method'><a href="app.ui.module_rvFiltersDefaultMenu.html#~dataExportCSVTODO:eschewevents;neededheresinceit'sveryhardtocommunicatewithmainfiltersdirective;angular1.5shouldsolveitusingdirectiveswithmultipletransclusions">dataExportCSV
TODO: eschew events; needed here since it's very hard to communicate with main filters directive; angular 1.5 should solve it using directives with multiple transclusions</a></li><li data-type='method'><a href="app.ui.module_rvFiltersDefaultMenu.html#~dataPrintTODO:eschewevents;neededheresinceit'sveryhardtocommunicatewithmainfiltersdirective;angular1.5shouldsolveitusingdirectiveswithmultipletransclusions">dataPrint
TODO: eschew events; needed here since it's very hard to communicate with main filters directive; angular 1.5 should solve it using directives with multiple transclusions</a></li></ul></li><li><a href="app.ui.module_rvFiltersPanel.html">app.ui.rvFiltersPanel</a><ul class='methods'><li data-type='method'><a href="app.ui.module_rvFiltersPanel.html#~closePanelFIXME:thisshouldbehandledintheshatehelper">closePanel
FIXME: this should be handled in the shatehelper</a></li><li data-type='method'><a href="app.ui.module_rvFiltersPanel.html#~Controller">Controller</a></li><li data-type='method'><a href="app.ui.module_rvFiltersPanel.html#~rvPanel">rvPanel</a></li></ul></li><li><a href="app.ui.module_rvHelpOverlay.html">app.ui.rvHelpOverlay</a><ul class='methods'><li data-type='method'><a href="app.ui.module_rvHelpOverlay.html#~draw">draw</a></li><li data-type='method'><a href="app.ui.module_rvHelpOverlay.html#~overlap">overlap</a></li><li data-type='method'><a href="app.ui.module_rvHelpOverlay.html#~shouldBeDrawn">shouldBeDrawn</a></li></ul></li><li><a href="app.ui.module_rvLanguage.html">app.ui.rvLanguage</a><ul class='methods'><li data-type='method'><a href="app.ui.module_rvLanguage.html#~rvLanguage">rvLanguage</a></li><li data-type='method'><a href="app.ui.module_rvLanguage.html#~setLanguageMenu">setLanguageMenu</a></li><li data-type='method'><a href="app.ui.module_rvLanguage.html#~switchLanguage">switchLanguage</a></li></ul></li><li><a href="app.ui.module_rvLayerItemSymbology.html">app.ui.rvLayerItemSymbology</a><ul class='methods'><li data-type='method'><a href="app.ui.module_rvLayerItemSymbology.html#~getTextWidth">getTextWidth</a></li><li data-type='method'><a href="app.ui.module_rvLayerItemSymbology.html#~iconLegendItem">iconLegendItem</a></li><li data-type='method'><a href="app.ui.module_rvLayerItemSymbology.html#~imageLegendItem">imageLegendItem</a></li></ul></li><li><a href="app.ui.module_rvLayerListSlider.html">app.ui.rvLayerListSlider</a><ul class='methods'><li data-type='method'><a href="app.ui.module_rvLayerListSlider.html#~animateClosed">animateClosed</a></li><li data-type='method'><a href="app.ui.module_rvLayerListSlider.html#~animateOpen">animateOpen</a></li><li data-type='method'><a href="app.ui.module_rvLayerListSlider.html#~itemSelectedByKeypress">itemSelectedByKeypress</a></li><li data-type='method'><a href="app.ui.module_rvLayerListSlider.html#~itemSelectedByMouse">itemSelectedByMouse</a></li></ul></li><li><a href="app.ui.module_rvLoaderFile.html">app.ui.rvLoaderFile</a><ul class='methods'><li data-type='method'><a href="app.ui.module_rvLoaderFile.html#~closeLoaderFile">closeLoaderFile</a></li><li data-type='method'><a href="app.ui.module_rvLoaderFile.html#~configureOnContinue">configureOnContinue</a></li><li data-type='method'><a href="app.ui.module_rvLoaderFile.html#~fileReset">fileReset</a></li><li data-type='method'><a href="app.ui.module_rvLoaderFile.html#~fileResetValidation">fileResetValidation</a></li><li data-type='method'><a href="app.ui.module_rvLoaderFile.html#~fileUrlReset">fileUrlReset</a></li><li data-type='method'><a href="app.ui.module_rvLoaderFile.html#~fileUrlResetValidation">fileUrlResetValidation</a></li><li data-type='method'><a href="app.ui.module_rvLoaderFile.html#~onCancel">onCancel</a></li><li data-type='method'><a href="app.ui.module_rvLoaderFile.html#~onLayerBlueprintReady">onLayerBlueprintReady</a></li><li data-type='method'><a href="app.ui.module_rvLoaderFile.html#~selectOnContinue">selectOnContinue</a></li><li data-type='method'><a href="app.ui.module_rvLoaderFile.html#~selectReset">selectReset</a></li><li data-type='method'><a href="app.ui.module_rvLoaderFile.html#~selectReset">selectReset</a></li><li data-type='method'><a href="app.ui.module_rvLoaderFile.html#~selectResetValidation">selectResetValidation</a></li><li data-type='method'><a href="app.ui.module_rvLoaderFile.html#~selectResetValidation">selectResetValidation</a></li><li data-type='method'><a href="app.ui.module_rvLoaderFile.html#~toggleErrorMessage">toggleErrorMessage</a></li><li data-type='method'><a href="app.ui.module_rvLoaderFile.html#~updateProgress">updateProgress</a></li><li data-type='method'><a href="app.ui.module_rvLoaderFile.html#~uploadFilesSubmitted">uploadFilesSubmitted</a></li><li data-type='method'><a href="app.ui.module_rvLoaderFile.html#~uploadOnContinue">uploadOnContinue</a></li><li data-type='method'><a href="app.ui.module_rvLoaderFile.html#~uploadReset">uploadReset</a></li></ul></li><li><a href="app.ui.module_rvLoaderMenu.html">app.ui.rvLoaderMenu</a></li><li><a href="app.ui.module_rvMapnav.html">app.ui.rvMapnav</a></li><li><a href="app.ui.module_rvMapnavButton.html">app.ui.rvMapnavButton</a><ul class='methods'><li data-type='method'><a href="app.ui.module_rvMapnavButton.html#~rvMapnavButton">rvMapnavButton</a></li></ul></li><li><a href="app.ui.module_rvMenuLink.html">app.ui.rvMenuLink</a></li><li><a href="app.ui.module_rvMetadataContent.html">app.ui.rvMetadataContent</a><ul class='methods'><li data-type='method'><a href="app.ui.module_rvMetadataContent.html#~rvMetadataContent">rvMetadataContent</a></li></ul></li><li><a href="app.ui.module_rvMetadataExpand.html">app.ui.rvMetadataExpand</a><ul class='methods'><li data-type='method'><a href="app.ui.module_rvMetadataExpand.html#~rvMetadataExpand">rvMetadataExpand</a></li></ul></li><li><a href="app.ui.module_rvMetadataPanel.html">app.ui.rvMetadataPanel</a><ul class='methods'><li data-type='method'><a href="app.ui.module_rvMetadataPanel.html#~rvMetadataPanel">rvMetadataPanel</a></li></ul></li><li><a href="app.ui.module_rvMorph.html">app.ui.rvMorph</a><ul class='methods'><li data-type='method'><a href="app.ui.module_rvMorph.html#~linkFunc">linkFunc</a></li><li data-type='method'><a href="app.ui.module_rvMorph.html#~rvMorph">rvMorph</a></li></ul></li><li><a href="app.ui.module_rvPlugSlide.html">app.ui.rvPlugSlide</a><ul class='methods'><li data-type='method'><a href="app.ui.module_rvPlugSlide.html#~animationBuilder">animationBuilder</a></li><li data-type='method'><a href="app.ui.module_rvPlugSlide.html#~buildTween">buildTween</a></li><li data-type='method'><a href="app.ui.module_rvPlugSlide.html#~calculateShift">calculateShift</a></li><li data-type='method'><a href="app.ui.module_rvPlugSlide.html#~cleanup">cleanup</a></li><li data-type='method'><a href="app.ui.module_rvPlugSlide.html#~deltaHelper">deltaHelper</a></li><li data-type='method'><a href="app.ui.module_rvPlugSlide.html#~getPanelSize">getPanelSize</a></li><li data-type='method'><a href="app.ui.module_rvPlugSlide.html#~makeFadeAnim">makeFadeAnim</a></li><li data-type='method'><a href="app.ui.module_rvPlugSlide.html#~makeSlideAnim">makeSlideAnim</a></li><li data-type='method'><a href="app.ui.module_rvPlugSlide.html#~ngShowHideWrapper">ngShowHideWrapper</a></li></ul></li><li><a href="app.ui.module_rvReverse.html">app.ui.rvReverse</a></li><li><a href="app.ui.module_rvSettings.html">app.ui.rvSettings</a><ul class='methods'><li data-type='method'><a href="app.ui.module_rvSettings.html#~rvSettings">rvSettings</a></li><li data-type='method'><a href="app.ui.module_rvSettings.html#~toggleQuery">toggleQuery</a></li></ul></li><li><a href="app.ui.module_rvStepperItem.html">app.ui.rvStepperItem</a><ul class='methods'><li data-type='method'><a href="app.ui.module_rvStepperItem.html#~onCancelBefore">onCancelBefore</a></li></ul></li><li><a href="app.ui.module_rvToc.html">app.ui.rvToc</a></li><li><a href="app.ui.module_rvTocEntry.html">app.ui.rvTocEntry</a><ul class='methods'><li data-type='method'><a href="app.ui.module_rvTocEntry.html#~link">link</a></li></ul></li><li><a href="app.ui.module_rvTocEntryControl.html">app.ui.rvTocEntryControl</a></li><li><a href="app.ui.module_rvTocEntryFlag.html">app.ui.rvTocEntryFlag</a></li><li><a href="app.ui.module_rvToggleSlide.html">app.ui.rvToggleSlide</a><ul class='methods'><li data-type='method'><a href="app.ui.module_rvToggleSlide.html#~getTargetHeight">getTargetHeight</a></li><li data-type='method'><a href="app.ui.module_rvToggleSlide.html#~ngShowHideBootstrap">ngShowHideBootstrap</a></li><li data-type='method'><a href="app.ui.module_rvToggleSlide.html#~toggleClose">toggleClose</a></li><li data-type='method'><a href="app.ui.module_rvToggleSlide.html#~toggleOpen">toggleOpen</a></li></ul></li><li><a href="app.ui.module_rvToolbox.html">app.ui.rvToolbox</a></li><li><a href="app.ui.module_rvTruncate.html">app.ui.rvTruncate</a><ul class='methods'><li data-type='method'><a href="app.ui.module_rvTruncate.html#~rvTruncate">rvTruncate</a></li></ul></li><li><a href="app.ui.module_sideNavigationService.html">app.ui.sideNavigationService</a><ul class='methods'><li data-type='method'><a href="app.ui.module_sideNavigationService.html#~close">close</a></li><li data-type='method'><a href="app.ui.module_sideNavigationService.html#~open">open</a></li><li data-type='method'><a href="app.ui.module_sideNavigationService.html#~toggle">toggle</a></li></ul></li><li><a href="app.ui.module_StepperFactory.html">app.ui.StepperFactory</a></li><li><a href="app.ui.module_tocService.html">app.ui.tocService</a><ul class='methods'><li data-type='method'><a href="app.ui.module_tocService.html#~removeLayer">removeLayer</a></li><li data-type='method'><a href="app.ui.module_tocService.html#~setTocEntrySelectedState">setTocEntrySelectedState</a></li><li data-type='method'><a href="app.ui.module_tocService.html#~toggleLayerFiltersPanel">toggleLayerFiltersPanel</a></li><li data-type='method'><a href="app.ui.module_tocService.html#~toggleLayerFiltersPanel">toggleLayerFiltersPanel</a></li><li data-type='method'><a href="app.ui.module_tocService.html#~toggleMetadata">toggleMetadata</a></li><li data-type='method'><a href="app.ui.module_tocService.html#~toggleSettings">toggleSettings</a></li><li data-type='method'><a href="app.ui.module_tocService.html#~watchPanelState">watchPanelState</a></li><li data-type='method'><a href="app.ui.module_tocService.html#~zoomLayerScale">zoomLayerScale</a></li><li data-type='method'><a href="app.ui.module_tocService.html#~zoomToBoundary">zoomToBoundary</a></li></ul></li><li><a href="material.components.icon.module_mdIconDirectiveDecorator.html">material.components.icon.mdIconDirectiveDecorator</a><ul class='methods'><li data-type='method'><a href="material.components.icon.module_mdIconDirectiveDecorator.html#~decorateCompile">decorateCompile</a></li></ul></li><li><a href="material.components.menuBar.module_mdMenuItemDirectiveDecorator.html">material.components.menuBar.mdMenuItemDirectiveDecorator</a><ul class='methods'><li data-type='method'><a href="material.components.menuBar.module_mdMenuItemDirectiveDecorator.html#~decorateCompile">decorateCompile</a></li></ul></li></ul><h3>Namespaces</h3><ul><li><a href="app.html">app</a></li><li><a href="app.html#.common">app.common</a></li><li><a href="app.core.html">app.core</a><ul class='methods'><li data-type='method'><a href="app.core.html#.apiBlock">apiBlock</a></li><li data-type='method'><a href="app.core.html#.configBlock">configBlock</a></li><li data-type='method'><a href="app.core.html#.debugBlock">debugBlock</a></li><li data-type='method'><a href="app.core.html#.runBlock">runBlock</a></li><li data-type='method'><a href="app.core.html#.seed">seed</a></li><li data-type='method'><a href="app.core.html#~configureIconsets">configureIconsets</a></li><li data-type='method'><a href="app.core.html#~configureTheme">configureTheme</a></li><li data-type='method'><a href="app.core.html#~configureTranslations">configureTranslations</a></li><li data-type='method'><a href="app.core.html#~loadRcsLayers">loadRcsLayers</a></li><li data-type='method'><a href="app.core.html#~setLanguage">setLanguage</a></li></ul></li><li><a href="app.geo.html">app.geo</a></li><li><a href="app.layout.html">app.layout</a></li><li><a href="app.ui.html">app.ui</a></li></ul><h3>Tutorials</h3><ul><li><a href="tutorial-getting_started.html">Getting Started</a></li><li><a href="tutorial-gulp-i18n-csv.html">Translation Plugin</a></li></ul><h3>Global</h3><ul><li><a href="global.html#attachEvents">attachEvents</a></li><li><a href="global.html#centerAndZoom">centerAndZoom</a></li><li><a href="global.html#detachEvents">detachEvents</a></li><li><a href="global.html#detectBlur">detectBlur</a></li><li><a href="global.html#detectFocus">detectFocus</a></li><li><a href="global.html#getBookmark">getBookmark</a></li><li><a href="global.html#initialBookmark">initialBookmark</a></li><li><a href="global.html#isSameActiveElement">isSameActiveElement</a></li><li><a href="global.html#preLoadApiBlock">preLoadApiBlock</a></li><li><a href="global.html#readyDelay">readyDelay</a></li><li><a href="global.html#restoreSession">restoreSession</a></li><li><a href="global.html#RV">RV</a></li><li><a href="global.html#start">start</a></li><li><a href="global.html#trackFocusBuilder">trackFocusBuilder</a></li><li><a href="global.html#useBookmark">useBookmark</a></li><li><a href="global.html#versionCheck">versionCheck</a></li></ul>
</nav>

<div id="main">
    
    <h1 class="page-title">geo/legend-entry.service.js</h1>
    

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>/* global RColor */
(() => {
    'use strict';

    // layer group ids should not collide
    let itemIdCounter = 0;

    /**
     * @module legendEntryFactory
     * @memberof app.geo
     * @requires layerDefaults
     * @description
     *
     * The `legendEntryFactory` factory creates legend entries to be added to the toc.
     * TODO this module is due for refactoring, it's docs should be updated at that time
     *
     */
    angular
        .module('app.geo')
        .service('legendEntryFactory', legendEntryFactory);

    function legendEntryFactory($timeout, $translate, gapiService, Geo, layerDefaults) {

        const service = {
            placeholderEntryItem,
            singleEntryItem,
            dynamicEntryItem,
            entryGroup,
            dynamicEntryGroup,
            dynamicEntryMasterGroup
        };

        /**
         * Adds event bindings.  To be used with ENTRY_ITEM and ENTRY_GROUP
         * types.
         * @param {Object} obj the object to augment with event bindings
         */
        function eventsMixin(obj) {
            /**
             * Adds listeners for ERROR, REFRESH and LOADED states.  Sets
             * the appropriate flags on the LegendEntry object it is bound to.
             */
            obj.bindListeners = () => {

                const listener = state => {
                    const handlers = {
                        [Geo.Layer.States.ERROR]: () => {
                            obj.setLayerState(Geo.Layer.States.ERROR, 100);
                            obj.setLayerLoadingFlag(false, 100);
                        },
                        [Geo.Layer.States.REFRESH]: () => obj.setLayerLoadingFlag(true, 300),
                        [Geo.Layer.States.LOADED]: () => obj.setLayerLoadingFlag(false, 100)
                    };

                    if (handlers.hasOwnProperty(state)) {
                        handlers[state]();
                    }
                };
                obj._layerRecord.addStateListener(listener);
                obj.unbindListeners = () => obj._layerRecord.removeStateListener(listener);
            };

            /**
             * Sets state of the layer entry: error, default, out-of-scale, etc
             * @param {String} state defaults to `default`; state name
             * @param {Number} delay defaults to 0; delay before setting the state
             */
            obj.setLayerState = (state = Geo.Layer.States.DEFAULT, delay = 0) => {
                // same as with map loading indicator, need timeout since it's a non-Angular async call
                $timeout.cancel(obj._stateTimeout);
                obj._stateTimeout = $timeout(() => obj.state = state, delay);
            };

            /**
             * Sets `isLoading` flag on the legend entry.
             * @param {Boolean} isLoading defaults to true; flag indicating if the layer is updating their content
             * @param {Number} delay defaults to 0; delay before setting the state
             */
            obj.setLayerLoadingFlag = (isLoading = true, delay = 0) => {
                // same as with map loading indicator, need timeout since it's a non-Angular async call
                $timeout.cancel(obj._loadingTimeout);
                obj._loadingTimeout = $timeout(() => obj.isLoading = isLoading, delay);
            };

            /**
             * Sets `scale` flags on the legend entry.
             * @param {Boolean} scaleSet     mapping of featureIdx to booleans reflecting flag state
             */
            obj.setLayerScaleFlag = (scaleSet) => {

                if (obj.layerType !== Geo.Layer.Types.ESRI_DYNAMIC) {
                    // currently, non-feature based things have text-ish content put in their featureIdx.  map them to 0
                    const adjIdx = isNaN(obj.featureIdx) ? '0' : obj.featureIdx;

                    // TODO remove this test once it has passed the test of time
                    // quite often, it is undefined for example Eco Geo always start at 1. We need to keep this or modify upfront
                    if (typeof scaleSet[adjIdx] === 'undefined') {
                        console.warn('setLayerScaleFlag - indexes are not lining up');
                    } else {
                        // set scale flag properties and offscale options (only for legend entry, only on featureLayer and dynamicLayer for now)
                        const scale = scaleSet[adjIdx];
                        obj.flags.scale.visible = scale.value;
                        if (obj.options.offscale) {
                            obj.options.offscale.value = scale.zoomIn;
                        }
                    }
                } else {
                    // walk through layerEntries and update each one
                    obj.walkItems(slave => {
                        if (typeof scaleSet[slave.featureIdx].value === 'undefined') {
                            console.warn('setLayerScaleFlag - indexes are not lining up -- slave case');
                        }

                        slave.flags.scale.visible = scaleSet[slave.featureIdx].value;
                        slave.options.offscale.value = scaleSet[slave.featureIdx].zoomIn;
                    });
                }
            };
        }

        // jscs doesn't like enhanced object notation
        // jscs:disable requireSpacesInAnonymousFunctionExpression
        const ENTRY_ITEM = {
            _layerRecord: null,
            type: 'layer',
            name: null,
            id: 0,
            options: null,
            flags: null,
            state: 'rv-default', // TODO: replace
            cache: null, // to cache stuff like retrieved metadata info
            features: null,
            sortGroup: -1,
            symbology: null,
            removed: false, // a flag indicating that this legend entry is removed from the legend but is in the "undo" time frame;

            /**
             * Sets or toggles visibility of the layer legend entry
             * @param {Boolean|undefined} value target visibility value; toggles visibility if not set
             */
            setVisibility(value) {
                const option = this.options.visibility;
                option.value = typeof value !== 'undefined' ? value : !option.value;
            },

            /**
             * Returns visibility of the layer legend entry
             * @return {Boolean} true - visible; false - not visbile; undefined - visible and invisible at the same time
             */
            getVisibility() {
                return this.options.visibility.value;
            },

            setOpacity(value) {
                this.options.opacity.value = value;
            },

            getOpacity() {
                return this.options.opacity.value;
            },

            setCache(name, value) {
                this.cache[name] = value;
            },

            getCache(name) {
                return this.cache[name];
            },

            init(initialState, layerRec) {
                const defaults = layerDefaults[initialState.layerType];

                this._layerRecord = layerRec;
                this.id = 'rv_lt_' + itemIdCounter++;
                this.options = angular.merge({}, defaults.options);
                this.flags = angular.merge({}, defaults.flags);
                this.cache = {};
                this.features = {
                    count: $translate.instant('geometry.counting'),
                    type: Geo.Layer.Esri.GEOMETRY_TYPES.generic,
                    // sets default geometry type which is 'feature'
                    // to avoid pulling in angular translate interpolation message format plugin for now,
                    // store both plural and singular strings as the same transltion separated by a |
                    typeName: $translate.instant(Geo.Layer.Esri.GEOMETRY_TYPES.generic).split('|')[1]
                };

                // find appropriate sort group based on the initial layer type
                this.sortGroup = Geo.Layer.SORT_GROUPS.findIndex(sortGroup =>
                    sortGroup.indexOf(initialState.layerType) !== -1);

                angular.merge(this, initialState);

                // this.state = layerStates.default; ??
                const colour = (new RColor()).get(true, 0.4, 0.8);
                gapiService.gapi.symbology.generatePlaceholderSymbology(this.name, colour).then(symbologyItem => {
                    // do not override symbology if already set by something else
                    if (!this.symbology) {
                        this.symbology = [symbologyItem];
                    }
                });

                // check to see if we need settings
                checkSettings(this.options);
                eventsMixin(this);
            }
        };

        const PLACEHOLDER_ENTRY_ITEM = Object.create(ENTRY_ITEM);

        PLACEHOLDER_ENTRY_ITEM.init = function(initialState, layerRec) {
            ENTRY_ITEM.init.call(this, initialState, layerRec);

            // TODO: suggestion: separate legend entry ids from layer object ids
            this.id += 'placeholder';
            this.type = 'placeholder';
            this.state = 'rv-loading';

            // let placeholders have reload and/or remove buttons when needed (error gets both, loading gets remove only)
            // FIXME: shouldn't be inline here (harder to maintain), move this to somewhere more appropriate
            angular.merge(this.options, {
                reload: {
                    enabled: true
                },
                remove: {
                    enabled: true
                },
                reorder: {
                    enabled: true
                }
            });

            this.bindListeners();

            // since the main purpose of these placeholders is to indicate that layers are loading (or failed to load),
            // we set `isLoading` flag to `true` right away
            this.setLayerLoadingFlag(true);

            return this;
        };

        const SINGLE_ENTRY_ITEM = Object.create(ENTRY_ITEM);

        SINGLE_ENTRY_ITEM.init = function (initialState, layerRec) {
            ENTRY_ITEM.init.call(this, initialState, layerRec);
            this.setVisibility(this.getVisibility());
            this.setOpacity(this.options.opacity.value);

            // if there is no metadataurl, remove metadata options altogether
            if (typeof this.metadataUrl === 'undefined') {
                delete this.options.metadata;
            }

            // FIXME: this should be done only on feature layers, nothing else!
            // HACK: to get file based layers working; this will be solved by the layer record and legend entry hierarchy
            if (typeof initialState.url !== 'undefined') {
                const urlParts = initialState.url.split('/');
                this.featureIdx = urlParts.pop(); // get the featureidx from the end of the url
                this.url = urlParts.join('/'); // keep the rest of the url (without the index)
            } else {
                // TODO: this should be done is a more civilized way
                this.featureIdx = '0'; // for a file based layer, feature index should always be 0
            }
            this.bindListeners();

            return this;
        };

        /**
         * Sets visibility of a simple layer object, one which is represented by a single entry in the legend
         * @param  {Boolean} value visibility value
         */
        SINGLE_ENTRY_ITEM.setVisibility = function (value) {
            ENTRY_ITEM.setVisibility.call(this, value);
            this._layerRecord.setVisibility(this.getVisibility());
        };

        /**
         * Sets opacity of a simple layero bject, one which is represented by a single entry in the legend
         * @param {Number} value opacity value 0 to 1 where 0 is fully transparent
         */
        SINGLE_ENTRY_ITEM.setOpacity = function (value) {
            ENTRY_ITEM.setOpacity.call(this, value);
            this._layerRecord.setOpacity(value);
        };

        const DYNAMIC_ENTRY_ITEM = Object.create(ENTRY_ITEM);

        DYNAMIC_ENTRY_ITEM.init = function (initialState, layerRec) {
            ENTRY_ITEM.init.call(this, initialState, layerRec);

            return this;
        };

        /**
         * Sets visibility of a simple layer object, one which is represented by a single entry in the legend
         * @param  {Boolean} value visibility value
         * @param  {Boolean} isTrigger flag specifying if the visibility value should be applied to the actual layer; this is used to avoid setting visiblity multiple times for items in a subgroup when propagating
         */
        DYNAMIC_ENTRY_ITEM.setVisibility = function (value, isTrigger = true) {
            ENTRY_ITEM.setVisibility.call(this, value, false);

            if (isTrigger) {
                this.master._setVisibility();
            }
        };

        /**
         * Sets opacity value of the dynamic sublayer.
         * This makes the sublayer and all its children transparent relative to other subgroups/layers, not relative to other layers on the map.
         * @param {Number} value opacity value 0 to 100 where 100 is fully transparent
         */
        DYNAMIC_ENTRY_ITEM.setOpacity = function (value) {
            ENTRY_ITEM.setOpacity.call(this, value, false);
            this.master._setOpacity([this.featureIdx]);
        };

        const ENTRY_GROUP = {
            type: 'group',
            name: null,
            id: 0,
            expanded: null,
            items: null,
            cache: null, // to cache stuff like retrieved metadata info
            sortGroup: -1,
            removed: false, // a flag indicating that this legend entry is removed from the legend but is in the "undo" time frame;

            // TODO: add hook to set group options
            options: {
                visibility: {
                    value: true,
                    enabled: true
                },
                remove: {
                    enabled: false
                }
            },

            /**
             * Adds an item (layer or another group) to a layer group.
             * @param {Object} item     layer or group item to add
             * @param {Number} position position to insert the item at; defaults to the last position in the array
             * @return position of the inserted item
             */
            add(item, position = this.items.length) { // &lt;- awesome! default is re-evaluated everytime the function is called
                item.parent = this;
                this.items.splice(position, 0, item);

                return position;
            },

            /**
             * Removes a given item (layer or another group) from a layer group.
             * @param {Object} item     layer or group item to remove
             * @return {Number}      index of the item before removal or -1 if the item is not in the group
             */
            remove(item) {
                const index = this.items.indexOf(item);
                if (index !== -1) {
                    delete item.parent;
                    this.items.splice(index, 1);
                }

                return index;
            },

            /**
             * Sets or toggles visibility of the group legend entry and all it's children
             * @param {Boolean|undefined} value target visibility value; toggles visibility if not set
             * Other arguments are passed straight to child functions; useful for decorators;
             */
            setVisibility(value, ...arg) {
                const option = this.options.visibility;
                option.value = typeof value !== 'undefined' ? value : !option.value;

                // set visibility to the rest of the group
                if (this.type === 'group') {
                    this.items.forEach(item => item.setVisibility(option.value, ...arg));
                }
            },

            /**
             * Returns visibility of the group legend entry
             * @return {Boolean} true - visible; false - not visible; undefined - visible and invisible at the same time (AKA blink)
             */
            getVisibility() {
                return this.options.visibility.value;
            },

            setOpacity(value) {
                this.options.opacity.value = value;
            },

            getOpacity() {
                return this.options.opacity.value;
            },

            /**
             * Finds and returns a legend entry object with the specified id.
             * @param  {Number} entryId
             * @return {Object}    legend entry object or undefined if nothing is found
             */
            getItemById(entryId) {
                return this.walkItems(item =>
                    item.id === entryId ? item : [],
                    true
                )[0]; // true is important here as we want to test entry groups as well
            },

            /**
             * Walks child items executing the provided function on each leaf;
             * Returns a flatten array of results from the provided function;
             * @param  {Function} action function which is passed the following arguments: legend layer entry, its index in its parent's array, parent
             * @param  {Boolean} defaults to false; includeGroups flag specifying if the action should be applied to group items as well.
             * @return {Array}        flat array of results
             */
            walkItems(action, includeGroups = false) {
                // roll in the results into a flat array
                return [].concat.apply([], this.items.map((item, index) => {
                    if (item.type === 'group') {
                        if (includeGroups) {
                            return [].concat(action(item, index, this), item.walkItems(action, true));
                        } else {
                            return item.walkItems(action);
                        }
                    } else {
                        return action(item, index, this);
                    }
                }));
            },

            init(name, expanded = false) {
                this.id = 'rv_lt_' + itemIdCounter++;
                this.name = name;
                this.expanded = expanded;
                this.items = [];
                this.cache = {};
                eventsMixin(this);

                return this;
            }
        };

        // jscs:enable requireSpacesInAnonymousFunctionExpression

        const DYNAMIC_ENTRY_GROUP = Object.create(ENTRY_GROUP);

        DYNAMIC_ENTRY_GROUP.init = function (initialState, layerRec, expanded) {
            ENTRY_GROUP.init.call(this);

            // get defaults for specific layerType
            const defaults = layerDefaults[initialState.layerType] || {};

            this._layerRecord = layerRec;
            this.expanded = expanded;
            this.options = angular.merge({}, defaults.options);
            angular.merge(this, initialState);

            // check to see if we need settings
            checkSettings(this.options);

            return this;
        };

        /**
         * Sets visibility of a simple layer object, one which is represented by a single entry in the legend
         * @param  {Boolean} value visibility value
         * @param  {Boolean} isTrigger flag specifying if the visibility value should be applied to the actual layer; this is used to avoid setting visiblity multiple times for items in a subgroup when propagating
         */
        DYNAMIC_ENTRY_GROUP.setVisibility = function (value, isTrigger = true) {
            ENTRY_GROUP.setVisibility.call(this, value, false);

            if (isTrigger) {
                this.master._setVisibility();
            }
        };

        /**
         * Sets opacity value of the dynamic subgroup.
         * This makes the subgroup and all its children transparent relative to other subgroups/layers, not relative to other layers on the map.
         * @param {Number} value opacity value 0 to 100 where 100 is fully transparent
         */
        DYNAMIC_ENTRY_GROUP.setOpacity = function (value) {
            ENTRY_GROUP.setOpacity.call(this, value);
            this.master._setOpacity([this.featureIdx]);
        };

        const DYNAMIC_ENTRY_MASTER_GROUP = Object.create(DYNAMIC_ENTRY_GROUP);

        DYNAMIC_ENTRY_MASTER_GROUP.init = function (initialState, layerRec, expanded) {
            DYNAMIC_ENTRY_GROUP.init.call(this, initialState, layerRec, expanded);
            console.info('Binding master group listener');
            console.info(this);
            this.bindListeners();

            // morph layerEntries array into an object where keys are indexes of sublayers:
            // { 1: {index: 1, ...}, 4: { index: 4, ...} }
            const layerEntriesOptions = {};
            this.layerEntries.forEach(layerEntry => {
                layerEntriesOptions[layerEntry.index] = layerEntry;
            });

            // find appropriate sort group based on the initial layer type
            this.sortGroup = Geo.Layer.SORT_GROUPS.findIndex(sortGroup =>
                sortGroup.indexOf(initialState.layerType) !== -1);

            const layerEntryType = `${initialState.layerType}LayerEntry`;
            this.slaves = [];

            // generate all the slave sublayers upfornt ...
            console.log(this._layerRecord);
            console.log(initialState);
            this._layerRecord.layerInfos.forEach((layerInfo, index) => {
                let sublayerEntry;
                const sublayerEntryInitialState = {
                    name: layerInfo.name,
                    layerType: layerEntryType,
                    options: layerEntriesOptions[index] || {},
                    featureIdx: index
                };

                if (layerInfo.subLayerIds) { // group item
                    sublayerEntry = service.dynamicEntryGroup(sublayerEntryInitialState);
                } else { // leaf item
                    sublayerEntry = service.dynamicEntryItem(sublayerEntryInitialState);
                }

                assignDirectMaster.call(this, sublayerEntry, layerInfo.parentLayerId);
            });

            // if there is no metadataurl, remove metadata options altogether
            if (typeof this.metadataUrl === 'undefined') {
                delete this.options.metadata;
                this.slaves.forEach(slave => delete slave.options.metadata);
            }

            // if the 'supportsDynamicLayers' flag is false, remove sublayer opacity options
            if (!this._layerRecord.supportsDynamicLayers) {
                // FIXME: we do not use parens for arrow functions even when multilines (styleguide 8.4). Something to look at once we release the beta.
                this.slaves.forEach(slave => {
                    delete slave.options.opacity;

                    // check to see if we still need settings because we removed opacity
                    checkSettings(slave.options);
                });
            }

            if (this.layerEntries) {
                // add to the legend only once that are specified
                // NOTE:  :point_up: [March 18, 2016 12:53 PM](https://gitter.im/RAMP-PCAR/TeamRoom?at=56ec3281bb4a1731739b0d33)
                // We assume the inclusion is properly formatted (ex: [1, 2] will result in sublayer 2 being included twice - once under root and once more time under 1).
                this.layerEntries.forEach(({ index }) => {
                    const slave = this.slaves[index];

                    // if layerEntry id is incorrect, ignore it
                    if (slave) {
                        slave.setVisibility(slave.getVisibility(), false); // set visibility on the item which will propagate down if it has any items of its own
                        this.add(slave); // add layer entry to the master group
                    }
                });
            } else {
                // add all tile sublayers to the toc entry
                this.slaves.forEach(slave => this.add(slave));
            }

            // user flags set here because case specific to dynamic layer children
            this.walkItems(slave => slave.flags.user = this.flags.user);

            // set initial visibility of the sublayers;
            // this cannot be set in `layerRegistry` because legend entry for dynamic layer didn't exist yet;
            this._setVisibility(); // apply initial visibility values
            this._setOpacity(); // apply initial opacity values

            return this;

            /**
             * Finds direct parent of a child item in dynamic layer group and adds it to its items array.
             * `this` refers to the master group entry;
             * @param  {Object} item     layer or group item
             * @param  {Number} masterId id of the direct parent
             */
            function assignDirectMaster(item, masterId) {
                /*jshint validthis:true */
                item.master = this; // store a reference to the root group item of the dynamic layer
                this.slaves.push(item); // store in slave reference array

                if (masterId !== -1) {
                    this.slaves[masterId].add(item); // add to master's items list only if it's not the root
                }
            }
        };

        /**
         * Sets visibility of a dynamic entry root object.
         * @param  {Boolean} value visibility value
         * @param  {Boolean} isTrigger flag specifying if the visibility value should be applied to the actual layer; this is used to avoid setting visiblity multiple times for items in a subgroup when propagating
         */
        DYNAMIC_ENTRY_MASTER_GROUP.setVisibility = function (value, isTrigger = true) {
            DYNAMIC_ENTRY_GROUP.setVisibility.call(this, value, false);

            if (isTrigger) {
                this._setVisibility();
            }
        };

        /**
         * Sets opacity value of the dynamic layer itself, not individual sublayers
         * This actually makes the layer transparent, allowing to basemap and other layer to show through
         * @param {Number} value opacity value 0 to 1 where 0 is fully transparent
         */
        DYNAMIC_ENTRY_MASTER_GROUP.setOpacity = function (value) {
            ENTRY_GROUP.setOpacity.call(this, value);
            this._setOpacity();
        };

        /**
         * Applies current visibility values of the sublayers of a dynamic layer.
         */
        DYNAMIC_ENTRY_MASTER_GROUP._setVisibility = function () {

            // visibility is null iff it was set to false in a bookmark, so we force sublayers to hidden
            // as their visibility state is not captured in a bookmark
            if (this.options.visibility.value === null) {
                this.options.visibility.value = false;
                this.walkItems(item => {
                    item.setVisibility(false, false); // don't propagate
                    this._layerRecord.setVisibility(this.getVisibility());
                });

            // visibility is either true or false
            } else {
                // get an array of visible sublayers (e.g. [1,4,6])
                const visibleSublayerIds = this.walkItems(item => {
                    const index = this.slaves.indexOf(item);
                    return item.getVisibility() ? index : -1;
                }).filter(index => index !== -1); // filter out ones that are not visible

                this.options.visibility.value = visibleSublayerIds.length > 0; // visible if there exists a visible sublayer
                this._layerRecord.setVisibleLayers(visibleSublayerIds); // finally, apply visibility values to the sublayers
            }

            this._layerRecord.setVisibility(this.getVisibility()); // apply visibility to the dynamic layer itself
        };

        /**
         * Applies current opacity values to the specified sublayers of a dynamic layer.
         * @param {Array} subIds array of sublayer to apply the current opacity value to; if none specified, apply current opacity value to the layer itself and all its children
         */
        DYNAMIC_ENTRY_MASTER_GROUP._setOpacity = function (subIds) {
            if (typeof subIds === 'undefined') {
                subIds = this.walkItems(item => this.slaves.indexOf(item));

                // apply opacity to the whole layer
                this._layerRecord.setOpacity(this.options.opacity.value);
            }

            // well, if it's not supported, we can't set opacity for sublayers, bummer
            if (this._layerRecord.supportsDynamicLayers) {
                const optionsArray = [];

                // create an array of drawing options
                subIds.forEach(subId => {
                    const opacityValue = this.slaves[subId].options.opacity.value;
                    const drawingOptions = new gapiService.gapi.layer.LayerDrawingOptions();
                    drawingOptions.transparency = (opacityValue - 1) * -100; // instead of being consistent, esri using value from 0 to 100 for sublayer transparency where 100 is fully transparent

                    optionsArray[subId] = drawingOptions;
                });

                this._layerRecord.setLayerDrawingOptions(optionsArray);
                // this._layerRecord.show(); // ? is this necessary
            }
        };

        /**
        * Check if we need to remove the settings value from options
        * @private
        * @param {Object} options layer options
        */
        function checkSettings(options) {
            // if opacity, bounding box, snapshot and query are not present, remove settings
            if (typeof options.opacity === 'undefined' &amp;&amp;
                typeof options.boundingBox === 'undefined' &amp;&amp;
                typeof options.snapshot === 'undefined' &amp;&amp;
                typeof options.query === 'undefined') {
                delete options.settings;
            }
        }

        function placeholderEntryItem(initialState, layerRec) {
            return Object.create(PLACEHOLDER_ENTRY_ITEM)
                .init(initialState, layerRec);
        }

        function singleEntryItem(initialState, layerRec) {
            return Object.create(SINGLE_ENTRY_ITEM)
                .init(initialState, layerRec);
        }

        function dynamicEntryItem(initialState, layerRec) {
            return Object.create(DYNAMIC_ENTRY_ITEM)
                .init(initialState, layerRec);
        }

        function entryGroup(name, expanded) {
            return Object.create(ENTRY_GROUP)
                .init(name, expanded);
        }

        function dynamicEntryGroup(initialState, layerRec, expanded) {
            return Object.create(DYNAMIC_ENTRY_GROUP)
                .init(initialState, layerRec, expanded);
        }

        function dynamicEntryMasterGroup(initialState, layerRec, expanded) {
            return Object.create(DYNAMIC_ENTRY_MASTER_GROUP)
                .init(initialState, layerRec, expanded);
        }

        return service;
    }

})();
</code></pre>
        </article>
    </section>




</div>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.4.1</a> on Mon Sep 26 2016 10:42:36 GMT+0000 (UTC) using the <a href="https://github.com/clenemt/docdash">docdash</a> theme.
</footer>

<script>prettyPrint();</script>
<script src="scripts/linenumber.js"></script>
</body>
</html>
