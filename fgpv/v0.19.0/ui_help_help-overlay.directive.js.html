<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>ui/help/help-overlay.directive.js - Documentation</title>

    <script src="scripts/prettify/prettify.js"></script>
    <script src="scripts/prettify/lang-css.js"></script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc.css">
</head>
<body>

<input type="checkbox" id="nav-trigger" class="nav-trigger" />
<label for="nav-trigger" class="navicon-button x">
  <div class="navicon"></div>
</label>

<label for="nav-trigger" class="overlay"></label>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Classes</h3><ul><li><a href="app.module_geo-LayerBlueprint.LayerBlueprint.html">LayerBlueprint</a></li><li><a href="app.module_geo-LayerFileBlueprint.html">LayerFileBlueprint</a><ul class='methods'><li data-type='method'><a href="app.module_geo-LayerFileBlueprint.html#_readFileData">_readFileData</a></li><li data-type='method'><a href="app.module_geo-LayerFileBlueprint.html#generateLayer">generateLayer</a></li></ul></li><li><a href="app.module_geo-LayerServiceBlueprint.LayerServiceBlueprint.html">LayerServiceBlueprint</a></li><li><a href="LayerRecord.html">LayerRecord</a><ul class='methods'><li data-type='method'><a href="LayerRecord.html#.parseData">parseData</a></li><li data-type='method'><a href="LayerRecord.html#createBbox">createBbox</a></li><li data-type='method'><a href="LayerRecord.html#destroyBbox">destroyBbox</a></li><li data-type='method'><a href="LayerRecord.html#makeLayerBookmark">makeLayerBookmark</a></li></ul></li></ul><h3>Modules</h3><ul><li><a href="app.common.module_router.html">router</a></li><li><a href="app.core.module_common.html">common</a></li><li><a href="app.core.module_configService.html">configService</a><ul class='methods'><li data-type='method'><a href="app.core.module_configService.html#~currentLang">currentLang</a></li><li data-type='method'><a href="app.core.module_configService.html#~fileInit">fileInit</a></li><li data-type='method'><a href="app.core.module_configService.html#~getCurrent">getCurrent</a></li><li data-type='method'><a href="app.core.module_configService.html#~initialize">initialize</a></li><li data-type='method'><a href="app.core.module_configService.html#~mergeConfigParts">mergeConfigParts</a></li><li data-type='method'><a href="app.core.module_configService.html#~rcsAddKeys">rcsAddKeys</a></li><li data-type='method'><a href="app.core.module_configService.html#~rcsInit">rcsInit</a></li><li data-type='method'><a href="app.core.module_configService.html#~rcsLoad">rcsLoad</a></li><li data-type='method'><a href="app.core.module_configService.html#~ready">ready</a></li></ul></li><li><a href="app.layout.module_layoutService.html">layoutService</a></li><li><a href="app.layout.module_rvShell.html">rvShell</a></li><li><a href="app.layout.module_storageService.html">storageService</a></li><li><a href="app.module_common.html">common</a></li><li><a href="app.module_core.html">core</a></li><li><a href="app.module_geo.html">geo</a><ul class='methods'><li data-type='method'><a href="app.module_geo.html#.transformXML">transformXML</a></li></ul></li><li><a href="app.ui.common.module_stepper.html">stepper</a></li><li><a href="app.ui.module_appbar.html">appbar</a></li><li><a href="app.ui.module_basemap.html">basemap</a></li><li><a href="app.ui.module_common.html">common</a></li><li><a href="app.ui.module_details.html">details</a></li><li><a href="app.ui.module_filters.html">filters</a></li><li><a href="app.ui.module_help.html">help</a></li><li><a href="app.ui.module_loader.html">loader</a></li><li><a href="app.ui.module_mapnav.html">mapnav</a></li><li><a href="app.ui.module_metadata.html">metadata</a></li><li><a href="app.ui.module_panels.html">panels</a></li><li><a href="app.ui.module_settings.html">settings</a></li><li><a href="app.ui.module_sidenav.html">sidenav</a></li><li><a href="app.ui.module_toc.html">toc</a></li><li><a href="app.ui.module_toolbox.html">toolbox</a></li><li><a href="material.components.module_menuBar.html">menuBar</a></li><li><a href="module-ap.html">ap</a></li></ul><h3>Namespaces</h3><ul><li><a href="app.html">app</a></li><li><a href="app.common.html">common</a></li><li><a href="app.core.html">core</a><ul class='methods'><li data-type='method'><a href="app.core.html#.apiBlock">apiBlock</a></li><li data-type='method'><a href="app.core.html#.configBlock">configBlock</a></li><li data-type='method'><a href="app.core.html#.runBlock">runBlock</a></li><li data-type='method'><a href="app.core.html#.seed">seed</a></li><li data-type='method'><a href="app.core.html#~configureIconsets">configureIconsets</a></li><li data-type='method'><a href="app.core.html#~configureTheme">configureTheme</a></li><li data-type='method'><a href="app.core.html#~configureTranslations">configureTranslations</a></li><li data-type='method'><a href="app.core.html#~loadRcsLayers">loadRcsLayers</a></li><li data-type='method'><a href="app.core.html#~setLanguage">setLanguage</a></li></ul></li><li><a href="app.layout.html">layout</a></li></ul><h3>Tutorials</h3><ul><li><a href="tutorial-getting_started.html">Getting Started</a></li><li><a href="tutorial-gulp-i18n-csv.html">Translation Plugin</a></li></ul><h3>Global</h3><ul><li><a href="global.html#RV">RV</a></li><li><a href="global.html#versionCheck">versionCheck</a></li></ul>
</nav>

<div id="main">
    
    <h1 class="page-title">ui/help/help-overlay.directive.js</h1>
    

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>(() => {
    'use strict';

    /**
     * @ngdoc directive
     * @name rvHelpOverlay
     * @module app.ui.help
     * @restrict E
     * @description
     *
     * The `rvHelpOverlay` directive provides functionality for the help screen
     *
     */
    angular
        .module('app.ui.help')
        .directive('rvHelpOverlay', rvHelpOverlay);

    function rvHelpOverlay(helpService) {
        const directive = {
            restrict: 'E',
            templateUrl: 'app/ui/help/help-overlay.html',
            scope: {
            },
            link: link,
            controller: Controller,
            controllerAs: 'self',
            bindToController: true
        };

        return directive;

        /*********/

        function link(scope, el) { // , attr, ctrl) {
            const self = scope.self;
            self.draw = draw;

            const canvas = el.find('canvas')[0];
            const context = canvas.getContext('2d');

            // make the canvas take up the whole view
            context.canvas.width  = window.innerWidth;
            context.canvas.height = window.innerHeight;

            /**
            * Updates the canvas; clears, fills with translucent grey and then draws
            * whatever help sections are needed.
            *
            */
            function draw() {
                helpService.clearDrawn();
                context.clearRect(0, 0, canvas.width, canvas.height);

                // save context settings
                context.save();

                // fill canvas with translucent grey
                context.globalAlpha = 0.5;
                context.fillRect(0, 0, canvas.width, canvas.height);

                // restore saved context settings
                context.restore();
                const items = helpService.registry;
                items.forEach(item => {
                    const coords = item.getCoords();
                    if (shouldBeDrawn(item.key, coords)) {
                        // draw a rect with a border
                        context.fillRect(coords.x, coords.y, coords.width, coords.height);
                        context.clearRect(coords.x + 1, coords.y + 1,
                            coords.width - 2, coords.height - 2);

                        // cache in helpService to check against future items
                        helpService.setDrawn({ coords: coords, key: item.key });
                    }
                });
            }

            /**
            * Performs checks to see whether the object described with (key, coords) is valid to draw.
            * An object is valid to draw iff - it doesn't share a key with an already drawn object
            *                                   (we only want one of each help section)
            *                                - it doesn't overlap with an already drawn object
            *                                   (we don't want overlapping help sections)
            *                                - it's width and height are non-zero
            *
            * @param {String} key       the attribute key for the object being checked
            * @param {Object} coords    the coordinates for the object being checked
            * @return {Boolean}         returns true iff the object is valid to draw
            */
            function shouldBeDrawn(key, coords) {
                let valid = true;
                let alreadyDrawn = helpService.drawnCache;

                // if this is the first item being looked at
                if (alreadyDrawn.length === 0) {
                    return true;
                }
                alreadyDrawn.forEach(drawnItem => {
                    // Check for unique key, no overlap and no zero-dimensions
                    if (drawnItem.key === key || overlap(drawnItem.coords, coords) ||
                    coords.width * coords.height === 0) {
                        valid = false;
                        return;
                    }
                });
                return valid;
            }

            /**
            * Checks if two rectangles overlap
            *
            * @param {Object} first     the x, y, height and width of the first rectangle
            * @param {Object} second    the x, y, height and width of the second rectangle
            * @return {Boolean}         returns true iff the two rectangles overlap
            */
            function overlap(first, second) {
                return !((first.y + first.height) &lt;= second.y || first.y >= (second.y + second.height) ||
                     (first.x + first.width) &lt;= second.x || first.x >= (second.x + second.width));
            }
        }
    }

    function Controller($scope, stateManager, helpService) {
        'ngInject';

        const self = this;

        // if the help state changes to true: draw the new canvas
        $scope.stateManager = stateManager;
        $scope.$watch('stateManager.state.help.active', newValue => {
            if (newValue) {
                self.draw();
            }
        });

        self.close = function close() {
            stateManager.setActive({ help: false });
        };

        // used in the template to know which help sections need a button
        self.helpSections = helpService.drawnCache;

        // temp functionality for help buttons
        self.show = function show(key) {
            console.log('Show help for: ' + key);
        };

        activate();

        /*********/

        function activate() {

        }
    }
})();
</code></pre>
        </article>
    </section>




</div>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.4.0</a> on Wed Jun 22 2016 14:57:14 GMT+0000 (UTC) using the <a href="https://github.com/clenemt/docdash">docdash</a> theme.
</footer>

<script>prettyPrint();</script>
<script src="scripts/linenumber.js"></script>
</body>
</html>
