<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>ui/common/plug-slide.animation.js - Documentation</title>

    <script src="scripts/prettify/prettify.js"></script>
    <script src="scripts/prettify/lang-css.js"></script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc.css">
</head>
<body>

<input type="checkbox" id="nav-trigger" class="nav-trigger" />
<label for="nav-trigger" class="navicon-button x">
  <div class="navicon"></div>
</label>

<label for="nav-trigger" class="overlay"></label>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Classes</h3><ul><li><a href="app.module_geo-LayerBlueprint.LayerBlueprint.html">LayerBlueprint</a></li><li><a href="app.module_geo-LayerFileBlueprint.html">LayerFileBlueprint</a><ul class='methods'><li data-type='method'><a href="app.module_geo-LayerFileBlueprint.html#_readFileData">_readFileData</a></li><li data-type='method'><a href="app.module_geo-LayerFileBlueprint.html#generateLayer">generateLayer</a></li></ul></li><li><a href="app.module_geo-LayerServiceBlueprint.LayerServiceBlueprint.html">LayerServiceBlueprint</a></li><li><a href="LayerRecord.html">LayerRecord</a><ul class='methods'><li data-type='method'><a href="LayerRecord.html#.parseData">parseData</a></li><li data-type='method'><a href="LayerRecord.html#createBbox">createBbox</a></li><li data-type='method'><a href="LayerRecord.html#destroyBbox">destroyBbox</a></li><li data-type='method'><a href="LayerRecord.html#makeLayerBookmark">makeLayerBookmark</a></li></ul></li></ul><h3>Modules</h3><ul><li><a href="app.common.module_router.html">router</a></li><li><a href="app.core.module_common.html">common</a></li><li><a href="app.core.module_configService.html">configService</a><ul class='methods'><li data-type='method'><a href="app.core.module_configService.html#~currentLang">currentLang</a></li><li data-type='method'><a href="app.core.module_configService.html#~fileInit">fileInit</a></li><li data-type='method'><a href="app.core.module_configService.html#~getCurrent">getCurrent</a></li><li data-type='method'><a href="app.core.module_configService.html#~initialize">initialize</a></li><li data-type='method'><a href="app.core.module_configService.html#~mergeConfigParts">mergeConfigParts</a></li><li data-type='method'><a href="app.core.module_configService.html#~rcsAddKeys">rcsAddKeys</a></li><li data-type='method'><a href="app.core.module_configService.html#~rcsInit">rcsInit</a></li><li data-type='method'><a href="app.core.module_configService.html#~rcsLoad">rcsLoad</a></li><li data-type='method'><a href="app.core.module_configService.html#~ready">ready</a></li></ul></li><li><a href="app.layout.module_layoutService.html">layoutService</a></li><li><a href="app.layout.module_rvShell.html">rvShell</a></li><li><a href="app.layout.module_storageService.html">storageService</a></li><li><a href="app.module_common.html">common</a></li><li><a href="app.module_core.html">core</a></li><li><a href="app.module_geo.html">geo</a><ul class='methods'><li data-type='method'><a href="app.module_geo.html#.transformXML">transformXML</a></li></ul></li><li><a href="app.ui.common.module_stepper.html">stepper</a></li><li><a href="app.ui.module_appbar.html">appbar</a></li><li><a href="app.ui.module_basemap.html">basemap</a></li><li><a href="app.ui.module_common.html">common</a></li><li><a href="app.ui.module_details.html">details</a></li><li><a href="app.ui.module_filters.html">filters</a></li><li><a href="app.ui.module_help.html">help</a></li><li><a href="app.ui.module_loader.html">loader</a></li><li><a href="app.ui.module_mapnav.html">mapnav</a></li><li><a href="app.ui.module_metadata.html">metadata</a></li><li><a href="app.ui.module_panels.html">panels</a></li><li><a href="app.ui.module_settings.html">settings</a></li><li><a href="app.ui.module_sidenav.html">sidenav</a></li><li><a href="app.ui.module_toc.html">toc</a></li><li><a href="app.ui.module_toolbox.html">toolbox</a></li><li><a href="material.components.module_menuBar.html">menuBar</a></li><li><a href="module-ap.html">ap</a></li></ul><h3>Namespaces</h3><ul><li><a href="app.html">app</a></li><li><a href="app.common.html">common</a></li><li><a href="app.core.html">core</a><ul class='methods'><li data-type='method'><a href="app.core.html#.apiBlock">apiBlock</a></li><li data-type='method'><a href="app.core.html#.configBlock">configBlock</a></li><li data-type='method'><a href="app.core.html#.runBlock">runBlock</a></li><li data-type='method'><a href="app.core.html#.seed">seed</a></li><li data-type='method'><a href="app.core.html#~configureIconsets">configureIconsets</a></li><li data-type='method'><a href="app.core.html#~configureTheme">configureTheme</a></li><li data-type='method'><a href="app.core.html#~configureTranslations">configureTranslations</a></li><li data-type='method'><a href="app.core.html#~loadRcsLayers">loadRcsLayers</a></li><li data-type='method'><a href="app.core.html#~setLanguage">setLanguage</a></li></ul></li><li><a href="app.layout.html">layout</a></li></ul><h3>Tutorials</h3><ul><li><a href="tutorial-getting_started.html">Getting Started</a></li><li><a href="tutorial-gulp-i18n-csv.html">Translation Plugin</a></li></ul><h3>Global</h3><ul><li><a href="global.html#RV">RV</a></li><li><a href="global.html#versionCheck">versionCheck</a></li></ul>
</nav>

<div id="main">
    
    <h1 class="page-title">ui/common/plug-slide.animation.js</h1>
    

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>/* global Ease, BezierEasing, TweenLite */

(() => {
    'use strict';

    // Using the first inner div to make sure we select something that renders
    const RV_PANEL_SELECTOR = 'div:first';
    const RV_PLUG_SLIDE_DURATION = 0.3;
    const RV_PLUG_SLIDE_ID_DATA = 'rv-plug-slide-id';
    const RV_SWIFT_IN_OUT_EASE = new Ease(BezierEasing(0.35, 0, 0.25, 1));

    let sequences = {}; // store animation sequences
    let counter = 1; // simple id for animation sequences

    /**
     * @ngdoc service
     * @name rvPlugSlide
     * @module app.ui.common
     * @description
     *
     * The `rvPlugSlide` is an animation. It animates enter and leave events on view plugs by applying transitions to plugs' panels. It will not work with just any node.
     *
     * ```html
     * &lt;!-- plug's panel will be animated by sliding it down from -100% of its height relative to itself -->
     * &lt;div class="rv-plug-slide-down">&lt;/div>
     *
     * &lt;!-- plug's panel will be animated by sliding it down from -100% of its height relative to the app's root element -->
     * &lt;div class="rv-plug-slide-down-grand">&lt;/div>
     *
     */
    const module = angular.module('app.ui.common');
    const directions = ['down', 'right', 'up', 'left'];
    const animationTypes = { slide: makeSlideAnim, fade: makeFadeAnim };

    // register animations, loops through directions and types
    directions.forEach((direction, index) =>
        Object.keys(animationTypes).forEach(type => {
            module
                .animation(`.rv-plug-${type}-${direction}`,
                    animationBuilder(type, index, false))
                .animation(`.rv-plug-${type}-${direction}-grand`,
                    animationBuilder(type, index, true));
        }));

    // stationary fade animation
    module
        .animation('.rv-plug-fade', animationBuilder('fade', 4, false));

    // TODO: add option to change duration through an attribute
    // TODO: add option to add delay before animation starts through an attribute

    /**
     * Animates plug's panel.
     *
     * @param  {String}  type        type of animation (fade, slide, etc.)
     * @param  {Number}  direction   direction of movement (0 - down, 1 - right, 2 - up, 3 - left, 4 - stationary)
     * @param  {Bool}    grand       type of shift (see top comment)
     * @return {Object}  service     object with `enter` and `leave` functions
     */
    function animationBuilder(type, direction, grand) {
        return $rootElement => {
            'ngInject';
            const func = animationTypes[type];
            return {
                enter: func($rootElement, direction, false, grand),
                leave: func($rootElement, direction, true, grand),
                addClass: ngShowHideWrapper(true, func, $rootElement, direction, grand),
                removeClass: ngShowHideWrapper(false, func, $rootElement, direction, grand)
            };
        };
    }

    /**
    * Creates Fade animations
    *
    * @param  {Object}   $rootElement
    * @param  {Number}   direction   direction of movement (0 - down, 1 - right, 2 - up, 3 - left, 4 - stationary)
    * @param  {Bool}     reverse     whether to reverse the animation direction
    * @param  {Bool}     grand       type of shift (see top comment)
    * @param  {Object}   element     plug node
    * @param  {Function} callback    callback from angular
    */
    function makeFadeAnim($rootElement, direction, reverse, grand) {
        return (element, callback) => {
            let duration = RV_PLUG_SLIDE_DURATION;
            let shift = calculateShift($rootElement, element, direction, grand);

            let start = {
                x: shift.x,
                y: shift.y,
                z: 0,
                opacity: 0
            };

            let end = {
                x: '0%',
                y: '0%',
                z: 0,
                opacity: 1
            };

            let config = {
                ease: RV_SWIFT_IN_OUT_EASE,
                onComplete: cleanup(element, callback),
                clearProps: 'transform,opacity' // http://tiny.cc/dbuh4x; http://tiny.cc/wbuh4x
            };

            buildTween(element, callback, duration, reverse, start, end, config);
        };
    }

    /**
    * Creates Slide animations
    *
    * @param  {Object}   $rootElement
    * @param  {Number}   direction   direction of movement (0 - down, 1 - right, 2 - up, 3 - left, 4 - stationary)
    * @param  {Bool}     reverse     whether to reverse the animation direction
    * @param  {Bool}     grand       type of shift (see top comment)
    * @param  {Object}   element     plug node
    * @param  {Function} callback    callback from angular
    */
    function makeSlideAnim($rootElement, direction, reverse, grand) {
        return (element, callback) => {
            let duration = RV_PLUG_SLIDE_DURATION;
            let shift = calculateShift($rootElement, element, direction, grand);

            let start = {
                x: shift.x,
                y: shift.y,
                z: 0
            };

            let end = {
                x: '0%',
                y: '0%',
                z: 0
            };

            let config = {
                ease: RV_SWIFT_IN_OUT_EASE,
                onComplete: cleanup(element, callback),
                clearProps: 'transform' // http://tiny.cc/dbuh4x; http://tiny.cc/wbuh4x
            };

            buildTween(element, callback, duration, reverse, start, end, config);
        };
    }

    /**
    * Retrieves the panel size of an element, based on animation direction
    *
    * @param  {Object}  element     plug node
    * @param  {Number}  direction   direction of movement (0 - down, 1 - right, 2 - up, 3 - left, 4 - stationary)
    * @return {Number}  size        size of relevant dimension
    */
    function getPanelSize(element, direction) {
        if (direction % 2 === 0) { // Down, Up
            return element.find(RV_PANEL_SELECTOR).outerHeight(true);
        } else { // Left, Right
            return element.find(RV_PANEL_SELECTOR).outerWidth(true);
        }
    }

    /**
    * Calculates the delta needed for a grand animation
    *
    * @param  {Object}  $rootElement
    * @param  {Object}  element      plug node
    * @param  {Number}  direction    direction of movement (0 - down, 1 - right, 2 - up, 3 - left, 4 - stationary)
    * @return {Number}  delta        amount the panel should move
    */
    function deltaHelper($rootElement, element, direction) {
        let delta = 10;

        if (direction === 0) { // DOWN
            delta += element.position().top + getPanelSize(element, direction);
        } else if (direction === 1) { // RIGHT
            delta += element.position().left + getPanelSize(element, direction);
        } else if (direction === 2) { // UP
            // not adding on to 10 because there is no drop shadow above the panel
            delta = $rootElement.outerHeight(true) - element.position().top;
        } else { // LEFT
            delta += $rootElement.outerWidth(true) - element.position().left;
        }

        return delta;
    }

    /**
    * Calculates the amount to translate the panel
    *
    * @param  {Object}  $rootElement
    * @param  {Object}  element     plug node
    * @param  {Number}  direction   direction of movement (0 - down, 1 - right, 2 - up, 3 - left, 4 - stationary)
    * @param  {Bool}    grand       type of shift (see top comment)
    * @return {Object}  shift       amount to move the panel
    */
    function calculateShift($rootElement, element, direction, grand) {
        const shift = {
            x: 0,
            y: 0
        };

        const travel = {
            0: 'y',
            1: 'x',
            2: 'y',
            3: 'x'
        };

        const modifier = {
            0: '-',
            1: '-',
            2: '',
            3: ''
        };

        if (direction !== 4) {
            let delta = grand ? deltaHelper($rootElement, element, direction).toString() : '100%';

            // based on direction, set starting `x` or `y` attributes of the node
            shift[travel[direction]] = modifier[direction] + delta;
        }

        return shift;
    }

    /**
    * Deletes the element's current animation sequence and calls angulars callback
    *
    * @param  {Object}   element    plug node
    * @param  {Function} callback   callback from angular
    */
    function cleanup(element, callback) {
        return () => {
            delete sequences[element.data(RV_PLUG_SLIDE_ID_DATA)];
            callback();
        };
    }

    /**
     * Makes call to animation from 'ng-show' and 'ng-hide' work the same as enter/leave
     *
     * @param  {boolean}    addClass    a flag indicating whether the `ng-hide` class was added or removed
     * @return {function}               bootstrapped open or close function
     */
    function ngShowHideWrapper(addClass, func, $rootElement, direction, grand) {
        return (element, cssClass, callback) => {
            // both `ng-hide` and `ng-show` use `ng-hide` css class
            const action = {
                true: func($rootElement, direction, true, grand),
                false: func($rootElement, direction, false, grand)
            };

            // pick the action to perform;
            // `addClass` flips the action depending on whether the class is added or removed
            action[addClass](element, callback);
        };
    }

    /**
    * Handles building the animation tween
    *
    * @param  {Object}   element    plug node
    * @param  {Function} callback   callback from angular
    * @param  {Number}   duration   length of animation in seconds
    * @param  {Bool}     reverse    whether to reverse the animation direction
    * @param  {Object}   start      beginning state for the animation
    * @param  {Object}   end        end state for the animation
    * @param  {Object}   config     additional flags for the actual end state
    */
    function buildTween(element, callback, duration, reverse, start, end, config) {
        // Check if a sequence is already tied to the element, if so reverse it.
        // (if the animation still exists it must be ongoing)
        let sequence = sequences[element.data(RV_PLUG_SLIDE_ID_DATA)];
        if (sequence) {
            sequence.reverse().eventCallback('onReverseComplete', cleanup(element, callback));
            return;
        }

        // Build and store the tween
        let id = counter++;
        sequences[id] = TweenLite.fromTo(element.find(RV_PANEL_SELECTOR), duration,
            reverse ? end : start,
            angular.extend({}, reverse ? start : end, config));

        element.data(RV_PLUG_SLIDE_ID_DATA, id);
    }
})();
</code></pre>
        </article>
    </section>




</div>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.4.0</a> on Wed Jun 22 2016 16:22:30 GMT+0000 (UTC) using the <a href="https://github.com/clenemt/docdash">docdash</a> theme.
</footer>

<script>prettyPrint();</script>
<script src="scripts/linenumber.js"></script>
</body>
</html>
